"use strict";(()=>{var e={};e.id=9229,e.ids=[9229],e.modules={75184:e=>{e.exports=require("@reduxjs/toolkit")},3681:e=>{e.exports=require("custom-id-new")},38941:e=>{e.exports=require("form-data")},11185:e=>{e.exports=require("mongoose")},60614:e=>{e.exports=require("next-auth/jwt")},35648:e=>{e.exports=require("next-redux-wrapper")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},99648:e=>{e.exports=import("axios")},14006:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{config:()=>u,default:()=>p,routeModule:()=>l});var a=s(71802),i=s(47153),o=s(56249),c=s(48404),n=e([c]);c=(n.then?(await n)():n)[0];let p=(0,o.l)(c,"default"),u=(0,o.l)(c,"config"),l=new a.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/checkout/sslcommerz",pathname:"/api/checkout/sslcommerz",bundlePath:"",filename:""},userland:c});r()}catch(e){r(e)}})},48404:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{default:()=>apiHandler});var a=s(99648),i=s(3681),o=s.n(i),c=s(38941),n=s.n(c),p=s(60614),u=s(39038),l=s(10090),d=s(39904),_=s(16572),m=s(13808),h=e([a]);a=(h.then?(await h)():h)[0];let discountPrice=(e,t)=>e/100*t;async function apiHandler(e,t){let{method:s}=e,r=process.env.AUTH_SECRET,i=await (0,p.getToken)({req:e,secret:r});if(await (0,m.Z)(),"POST"===s)try{let s=await d.Z.findOne({}),r=s.currency.name,c=JSON.parse(e.body.order),{cartData:p,exchangeRate:m}=c,h=+p.deliveryInfo?.cost,f=p.items.reduce((e,t)=>e+t.qty*t.price,0),g=p.items.reduce((e,t)=>{var s;let r=t.qty*t.price;return e+(s=t.vat,r*s/100)},0),w=p.items.reduce((e,t)=>{var s;let r=t.qty*t.price;return e+(s=t.tax,r*s/100)},0),y=discountPrice(p.coupon.discount,+f),x=f+g+w+h-y,b=(0,u.m3)(x,m),k="T"+o()({randomLength:4,upperCase:!0}),v=`R${o()({randomLength:4,upperCase:!0})}`,I={store_id:"",store_passwd:"",total_amount:"BDT"===r?x:b,currency:"BDT"===r?"BDT":"USD",tran_id:k,success_url:`https://app.techplek.website/api/checkout/process_order_ssl?status=success&order_id=${v}`,fail_url:`https://app.techplek.website/api/checkout/process_order_ssl?status=fail&order_id=${v}`,cancel_url:`https://app.techplek.website/api/checkout/process_order_ssl?status=cancel&order_id=${v}`,ipn_url:`https://app.techplek.website/api/checkout/process_order_ssl?status=ipn&order_id=${v}`,shipping_method:"NO",product_name:p.items[0]?.name,product_category:"Clothing",product_profile:"general",cus_name:p.billingInfo.fullName,cus_email:p.billingInfo.email,cus_add1:p.billingInfo.house,cus_city:p.billingInfo.city,cus_postcode:p.billingInfo.zipCode,cus_country:p.billingInfo.country,cus_phone:p.billingInfo.phone},P=new(n());for(let e in I)if(Object.hasOwnProperty.call(I,e)){let t=I[e];P.append(e,t||"")}let q=await (0,a.default)({url:"https://sandbox.sslcommerz.com/gwprocess/v4/api.php",method:"POST",data:P}).then(e=>e.data);if("SUCCESS"===q.status){let{coupon:e,items:s,billingInfo:r,shippingInfo:a,deliveryInfo:o}=p,c=await l.Z.create({orderId:v,products:s,status:"Draft",billingInfo:r,shippingInfo:a,deliveryInfo:o,paymentMethod:"Sslcommerz",paymentStatus:"Unpaid",paymentId:null,totalPrice:f,payAmount:x,coupon:e,vat:g,tax:w});i&&i.user.id&&await _.Z.findByIdAndUpdate(i.user.id,{$push:{orders:c._id}}),t.redirect(q.GatewayPageURL)}else t.status(500).json({message:q.failedreason})}catch(e){console.log(e),t.status(500).json({success:!1})}else t.status(400).json({success:!1})}r()}catch(e){r(e)}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[4222,9305,3808,9038],()=>__webpack_exec__(14006));module.exports=s})();