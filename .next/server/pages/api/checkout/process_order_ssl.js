"use strict";(()=>{var e={};e.id=5399,e.ids=[5399],e.modules={11185:e=>{e.exports=require("mongoose")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},46844:(e,a,s)=>{s.r(a),s.d(a,{config:()=>u,default:()=>c,routeModule:()=>l});var t={};s.r(t),s.d(t,{default:()=>apiHandler});var r=s(71802),d=s(47153),o=s(56249);let i=require("url");var n=s(10090);async function apiHandler(e,a){let{method:s}=e;if("POST"===s)try{let s=e.query.status;switch(s){case"success":let t=await n.Z.findOne({orderId:e.query.order_id});"Draft"===t.status&&(t.paymentStatus="Paid",t.status="Pending",await t.save()),a.writeHead(302,{Location:`/checkout/success/${t._id}`}).end();break;case"fail":case"cancel":await n.Z.findOneAndRemove({orderId:e.query.order_id}),a.writeHead(302,{Location:"/"}).end();break;case"ipn":if(e.body&&"VALID"===e.body.status){let a=await n.Z.findOne({orderId:e.query.order_id});a.paymentStatus="Paid",a.status="Pending",a.paymentId=e.body.tran_id,await a.save();let s=new i.URL("https://sandbox.sslcommerz.com/validator/api/validationserverAPI.php"),t={val_id:e.body.val_id,store_id:"",store_passwd:""};s.search=new i.URLSearchParams(t),await fetch(s).catch(e=>console.log(e))}a.status(201).json({message:"ok"});break;default:a.status(400).json({success:!1})}}catch(e){console.log(e),a.status(500).json({success:!1})}else a.status(400).json({success:!1})}let c=(0,o.l)(t,"default"),u=(0,o.l)(t,"config"),l=new r.PagesAPIRouteModule({definition:{kind:d.x.PAGES_API,page:"/api/checkout/process_order_ssl",pathname:"/api/checkout/process_order_ssl",bundlePath:"",filename:""},userland:t})},10090:(e,a,s)=>{s.d(a,{Z:()=>o});var t=s(11185),r=s(39305);let d=new t.Schema(r.vm),o=t.models.order||(0,t.model)("order",d)}};var a=require("../../../webpack-api-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),s=a.X(0,[4222,9305],()=>__webpack_exec__(46844));module.exports=s})();