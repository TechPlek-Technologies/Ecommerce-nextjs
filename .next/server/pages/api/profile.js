"use strict";(()=>{var e={};e.id=7925,e.ids=[7925],e.modules={67096:e=>{e.exports=require("bcrypt")},11185:e=>{e.exports=require("mongoose")},60614:e=>{e.exports=require("next-auth/jwt")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5321:(e,s,a)=>{a.r(s),a.d(s,{config:()=>f,default:()=>p,routeModule:()=>w});var t={};a.r(t),a.d(t,{default:()=>apiHandler});var r=a(71802),i=a(47153),o=a(56249),d=a(67096),u=a.n(d),n=a(60614),c=a(16572),l=a(13808);async function apiHandler(e,s){let{method:a}=e,t=process.env.AUTH_SECRET,r=await (0,n.getToken)({req:e,secret:t});if(!r)return s.status(403).json({success:!1,message:"Access Forbidden"});await (0,l.Z)();let i=["-hash","-salt","-isAdmin","-resetPasswordExpires","-resetPasswordToken","-__v","-createdAt","-updatedAt","-isStaff","-emailVerified","-confirmationCode","-notification"];switch(a){case"GET":try{let a=e.query.scope,t={};switch(a){case"orders":t=await c.Z.findById(e.query.id).select([...i,"-wallet","-favorite","-address","-refundRequest"]).populate("orders",{_id:0,__V:0,new:0,user:0},null,{sort:{orderDate:-1}});break;case"favorite":t=await c.Z.findById(e.query.id).select([...i,"-orders","-address","-wallet","-refundRequest","-bankInfo"]).populate("favorite").exec();break;case"refund":t=await c.Z.findById(e.query.id).select([...i,"-orders","-address","-wallet","-favorite","-bankInfo"]).populate("refundRequest",{},null,{sort:{_id:-1}}).exec();break;default:t=await c.Z.findById(e.query.id).select(i).exec()}s.status(200).json({success:!0,user:t})}catch(e){console.log(e),s.status(400).json({success:!1})}break;case"POST":try{let{query:a,body:t}=e,r=await c.Z.findById(a.id);if(!r)return s.status(400).json({success:!1});switch(a.scope){case"info":r.name=t.name,r.email=t.email,r.phone=t.phone,r.house=t.house,r.city=t.city,r.state=t.state,r.zipCode=t.zipCode,r.country=t.country,await r.save();break;case"password":let i=await u().genSalt(6),o=await u().hash(t.password,i);r.salt=i,r.hash=o,await r.save();break;default:return s.status(400).json({success:!1})}s.status(200).json({success:!0})}catch(e){if(console.log(e),e&&11e3===e.code)return s.status(400).json({success:!1,duplicate:!0});s.status(400).json({success:!1})}break;default:s.status(400).json({success:!1})}}let p=(0,o.l)(t,"default"),f=(0,o.l)(t,"config"),w=new r.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/profile",pathname:"/api/profile",bundlePath:"",filename:""},userland:t})}};var s=require("../../webpack-api-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),a=s.X(0,[4222,9305,3808],()=>__webpack_exec__(5321));module.exports=a})();