"use strict";(()=>{var e={};e.id=8518,e.ids=[8518],e.modules={21841:e=>{e.exports=require("@aws-sdk/client-s3")},11185:e=>{e.exports=require("mongoose")},60614:e=>{e.exports=require("next-auth/jwt")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},73292:e=>{e.exports=require("fs/promises")},16783:(e,a,s)=>{s.r(a),s.d(a,{config:()=>g,default:()=>m,routeModule:()=>w});var i={};s.r(i),s.d(i,{config:()=>f,default:()=>apiHandler});var t=s(71802),r=s(47153),l=s(56249);let o=require("fs");var n=s(26412),c=s(58364),d=s(39904),p=s(13808),u=s(11217);let f={api:{bodyParser:!1}};async function apiHandler(e,a){let{method:s}=e;if(!await (0,c.Z)(e,"settings"))return a.status(403).json({success:!1,message:"Access Forbidden"});switch(await (0,p.Z)(),s){case"GET":try{let e=await d.Z.findOne({});a.status(200).json({success:!0,settings:e})}catch(e){console.log(e),a.status(400).json({success:!1})}break;case"POST":try{let{query:s}=e,i=await (0,u.c)(e),t=await d.Z.findOne({});switch(null===t&&(t=new d.Z({name:""})),s.scope){case"general":let r=JSON.parse(i.field.color);t.name=i.field.name,t.title=i.field.title,t.currency={name:i.field.currencyName,symbol:i.field.currencySymbol,exchangeRate:i.field.exchangeRate},t.color=r,t.language=i.field.language,await t.save();break;case"layout":let l=JSON.parse(i.field.footerBanner),c=JSON.parse(i.field.social);t.phoneHeader=i.field.phoneHeader,t.shortAddress=i.field.shortAddress,t.phoneFooter=i.field.phoneFooter,t.email=i.field.email,t.address=i.field.address,t.description=i.field.description,t.copyright=i.field.copyright,t.footerBanner=l,t.social=c,await t.save();break;case"graphics":let p=JSON.parse(i.field.logo),f=JSON.parse(i.field.favicon),m=JSON.parse(i.field.gatewayImage);if(t.logo[0]&&t.logo[0].name!==p[0].name){let e=[{Key:t.logo[0].name}];await (0,n.Z)(e)}if(t.favicon[0]&&t.favicon[0].name!==f[0].name){let e=[{Key:t.favicon[0].name}];await (0,n.Z)(e)}if(t.gatewayImage[0]&&t.gatewayImage[0].name!==m[0].name){let e=[{Key:t.gatewayImage[0].name}];await (0,n.Z)(e)}t.logo=p,t.favicon=f,t.gatewayImage=m,await t.save();break;case"seo":let g=JSON.parse(i.field.image);if(t.seo.image[0]&&t.seo.image[0].name!==g[0].name){let e=[{Key:t.seo.image[0].name}];await (0,n.Z)(e)}t.seo.title=i.field.title,t.seo.description=i.field.description,t.seo.keyword=i.field.keyword,t.seo.image=g,await t.save();break;case"script":t.script=JSON.parse(i.field.script),await t.save();break;case"gateway":t.paymentGateway=JSON.parse(i.field.gateway),await t.save();break;case"login":t.login=JSON.parse(i.field.login),await t.save();break;case"security":t.security=JSON.parse(i.field.security),await t.save();break;case"sitemap":(0,o.writeFileSync)("public/sitemap.xml",i.field.sitemap);break;case"robot":(0,o.writeFileSync)("public/robots.txt",i.field.robots);break;default:return a.status(400).json({success:!1})}a.status(200).json({success:!0})}catch(e){console.log(e),a.status(500).json({success:!1})}break;default:a.status(400).json({success:!1})}}let m=(0,l.l)(i,"default"),g=(0,l.l)(i,"config"),w=new t.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/settings",pathname:"/api/settings",bundlePath:"",filename:""},userland:i})},26412:(e,a,s)=>{s.d(a,{Z:()=>s3DeleteFiles}),s(21841);var i=s(73292);async function s3DeleteFiles(e){try{for(let a=0;a<e.length;a++){let s=e[a],t=`${process.cwd()}/public/uploads/${s.Key}`;await (0,i.unlink)(t)}}catch(e){console.log(e)}}process.env.AWS_BUCKET_NAME},11217:(e,a,s)=>{s.d(a,{c:()=>parseForm,t:()=>parseFormMultiple});let i=require("formidable");var t=s.n(i);function parseForm(e){return new Promise((a,s)=>{let i=t()({keepExtensions:!0,uploadDir:"./public/uploads"});i.parse(e,(e,i,t)=>{if(e)return s(e);a({field:i,file:t})})})}function parseFormMultiple(e){return new Promise((a,s)=>{let i=t()({multiples:!0,keepExtensions:!0,uploadDir:"./public/uploads"});i.parse(e,(e,i,t)=>{if(e)return s(e);a({field:i,file:t})})})}}};var a=require("../../webpack-api-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),s=a.X(0,[4222,9305,3808,8364],()=>__webpack_exec__(16783));module.exports=s})();