"use strict";(()=>{var e={};e.id=9485,e.ids=[9485],e.modules={21841:e=>{e.exports=require("@aws-sdk/client-s3")},3681:e=>{e.exports=require("custom-id-new")},11185:e=>{e.exports=require("mongoose")},60614:e=>{e.exports=require("next-auth/jwt")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},73292:e=>{e.exports=require("fs/promises")},8837:(e,a,s)=>{s.r(a),s.d(a,{config:()=>p,default:()=>g,routeModule:()=>w});var t={};s.r(t),s.d(t,{default:()=>apiHandler});var o=s(71802),i=s(47153),c=s(56249),r=s(3681),l=s.n(r),n=s(26412),u=s(58364),d=s(41396),m=s(13808);async function apiHandler(e,a){let{method:s}=e;if(!await (0,u.Z)(e,"pageSettings"))return a.status(403).json({success:!1,message:"Access Forbidden"});switch(await (0,m.Z)(),s){case"POST":try{let{query:s,body:t}=e,o=await d.Z.findOne({});switch(null===o&&(o=new d.Z({aboutPage:{content:""}})),s.scope){case"carousel":let{title:i,subTitle:c,description:r,url:u,image:m}=t,g={title:i,subTitle:c,description:r,url:u,image:m,id:l()({randomLength:4,lowerCase:!0})};o.homePage.carousel.carouselData.push(g),await o.save();break;case"background":let{background:p}=t,w=o.homePage.carousel.background[0].name!==p[0].name;if(w){let e=[{Key:o.homePage.carousel.background[0].name}];await (0,n.Z)(e)}o.homePage.carousel.background=p,await o.save();break;case"banner":let h=o.homePage.banner.image[0].name!==t.image[0].name;if(h){let e=[{Key:o.homePage.banner.image[0].name}];await (0,n.Z)(e)}let b={title:t.title,subTitle:t.subTitle,description:t.description,url:t.url,image:t.image};o.homePage.banner=b,await o.save();break;case"collection":let f=o.homePage.collection[s.dataScope],P=f.image[0]&&f.image[0].name!==t.image[0].name;if(P){let e=[{Key:f.image[0].name}];await (0,n.Z)(e)}let k={title:t.title,url:t.url,image:t.image};o.homePage.collection[s.dataScope]=k,await o.save();break;default:return a.status(400).json({success:!1})}a.status(200).json({success:!0})}catch(e){console.log(e),a.status(400).json({success:!1,err:e.message})}break;case"DELETE":try{let{query:s}=e,t=await d.Z.findOne({});if("carousel"===s.scope){let e=await t.homePage.carousel.carouselData.filter(e=>e.id===s.id),o=[{Key:e[0].image[0].name}];await (0,n.Z)(o),await d.Z.updateOne({},{$pull:{"homePage.carousel.carouselData":{id:s.id}}}),a.status(200).json({success:!0})}else a.status(400).json({success:!1})}catch(e){console.log(e),a.status(400).json({success:!1,err:e.message})}break;case"PUT":try{let{query:s}=e;if("carousel"===s.scope){let s=await d.Z.updateOne({"homePage.carousel.carouselData.id":e.body.id},{$set:{"homePage.carousel.carouselData.$":e.body}});a.status(200).json({success:s.modifiedCount>0})}else a.status(400).json({success:!1})}catch(e){console.log(e),a.status(400).json({success:!1,err:e.message})}break;default:a.status(400).json({success:!1})}}let g=(0,c.l)(t,"default"),p=(0,c.l)(t,"config"),w=new o.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/page/home",pathname:"/api/page/home",bundlePath:"",filename:""},userland:t})},26412:(e,a,s)=>{s.d(a,{Z:()=>s3DeleteFiles}),s(21841);var t=s(73292);async function s3DeleteFiles(e){try{for(let a=0;a<e.length;a++){let s=e[a],o=`${process.cwd()}/public/uploads/${s.Key}`;await (0,t.unlink)(o)}}catch(e){console.log(e)}}process.env.AWS_BUCKET_NAME}};var a=require("../../../webpack-api-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),s=a.X(0,[4222,9305,3808,8364],()=>__webpack_exec__(8837));module.exports=s})();