"use strict";(()=>{var e={};e.id=6925,e.ids=[6925],e.modules={11185:e=>{e.exports=require("mongoose")},60614:e=>{e.exports=require("next-auth/jwt")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},24651:(e,s,a)=>{a.r(s),a.d(s,{config:()=>y,default:()=>w,routeModule:()=>f});var d={};a.r(d),a.d(d,{default:()=>apiHandler});var t=a(71802),r=a(47153),u=a(56249),i=a(60614),o=a(11185),c=a(39305);let n=new o.Schema(c.Lk),l=o.models.address||(0,o.model)("address",n);var p=a(16572),_=a(13808);async function apiHandler(e,s){let{method:a}=e,d=process.env.AUTH_SECRET,t=await (0,i.getToken)({req:e,secret:d});if(!t)return s.status(403).json({success:!1,message:"Access Forbidden"});switch(await (0,_.Z)(),a){case"GET":try{let e=await p.Z.findById(t.user.id).populate("address",{__v:0,user:0,orders:0},null,{sort:{_id:-1}}).select({address:1});s.status(200).json({success:!0,user:e})}catch(e){console.log(e),s.status(500).json({success:!1})}break;case"POST":try{let a=e.body;a.user=t.user.id,"main address"===a.addressType&&await l.updateMany({user:t.user.id},{$set:{addressType:"address"}});let d=await l.create(a);await p.Z.updateOne({_id:t.user.id},{$push:{address:d._id}}),s.status(200).json({success:!0})}catch(e){console.log(e),s.status(500).json({success:!1})}break;case"PUT":try{let a=e.body;"main address"===a.addressType&&await l.updateMany({user:t.user.id},{$set:{addressType:"address"}});let d=await l.updateOne({_id:a._id},a);s.status(200).json({success:d.modifiedCount>0})}catch(e){console.log(e),s.status(500).json({success:!1})}break;case"DELETE":try{await l.findByIdAndDelete(e.body.id),await p.Z.updateOne({_id:t.user.id},{$pull:{address:e.body.id}}),s.status(200).json({success:!0})}catch(e){console.log(e),s.status(500).json({success:!1})}break;default:s.status(400).json({success:!1})}}let w=(0,u.l)(d,"default"),y=(0,u.l)(d,"config"),f=new t.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/profile/address",pathname:"/api/profile/address",bundlePath:"",filename:""},userland:d})}};var s=require("../../../webpack-api-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),a=s.X(0,[4222,9305,3808],()=>__webpack_exec__(24651));module.exports=a})();