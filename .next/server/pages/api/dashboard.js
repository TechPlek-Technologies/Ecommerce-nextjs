"use strict";(()=>{var e={};e.id=3222,e.ids=[3222],e.modules={11185:e=>{e.exports=require("mongoose")},60614:e=>{e.exports=require("next-auth/jwt")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},48817:(e,t,a)=>{a.r(t),a.d(t,{config:()=>w,default:()=>p,routeModule:()=>h});var r={};a.r(r),a.d(r,{default:()=>apiHandler});var o=a(71802),s=a(47153),n=a(56249),u=a(58364),d=a(37631),i=a(1112),c=a(88222),l=a(89821),$=a(10090),m=a(16572),g=a(13808);async function apiHandler(e,t){let{method:a}=e;if(!await (0,u.Z)(e,"general"))return t.status(403).json({success:!1,message:"Access Forbidden"});if(await (0,g.Z)(),"GET"===a)try{let e=new Date().getFullYear(),a=new Date(`${e}-01-01`),r=await $.Z.aggregate([{$match:{$and:[{orderDate:{$gte:a}}]}},{$group:{_id:{year:{$year:"$orderDate"},month:{$month:"$orderDate"}},results:{$count:{}}}}]),o=await $.Z.aggregate([{$match:{orderDate:{$gte:new Date(`${e}-01-01`),$lt:new Date(`${e+1}-01-01`)}}},{$group:{_id:{year:{$year:"$orderDate"},month:{$month:"$orderDate"}},total:{$sum:"$payAmount"}}},{$group:{_id:"$_id.year",monthlySales:{$push:{month:"$_id.month",total:"$total"}}}},{$project:{_id:0,year:"$_id",monthlySales:1}}]),s=await $.Z.aggregate([{$match:{orderDate:{$gte:new Date(`${e}-01-01`),$lt:new Date(`${e+1}-01-01`)}}},{$group:{_id:"$status",count:{$sum:1}}}]),n={year:e,orderCounts:{Pending:0,"In Progress":0,Packaged:0,Shipped:0,Delivered:0,Canceled:0}};s.forEach(e=>{let t=e._id,a=e.count;n.orderCounts[t]=a});let u=await $.Z.estimatedDocumentCount(),g=await m.Z.estimatedDocumentCount(),p=await i.Z.estimatedDocumentCount(),w=await c.Z.estimatedDocumentCount(),h=await l.Z.estimatedDocumentCount(),D=await d.Z.estimatedDocumentCount();t.status(200).json({success:!0,order:r,salesByMonth:o,totalOrder:u,totalUser:g,totalCategory:p,totalColor:w,totalCoupon:h,totalAttribute:D,orderCountByStatus:n})}catch(e){console.log(e),t.status(500).json({success:!1})}else t.status(400).json({success:!1})}let p=(0,n.l)(r,"default"),w=(0,n.l)(r,"config"),h=new o.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/dashboard",pathname:"/api/dashboard",bundlePath:"",filename:""},userland:r})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[4222,9305,3808,8364],()=>__webpack_exec__(48817));module.exports=a})();