"use strict";(()=>{var e={};e.id=8986,e.ids=[8986],e.modules={21841:e=>{e.exports=require("@aws-sdk/client-s3")},3681:e=>{e.exports=require("custom-id-new")},60614:e=>{e.exports=require("next-auth/jwt")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},77871:(e,s,t)=>{t.r(s),t.d(s,{config:()=>g,default:()=>m,routeModule:()=>w});var r={};t.r(r),t.d(r,{default:()=>apiHandler});var a=t(71802),n=t(47153),c=t(56249),i=t(3681),u=t.n(i),l=t(58364),o=t(21841);let d=require("@aws-sdk/s3-request-presigner"),p=process.env.AWS_REGION,_=process.env.AWS_BUCKET_NAME;process.env.AWS_ACCESS_KEY_ID,process.env.AWS_SECRET_ACCESS_KEY;let createPresignedUrlWithClient=async({region:e,bucket:s,key:t})=>{let r=new o.S3Client({region:e}),a=new o.PutObjectCommand({Bucket:s,Key:t});return(0,d.getSignedUrl)(r,a,{expiresIn:3600})};async function apiHandler(e,s){let{method:t}=e;if(!await (0,l.Z)(e,"general"))return s.status(403).json({success:!1,message:"Access Forbidden"});switch(t){case"POST":try{let{query:t}=e,r=u()({randomLength:7,lowerCase:!0})+t.name,a=await createPresignedUrlWithClient({region:p,bucket:_,key:r});s.status(200).json({success:!0,name:r,url:a})}catch(e){console.log(e),s.status(500).json({success:!1,err:e.message})}break;case"DELETE":try{let{query:t}=e,r=new o.S3Client({}),a=new o.DeleteObjectCommand({Bucket:_,Key:t.name});await r.send(a),s.status(200).json({success:!0,err:null})}catch(e){console.log(e),s.status(500).json({success:!1,err:e.message})}break;default:s.status(400).json({success:!1})}}let m=(0,c.l)(r,"default"),g=(0,c.l)(r,"config"),w=new a.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/fileupload/s3",pathname:"/api/fileupload/s3",bundlePath:"",filename:""},userland:r})}};var s=require("../../../webpack-api-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),t=s.X(0,[4222,8364],()=>__webpack_exec__(77871));module.exports=t})();