(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6921],{78360:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/checkout/paypal",function(){return r(8934)}])},8934:function(e,t,r){"use strict";r.r(t);var c=r(85893),n=r(11163),s=r(67294),a=r(25617),o=r(22920),i=r(2022),u=r(58210),d=r(9990),p=r.n(d);let PaypalCheckout=()=>{let e=(0,n.useRouter)(),[t,r]=(0,s.useState)(!1),d=(0,s.useRef)(),l=(0,a.I0)(),h=(0,a.v9)(e=>e.cart),y=(0,a.v9)(e=>e.settings),m=y.settingsData.currency.exchangeRate,_=(0,i.rQ)(h.items.reduce((e,t)=>e+t.qty*t.price,0)),f=h.coupon.discount/100*_,w=(0,i.rQ)(h.items.reduce((e,t)=>e+(0,i.dA)(t.qty*t.price,t.vat),0)),g=(0,i.rQ)(h.items.reduce((e,t)=>e+(0,i.dA)(t.qty*t.price,t.tax),0)),v=_+w+g+(h.deliveryInfo.cost||0)-f,k=(0,i.m3)(v,m),processOrder=async t=>{try{let{coupon:r,items:c,billingInfo:n,shippingInfo:s,deliveryInfo:a}=h,d={coupon:r,products:c,billingInfo:n,shippingInfo:s,deliveryInfo:a,paymentData:{method:"Paypal",id:t.id}},p=new FormData;p.append("checkoutData",JSON.stringify(d));let y=await (0,i.qC)("/api/order/new",p);y&&y.success?(l((0,u.s9)()),o.toast.success("Order successfully placed"),setTimeout(()=>{e.push("/checkout/success/".concat(y.createdOrder._id))},700)):o.toast.error("Something Went Wrong (500)")}catch(e){o.toast.error("Something Went Wrong ".concat(e)),console.log(e)}};return((0,s.useEffect)(()=>{let e=document.createElement("script");e.src="https://www.paypal.com/sdk/js?client-id=".concat(""),e.addEventListener("load",()=>r(!0)),document.body.appendChild(e)},[]),(0,s.useEffect)(()=>{t&&v>0&&m>0&&window.paypal.Buttons({createOrder:(e,t)=>t.order.create({purchase_units:[{description:"",amount:{currency_code:"USD",value:k}}]}),onApprove:async(e,t)=>{let r=await t.order.capture();o.toast.info("Processing Order"),await processOrder(r)},onError:e=>{o.toast.error(e),console.error(e)}}).render(d.current)},[t,v,m]),h&&h.items.length>0)?(0,c.jsx)(c.Fragment,{children:(0,c.jsx)("div",{className:"layout_top",children:(0,c.jsxs)("div",{className:p().container,children:[(0,c.jsx)("h2",{className:p().h2,children:"Pay Now"}),(0,c.jsx)("div",{ref:d})]})})}):null};PaypalCheckout.footer=!1,t.default=PaypalCheckout},9990:function(e){e.exports={container:"payment_container__8lFBc",h2:"payment_h2__vJpws"}},11163:function(e,t,r){e.exports=r(59974)}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=78360)}),_N_E=e.O()}]);