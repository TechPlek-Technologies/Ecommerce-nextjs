(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9074,8214],{37082:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/checkout/razorpay",function(){return a(34221)}])},18214:function(e,t,a){"use strict";a.r(t);var n=a(85893),r=a(31183),o=a.n(r);t.default=e=>{let{color:t}=e;return(0,n.jsx)("div",{className:o().container,children:(0,n.jsx)("div",{className:o().spinner})})}},34221:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return RazorPay}});var n=a(85893),r=a(11163),o=a(67294),s=a(25617),c=a(22920),i=a(18214),l=a(2022),u=a(58210),p=a(9990),d=a.n(p);function RazorPay(){let[e,t]=(0,o.useState)(!1),a=(0,s.v9)(e=>e.cart),p=(0,s.v9)(e=>e.settings),m=Number(p.settingsData.currency.exchangeRate),h=(0,s.I0)(),y=(0,r.useRouter)(),processOrder=async e=>{try{let{coupon:t,items:n,billingInfo:r,shippingInfo:o,deliveryInfo:s}=a,i=new FormData;i.append("checkoutData",JSON.stringify({coupon:t,products:n,billingInfo:r,shippingInfo:o,deliveryInfo:s,paymentData:{method:"Razorpay",id:e}}));let p=await (0,l.qC)("/api/order/new",i);p&&p.success?(h((0,u.s9)()),c.toast.success("Order successfully placed"),setTimeout(()=>{y.push("/checkout/success/".concat(p.createdOrder._id))},2e3)):c.toast.error("Something Went Wrong (500)")}catch(e){c.toast.error("Something Went Wrong ".concat(e.message)),console.log(e)}},loadRazorpay=()=>new Promise(e=>{let t=document.createElement("script");t.src="https://checkout.razorpay.com/v1/checkout.js",t.onload=()=>{e(!0)},t.onerror=()=>{e(!1)},document.body.appendChild(t)}),createPayment=async()=>{if(0===a.items.length){c.toast.error("Illegal request, please add items to the card then make the payment");return}t(!0);let e=await loadRazorpay();if(t(!1),!e){c.toast.error("Razorpay SDK Failed to load");return}let n=await (0,l.qC)("/api/checkout/razorpay",{cartData:a,exchangeRate:m}),r={key:"",name:p.settingsData.name,currency:n.currency,amount:n.amount,order_id:n.id,description:"".concat(p.settingsData.name," Transaction"),image:p.settingsData.logo[0].url,handler:async function(e){c.toast.success("Payment succeeded!"),await processOrder(e.razorpay_payment_id)},prefill:{name:a.billingInfo.fullName,email:a.billingInfo.email,contact:a.billingInfo.phone},theme:{color:p.settingsData.color.primary}},o=new window.Razorpay(r);o.open(),o.on("payment.failed",function(e){console.log(e),c.toast.error("Your payment was not successful, please try again. - ".concat(e.error.reason))})};return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:"layout_top",children:(0,n.jsxs)("div",{className:"App text-center",children:[e&&(0,n.jsx)("div",{style:{height:"70vh"},children:(0,n.jsx)(i.default,{})}),!e&&(0,n.jsxs)("div",{className:d().container,children:[(0,n.jsx)("h2",{className:d().h2,children:"Pay Now"}),(0,n.jsx)("button",{className:"btn btn-primary fw-bold",onClick:createPayment,children:"Pay with Razorpay"})]})]})})})}RazorPay.footer=!1},31183:function(e){e.exports={container:"spinner_container__Ce8dH",spinner:"spinner_spinner__eipLJ",spin:"spinner_spin__LDwbh"}},9990:function(e){e.exports={container:"payment_container__8lFBc",h2:"payment_h2__vJpws"}},11163:function(e,t,a){e.exports=a(59974)}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=37082)}),_N_E=e.O()}]);