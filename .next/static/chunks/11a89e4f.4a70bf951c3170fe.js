"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5714],{89794:function(e,t,n){n.d(t,{Z:function(){return __WEBPACK_DEFAULT_EXPORT__}});var i=n(88632),l=n(72358),o=n(71379),s=n(23051),r=n(68882);function __WEBPACK_DEFAULT_EXPORT__(e,t,n,a,d,c){let h=e.element.originElement.ownerDocument||document,f=h.defaultView||window,u=s.Z,g=d.icons,m={_d:h,_w:f,_parser:new f.DOMParser,_prevRtl:d.rtl,_editorHeight:0,_editorHeightPadding:0,_listCamel:d.__listCommonStyle,_listKebab:u.camelToKebabCase(d.__listCommonStyle),_wd:null,_ww:null,_shadowRoot:null,_shadowRootControllerEventTarget:null,util:u,functions:null,options:null,wwComputedStyle:null,notice:r.Z,icons:g,history:null,context:e,pluginCallButtons:t,plugins:n||{},initPlugins:{},_targetPlugins:{},_menuTray:{},lang:a,effectNode:null,submenu:null,container:null,_submenuName:"",_bindedSubmenuOff:null,_bindedContainerOff:null,submenuActiveButton:null,containerActiveButton:null,controllerArray:[],currentControllerName:"",currentControllerTarget:null,currentFileComponentInfo:null,codeViewDisabledButtons:[],resizingDisabledButtons:[],_moreLayerActiveButton:null,_htmlCheckWhitelistRegExp:null,_htmlCheckBlacklistRegExp:null,_disallowedTextTagsRegExp:null,editorTagsWhitelistRegExp:null,editorTagsBlacklistRegExp:null,pasteTagsWhitelistRegExp:null,pasteTagsBlacklistRegExp:null,hasFocus:!1,isDisabled:!1,isReadOnly:!1,_attributesWhitelistRegExp:null,_attributesWhitelistRegExp_all_data:null,_attributesBlacklistRegExp:null,_attributesTagsWhitelist:null,_attributesTagsBlacklist:null,_bindControllersOff:null,_isInline:null,_isBalloon:null,_isBalloonAlways:null,_inlineToolbarAttr:{top:"",width:"",isShow:!1},_notHideToolbar:!1,_sticky:!1,_antiBlur:!1,_lineBreaker:null,_lineBreakerButton:null,_componentsInfoInit:!0,_componentsInfoReset:!1,activePlugins:null,managedTagsInfo:null,_charTypeHTML:!1,_fileInfoPluginsCheck:null,_fileInfoPluginsReset:null,_fileManager:{tags:null,regExp:null,queryString:null,pluginRegExp:null,pluginMap:null},commandMap:{},_commandMapStyles:{STRONG:["font-weight"],U:["text-decoration"],EM:["font-style"],DEL:["text-decoration"]},_styleCommandMap:null,_cleanStyleRegExp:{span:new f.RegExp("\\s*[^-a-zA-Z](font-family|font-size|color|background-color)\\s*:[^;]+(?!;)*","ig"),format:new f.RegExp("\\s*[^-a-zA-Z](text-align|margin-left|margin-right)\\s*:[^;]+(?!;)*","ig"),fontSizeUnit:new f.RegExp("\\d+"+d.fontSizeUnit+"$","i")},_variable:{isChanged:!1,isCodeView:!1,isFullScreen:!1,innerHeight_fullScreen:0,resizeClientY:0,tabSize:4,codeIndent:2,minResizingSize:u.getNumber(e.element.wysiwygFrame.style.minHeight||"65",0),currentNodes:[],currentNodesMap:[],_range:null,_selectionNode:null,_originCssText:e.element.topArea.style.cssText,_bodyOverflow:"",_editorAreaOriginCssText:"",_wysiwygOriginCssText:"",_codeOriginCssText:"",_fullScreenAttrs:{sticky:!1,balloon:!1,inline:!1},_lineBreakComp:null,_lineBreakDir:""},_formatAttrsTemp:null,_saveButtonStates:function(){this.allCommandButtons||(this.allCommandButtons={});let e=this.context.element._buttonTray.querySelectorAll(".se-menu-list button[data-display]");for(let t=0,n,i;t<e.length;t++)i=(n=e[t]).getAttribute("data-command"),this.allCommandButtons[i]=n},_recoverButtonStates:function(){if(this.allCommandButtons){let e=this.context.element._buttonTray.querySelectorAll(".se-menu-list button[data-display]");for(let t=0,n,i,l;t<e.length;t++)i=(n=e[t]).getAttribute("data-command"),(l=this.allCommandButtons[i])&&(n.parentElement.replaceChild(l,n),this.context.tool[i]&&(this.context.tool[i]=l))}},callPlugin:function(e,n,i){if(i=i||t[e],this.plugins[e])this.initPlugins[e]?"object"==typeof this._targetPlugins[e]&&i&&this.initMenuTarget(e,i,this._targetPlugins[e]):(this.plugins[e].add(this,i),this.initPlugins[e]=!0);else throw Error('[SUNEDITOR.core.callPlugin.fail] The called plugin does not exist or is in an invalid format. (pluginName:"'+e+'")');this.plugins[e].active&&!this.commandMap[e]&&i&&(this.commandMap[e]=i,this.activePlugins.push(e)),"function"==typeof n&&n()},addModule:function(e){for(let t=0,n=e.length,i;t<n;t++)i=e[t].name,this.plugins[i]||(this.plugins[i]=e[t]),this.initPlugins[i]||(this.initPlugins[i]=!0,"function"==typeof this.plugins[i].add&&this.plugins[i].add(this))},getGlobalScrollOffset:function(){let t=0,n=0,i=e.element.topArea;for(;i;)t+=i.scrollTop,n+=i.scrollLeft,i=i.parentElement;for(i=this._shadowRoot?this._shadowRoot.host:null;i;)t+=i.scrollTop,n+=i.scrollLeft,i=i.parentElement;return{top:t,left:n}},initMenuTarget:function(t,n,i){n?(e.element._menuTray.appendChild(i),this._targetPlugins[t]=!0,this._menuTray[n.getAttribute("data-command")]=i):this._targetPlugins[t]=i},submenuOn:function(e){this._bindedSubmenuOff&&this._bindedSubmenuOff(),this._bindControllersOff&&this.controllersOff();let t=this._submenuName=e.getAttribute("data-command"),n=this.submenu=this._menuTray[t];this.submenuActiveButton=e,this._setMenuPosition(e,n),this._bindedSubmenuOff=this.submenuOff.bind(this),this.addDocEvent("mousedown",this._bindedSubmenuOff,!1),this.plugins[t].on&&this.plugins[t].on.call(this),this._antiBlur=!0},submenuOff:function(){this.removeDocEvent("mousedown",this._bindedSubmenuOff),this._bindedSubmenuOff=null,this.submenu&&(this._submenuName="",this.submenu.style.display="none",this.submenu=null,u.removeClass(this.submenuActiveButton,"on"),this.submenuActiveButton=null,this._notHideToolbar=!1),this._antiBlur=!1},moreLayerOff:function(){if(this._moreLayerActiveButton){let t=e.element.toolbar.querySelector("."+this._moreLayerActiveButton.getAttribute("data-command"));t.style.display="none",u.removeClass(this._moreLayerActiveButton,"on"),this._moreLayerActiveButton=null}},containerOn:function(e){this._bindedContainerOff&&this._bindedContainerOff();let t=this._containerName=e.getAttribute("data-command"),n=this.container=this._menuTray[t];this.containerActiveButton=e,this._setMenuPosition(e,n),this._bindedContainerOff=this.containerOff.bind(this),this.addDocEvent("mousedown",this._bindedContainerOff,!1),this.plugins[t].on&&this.plugins[t].on.call(this),this._antiBlur=!0},containerOff:function(){this.removeDocEvent("mousedown",this._bindedContainerOff),this._bindedContainerOff=null,this.container&&(this._containerName="",this.container.style.display="none",this.container=null,u.removeClass(this.containerActiveButton,"on"),this.containerActiveButton=null,this._notHideToolbar=!1),this._antiBlur=!1},_setMenuPosition:function(t,n){n.style.visibility="hidden",n.style.display="block",n.style.height="",u.addClass(t,"on");let i=this.context.element.toolbar,l=i.offsetWidth,o=p._getEditorOffsets(e.element.toolbar),s=n.offsetWidth,r=t.parentElement.offsetLeft+3;if(d.rtl){let e=t.offsetWidth,i=s>e?s-e:0;n.style.left=r-i+(i>0?0:e-s)+"px",o.left>p._getEditorOffsets(n).left&&(n.style.left="0px")}else{let e=l<=s?0:l-(r+s);e<0?n.style.left=r+e+"px":n.style.left=r+"px"}let a=0,c=t;for(;c&&c!==i;)a+=c.offsetTop,c=c.offsetParent;let h=a;this._isBalloon?a+=i.offsetTop+t.offsetHeight:a-=t.offsetHeight;let g=o.top,m=n.offsetHeight,y=this.getGlobalScrollOffset().top,C=f.innerHeight-(g-y+h+t.parentElement.offsetHeight);if(C<m){let e=-1*(m-h+3),i=g-y+e,l=m+(i<0?i:0);l>C?(n.style.height=l+"px",e=-1*(l-h+3)):(n.style.height=C+"px",e=h+t.parentElement.offsetHeight),n.style.top=e+"px"}else n.style.top=h+t.parentElement.offsetHeight+"px";n.style.visibility=""},controllersOn:function(){this._bindControllersOff&&this._bindControllersOff(),this.controllerArray=[];for(let e=0,t;e<arguments.length;e++)if(t=arguments[e]){if("string"==typeof t){this.currentControllerName=t;continue}if("function"==typeof t){this.controllerArray.push(t);continue}if(!u.hasClass(t,"se-controller")){this.currentControllerTarget=t,this.currentFileComponentInfo=this.getFileComponent(t);continue}t.style&&(t.style.display="block",this._shadowRoot&&-1===this._shadowRootControllerEventTarget.indexOf(t)&&(t.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation()}),this._shadowRootControllerEventTarget.push(t))),this.controllerArray.push(t)}this._bindControllersOff=this.controllersOff.bind(this),this.addDocEvent("mousedown",this._bindControllersOff,!1),this.addDocEvent("keydown",this._bindControllersOff,!1),this._antiBlur=!0,"function"==typeof y.showController&&y.showController(this.currentControllerName,this.controllerArray,this)},controllersOff:function(t){this._lineBreaker.style.display="none";let n=this.controllerArray.length;if(t&&t.target&&n>0){for(let e=0;e<n;e++)if("function"==typeof this.controllerArray[e].contains&&this.controllerArray[e].contains(t.target))return}if((!this._fileManager.pluginRegExp.test(this.currentControllerName)||!t||"keydown"!==t.type||27===t.keyCode)&&(e.element.lineBreaker_t.style.display=e.element.lineBreaker_b.style.display="none",this._variable._lineBreakComp=null,this.currentControllerName="",this.currentControllerTarget=null,this.currentFileComponentInfo=null,this.effectNode=null,this._bindControllersOff)){if(this.removeDocEvent("mousedown",this._bindControllersOff),this.removeDocEvent("keydown",this._bindControllersOff),this._bindControllersOff=null,n>0){for(let e=0;e<n;e++)"function"==typeof this.controllerArray[e]?this.controllerArray[e]():this.controllerArray[e].style.display="none";this.controllerArray=[]}this._antiBlur=!1}},setControllerPosition:function(t,n,i,l){d.rtl&&(l.left*=-1);let o=u.getOffset(n,e.element.wysiwygFrame);t.style.visibility="hidden",t.style.display="block";let s="top"===i?-(t.offsetHeight+2):n.offsetHeight+12;t.style.top=o.top+s+l.top+"px";let r=o.left-e.element.wysiwygFrame.scrollLeft+l.left,a=t.offsetWidth,c=n.offsetWidth,h=u.hasClass(t.firstElementChild,"se-arrow")?t.firstElementChild:null;if(d.rtl){let n=a>c?a-c:0;t.style.left=r-n+(n>0?0:c-a)+"px",n>0&&h&&(h.style.left=(a-14<10+n?a-14:10+n)+"px");let i=e.element.wysiwygFrame.offsetLeft-t.offsetLeft;i>0&&(t.style.left="0px",h&&(h.style.left=i+"px"))}else{t.style.left=r+"px";let n=e.element.wysiwygFrame.offsetWidth-(t.offsetLeft+a);n<0?(t.style.left=t.offsetLeft+n+"px",h&&(h.style.left=20-n+"px")):h&&(h.style.left="20px")}t.style.visibility=""},execCommand:function(e,t,n){this._wd.execCommand(e,t,"formatBlock"===e?"<"+n+">":n),this.history.push(!0)},nativeFocus:function(){this.__focus(),this._editorRange()},__focus:function(){let t=u.getParentElement(this.getSelectionNode(),"figcaption");t?t.focus():e.element.wysiwyg.focus()},focus:function(){if("none"!==e.element.wysiwygFrame.style.display){if(d.iframe)this.nativeFocus();else try{let t=this.getRange();if(t.startContainer===t.endContainer&&u.isWysiwygDiv(t.startContainer)){let n=t.commonAncestorContainer.children[t.startOffset];if(!u.isFormatElement(n)&&!u.isComponent(n)){let t=u.createElement(d.defaultTag),i=u.createElement("BR");t.appendChild(i),e.element.wysiwyg.insertBefore(t,n),this.setRange(i,0,i,0);return}}this.setRange(t.startContainer,t.startOffset,t.endContainer,t.endOffset)}catch(e){this.nativeFocus()}p._applyTagEffects(),this._isBalloon&&p._toggleToolbarBalloon()}},focusEdge:function(t){t||(t=e.element.wysiwyg.lastElementChild);let n=this.getFileComponent(t);n?this.selectComponent(n.target,n.pluginName):t?(t=u.getChildElement(t,function(e){return 0===e.childNodes.length||3===e.nodeType},!0))?this.setRange(t,t.textContent.length,t,t.textContent.length):this.nativeFocus():this.focus()},blur:function(){d.iframe?e.element.wysiwygFrame.blur():e.element.wysiwyg.blur()},setRange:function(e,t,n,i){if(!e||!n)return;t>e.textContent.length&&(t=e.textContent.length),i>n.textContent.length&&(i=n.textContent.length),u.isFormatElement(e)&&(e=e.childNodes[t]||e.childNodes[t-1]||e,t=t>0?1===e.nodeType?1:e.textContent?e.textContent.length:0:0),u.isFormatElement(n)&&(n=n.childNodes[i]||n.childNodes[i-1]||n,i=i>0?1===n.nodeType?1:n.textContent?n.textContent.length:0:0);let l=this._wd.createRange();try{l.setStart(e,t),l.setEnd(n,i)}catch(e){console.warn("[SUNEDITOR.core.focus.error] "+e),this.nativeFocus();return}let o=this.getSelection();return o.removeAllRanges&&o.removeAllRanges(),o.addRange(l),this._rangeInfo(l,this.getSelection()),d.iframe&&this.__focus(),l},removeRange:function(){this._variable._range=null,this._variable._selectionNode=null,this.hasFocus&&this.getSelection().removeAllRanges(),this._setKeyEffect([])},getRange:function(){let t=this._variable._range||this._createDefaultRange(),n=this.getSelection();if(t.collapsed===n.isCollapsed||!e.element.wysiwyg.contains(n.focusNode))return t;if(n.rangeCount>0)return this._variable._range=n.getRangeAt(0),this._variable._range;{let e=n.anchorNode,t=n.focusNode,i=n.anchorOffset,l=n.focusOffset,o=u.compareElements(e,t),s=o.ancestor&&(0===o.result?i<=l:o.result>1);return this.setRange(s?e:t,s?i:l,s?t:e,s?l:i)}},getRange_addLine:function(t,n){if(this._selectionVoid(t)){let i=e.element.wysiwyg,l=u.createElement(d.defaultTag);l.innerHTML="<br>",i.insertBefore(l,n&&n!==i?n.nextElementSibling:i.firstElementChild),this.setRange(l.firstElementChild,0,l.firstElementChild,1),t=this._variable._range}return t},getSelection:function(){let t=this._shadowRoot&&this._shadowRoot.getSelection?this._shadowRoot.getSelection():this._ww.getSelection();return this._variable._range||e.element.wysiwyg.contains(t.focusNode)||(t.removeAllRanges(),t.addRange(this._createDefaultRange())),t},getSelectionNode:function(){if(e.element.wysiwyg.contains(this._variable._selectionNode)||this._editorRange(),!this._variable._selectionNode){let t=u.getChildElement(e.element.wysiwyg.firstChild,function(e){return 0===e.childNodes.length||3===e.nodeType},!1);if(t)return this._variable._selectionNode=t,t;this._editorRange()}return this._variable._selectionNode},_editorRange:function(){let e=this.getSelection();if(!e)return null;let t=null;t=e.rangeCount>0?e.getRangeAt(0):this._createDefaultRange(),u.isFormatElement(t.endContainer)&&0===t.endOffset&&(t=this.setRange(t.startContainer,t.startOffset,t.startContainer,t.startContainer.length)),this._rangeInfo(t,e)},_rangeInfo:function(e,t){let n=null;this._variable._range=e,n=e.collapsed?u.isWysiwygDiv(e.commonAncestorContainer)&&e.commonAncestorContainer.children[e.startOffset]||e.commonAncestorContainer:t.extentNode||t.anchorNode,this._variable._selectionNode=n},_createDefaultRange:function(){let t=e.element.wysiwyg,n=this._wd.createRange(),i=t.firstElementChild,l=null;return i?(l=i.firstChild)||(l=u.createElement("BR"),i.appendChild(l)):(i=u.createElement(d.defaultTag),l=u.createElement("BR"),i.appendChild(l),t.appendChild(i)),n.setStart(l,0),n.setEnd(l,0),n},_selectionVoid:function(e){let t=e.commonAncestorContainer;return u.isWysiwygDiv(e.startContainer)&&u.isWysiwygDiv(e.endContainer)||/FIGURE/i.test(t.nodeName)||this._fileManager.regExp.test(t.nodeName)||u.isMediaComponent(t)},_resetRangeToTextNode:function(){let t,n,i;let l=this.getRange();if(this._selectionVoid(l))return!1;let o=l.startContainer,s=l.startOffset,r=l.endContainer,a=l.endOffset;if(u.isFormatElement(o))for(o.childNodes[s]?(o=o.childNodes[s]||o,s=0):s=(o=o.lastChild||o).textContent.length;o&&1===o.nodeType&&o.firstChild;)o=o.firstChild||o,s=0;if(u.isFormatElement(r)){for(r=r.childNodes[a]||r.lastChild||r;r&&1===r.nodeType&&r.lastChild;)r=r.lastChild;a=r.textContent.length}if(t=u.isWysiwygDiv(o)?e.element.wysiwyg.firstChild:o,n=s,u.isBreak(t)||1===t.nodeType&&t.childNodes.length>0){let e=u.isBreak(t);if(!e){for(;t&&!u.isBreak(t)&&1===t.nodeType;)t=t.childNodes[n]||t.nextElementSibling||t.nextSibling,n=0;let e=u.getFormatElement(t,null);e===u.getRangeFormatElement(e,null)&&(e=u.createElement(u.getParentElement(t,u.isCell)?"DIV":d.defaultTag),t.parentNode.insertBefore(e,t),e.appendChild(t))}if(u.isBreak(t)){let n=u.createTextNode(u.zeroWidthSpace);t.parentNode.insertBefore(n,t),t=n,e&&o===r&&(r=t,a=1)}}if(o=t,s=n,t=u.isWysiwygDiv(r)?e.element.wysiwyg.lastChild:r,n=a,u.isBreak(t)||1===t.nodeType&&t.childNodes.length>0){let e=u.isBreak(t);if(!e){for(;t&&!u.isBreak(t)&&1===t.nodeType&&0!==(i=t.childNodes).length;)t=i[n>0?n-1:n]||!/FIGURE/i.test(i[0].nodeName)?i[0]:t.previousElementSibling||t.previousSibling||o,n=n>0?t.textContent.length:n;let e=u.getFormatElement(t,null);e===u.getRangeFormatElement(e,null)&&(e=u.createElement(u.isCell(e)?"DIV":d.defaultTag),t.parentNode.insertBefore(e,t),e.appendChild(t))}if(u.isBreak(t)){let i=u.createTextNode(u.zeroWidthSpace);t.parentNode.insertBefore(i,t),t=i,n=1,e&&!t.previousSibling&&u.removeItem(r)}}return r=t,a=n,this.setRange(o,s,r,a),!0},getSelectedElements:function(t){if(!this._resetRangeToTextNode())return[];let n=this.getRange();if(u.isWysiwygDiv(n.startContainer)){let t=e.element.wysiwyg.children;if(0===t.length)return[];this.setRange(t[0],0,t[t.length-1],t[t.length-1].textContent.trim().length),n=this.getRange()}let i=n.startContainer,l=n.endContainer,o=n.commonAncestorContainer,s=u.getListChildren(o,function(e){return t?t(e):u.isFormatElement(e)});if(u.isWysiwygDiv(o)||u.isRangeFormatElement(o)||s.unshift(u.getFormatElement(o,null)),i===l||1===s.length)return s;let r=u.getFormatElement(i,null),a=u.getFormatElement(l,null),d=null,c=null,onlyTable=function(e){return!u.isTable(e)||/^TABLE$/i.test(e.nodeName)},h=u.getRangeFormatElement(r,onlyTable),f=u.getRangeFormatElement(a,onlyTable);u.isTable(h)&&u.isListCell(h.parentNode)&&(h=h.parentNode),u.isTable(f)&&u.isListCell(f.parentNode)&&(f=f.parentNode);let g=h===f;for(let e=0,t=s.length,n;e<t;e++){if(r===(n=s[e])||!g&&n===h){d=e;continue}if(a===n||!g&&n===f){c=e;break}}return null===d&&(d=0),null===c&&(c=s.length-1),s.slice(d,c+1)},getSelectedElementsAndComponents:function(e){let t=this.getRange().commonAncestorContainer,n=u.getParentElement(t,u.isComponent),i=u.isTable(t)?this.getSelectedElements(null):this.getSelectedElements((function(e){let t=this.getParentElement(e,this.isComponent);return this.isFormatElement(e)&&(!t||t===n)||this.isComponent(e)&&!this.getFormatElement(e)}).bind(u));if(e){for(let e=0,t=i.length;e<t;e++)for(let n=e-1;n>=0;n--)if(i[n].contains(i[e])){i.splice(e,1),e--,t--;break}}return i},isEdgePoint:function(e,t,n){return"end"!==n&&0===t||(!n||"front"!==n)&&!e.nodeValue&&1===t||(!n||"end"===n)&&!!e.nodeValue&&t===e.nodeValue.length},_isEdgeFormat:function(e,t,n){if(!this.isEdgePoint(e,t,n))return!1;let i=[];for(n="front"===n?"previousSibling":"nextSibling";e&&!u.isFormatElement(e)&&!u.isWysiwygDiv(e);){if(!(!e[n]||u.isBreak(e[n])&&!e[n][n]))return null;1===e.nodeType&&i.push(e.cloneNode(!1)),e=e.parentNode}return i},showLoading:function(){e.element.loading.style.display="block"},closeLoading:function(){e.element.loading.style.display="none"},appendFormatTag:function(e,t){if(!e||!e.parentNode)return null;let n=u.getFormatElement(this.getSelectionNode(),null),i=null;if(!u.isFormatElement(e)&&u.isFreeFormatElement(n||e.parentNode))i=u.createElement("BR");else{let e=t?"string"==typeof t?t:t.nodeName:!u.isFormatElement(n)||u.isRangeFormatElement(n)||u.isFreeFormatElement(n)?d.defaultTag:n.nodeName;(i=u.createElement(e)).innerHTML="<br>",(t&&"string"!=typeof t||!t&&u.isFormatElement(n))&&u.copyTagAttributes(i,t||n,["id"])}return u.isCell(e)?e.insertBefore(i,e.nextElementSibling):e.parentNode.insertBefore(i,e.nextElementSibling),i},insertComponent:function(e,t,n,i){if(this.isReadOnly||n&&!this.checkCharCount(e,null))return null;let l=this.removeNode();this.getRange_addLine(this.getRange(),l.container);let o=null,s=this.getSelectionNode(),r=u.getFormatElement(s,null);if(u.isListCell(r))this.insertNode(e,s===r?null:l.container.nextSibling,!1),e.nextSibling||e.parentNode.appendChild(u.createElement("BR"));else{if(this.getRange().collapsed&&(3===l.container.nodeType||u.isBreak(l.container))){let e=u.getParentElement(l.container,(function(e){return this.isRangeFormatElement(e)}).bind(u));(o=u.splitElement(l.container,l.offset,e?u.getElementDepth(e)+1:0))&&(r=o.previousSibling)}this.insertNode(e,u.isRangeFormatElement(r)?null:r,!1),r&&u.onlyZeroWidthSpace(r)&&u.removeItem(r)}if(!i){this.setRange(e,0,e,0);let t=this.getFileComponent(e);t?this.selectComponent(t.target,t.pluginName):o&&(o=u.getEdgeChildNodes(o,null).sc||o,this.setRange(o,0,o,0))}return t||this.history.push(1),o||e},getFileComponent:function(e){let t,n;return this._fileManager.queryString&&e&&((/^FIGURE$/i.test(e.nodeName)||/se-component/.test(e.className))&&(t=e.querySelector(this._fileManager.queryString)),!t&&e.nodeName&&this._fileManager.regExp.test(e.nodeName)&&(t=e),t&&(n=this._fileManager.pluginMap[t.nodeName.toLowerCase()]))?{target:t,component:u.getParentElement(t,u.isComponent),pluginName:n}:null},selectComponent:function(e,t){if(u.isUneditableComponent(u.getParentElement(e,u.isComponent))||u.isUneditableComponent(e))return!1;this.hasFocus||this.focus();let n=this.plugins[t];n&&f.setTimeout((function(){"function"==typeof n.select&&this.callPlugin(t,n.select.bind(this,e),null),this._setComponentLineBreaker(e)}).bind(this))},_setComponentLineBreaker:function(t){let n,i,l;this._lineBreaker.style.display="none";let o=u.getParentElement(t,u.isComponent),s=e.element.lineBreaker_t.style,r=e.element.lineBreaker_b.style,a="block"===this.context.resizing.resizeContainer.style.display?this.context.resizing.resizeContainer:t,d=u.isListCell(o.parentNode);(d?o.previousSibling:u.isFormatElement(o.previousElementSibling))?s.display="none":(this._variable._lineBreakComp=o,i=e.element.wysiwyg.scrollTop,n=u.getOffset(t,e.element.wysiwygFrame).top+i,l=a.offsetWidth/2/2,s.top=n-i-12+"px",s.left=u.getOffset(a).left+l+"px",s.display="block"),(d?o.nextSibling:u.isFormatElement(o.nextElementSibling))?r.display="none":(n||(this._variable._lineBreakComp=o,i=e.element.wysiwyg.scrollTop,n=u.getOffset(t,e.element.wysiwygFrame).top+i,l=a.offsetWidth/2/2),r.top=n+a.offsetHeight-i-12+"px",r.left=u.getOffset(a).left+a.offsetWidth-l-24+"px",r.display="block")},_checkDuplicateNode:function(e,t){!function recursionFunc(e){m._dupleCheck(e,t);let n=e.childNodes;for(let e=0,t=n.length;e<t;e++)recursionFunc(n[e])}(e)},_dupleCheck:function(e,t){if(!u.isTextStyleElement(e))return;let n=(e.style.cssText.match(/[^;]+;/g)||[]).map(function(e){return e.trim()}),i=e.nodeName;if(/^span$/i.test(i)&&0===n.length)return e;let l=!1;return!function recursionFunc(t){if(!u.isWysiwygDiv(t)&&u.isTextStyleElement(t)){if(t.nodeName===i){l=!0;let i=t.style.cssText.match(/[^;]+;/g)||[];for(let e=0,t=i.length,l;e<t;e++)(l=n.indexOf(i[e].trim()))>-1&&n.splice(l,1);for(let n=0,i=t.classList.length;n<i;n++)e.classList.remove(t.classList[n])}recursionFunc(t.parentElement)}}(t),l&&((e.style.cssText=n.join(" "))||(e.setAttribute("style",""),e.removeAttribute("style")),e.attributes.length||e.setAttribute("data-se-duple","true")),e},insertNode:function(t,n,i){if(this.isReadOnly||i&&!this.checkCharCount(t,null))return null;let l=this.getRange(),o=u.isListCell(l.commonAncestorContainer)?l.commonAncestorContainer:u.getFormatElement(this.getSelectionNode(),null),s=u.isListCell(o)&&(u.isListCell(t)||u.isList(t)),r,a,c,h=null,f=u.isFreeFormatElement(o),g=!f&&(u.isFormatElement(t)||u.isRangeFormatElement(t))||u.isComponent(t);if(s&&(c=n||u.isList(t)?o.lastChild:o.nextElementSibling,h=u.isList(t)?o:(c||o).parentNode),!n&&(g||u.isComponent(t)||u.isMedia(t))){let e=this.isEdgePoint(l.endContainer,l.endOffset,"end"),t=this.removeNode(),i=t.container,r=i===t.prevContainer&&l.collapsed?null:t.prevContainer;if(s&&r){if((h=3===r.nodeType?r.parentNode:r).contains(i)){let e=!0;for(c=i;c.parentNode&&c.parentNode!==h;)c=c.parentNode,e=!1;e&&i===r&&(c=c.nextSibling)}else c=null}else if(s&&u.isListCell(i)&&!o.parentElement)o=u.createElement("LI"),h.appendChild(o),i.appendChild(h),c=null;else if(3===i.nodeType||u.isBreak(i)||s){let l=u.getParentElement(i,(function(e){return this.isRangeFormatElement(e)||this.isListCell(e)}).bind(u));if(n=u.splitElement(i,t.offset,l?u.getElementDepth(l)+1:0)){if(s){if(o.contains(i)){let t=u.isList(o.lastElementChild),i=null;e||(i=o.cloneNode(!1)).appendChild(n.textContent.trim()?n:u.createTextNode(u.zeroWidthSpace)),t&&(i||(i=o.cloneNode(!1)).appendChild(u.createTextNode(u.zeroWidthSpace)),i.appendChild(o.lastElementChild)),i&&(o.parentNode.insertBefore(i,o.nextElementSibling),c=n=i)}}else n=n.previousSibling}}}l=n||g?this.getRange():this.getRange_addLine(this.getRange(),null);let m=l.commonAncestorContainer,p=l.startOffset,y=l.endOffset,C=l.startContainer===m&&u.isFormatElement(m),_=C&&(m.childNodes[p]||m.childNodes[0])||l.startContainer,b=C&&(m.childNodes[y]||m.childNodes[m.childNodes.length-1])||l.endContainer;if(!s){if(n)r=n.parentNode,n=n.nextSibling,a=!0;else if(r=_,3===_.nodeType&&(r=_.parentNode),l.collapsed){if(3===m.nodeType)n=m.textContent.length>y?m.splitText(y):m.nextSibling;else if(u.isBreak(r))n=r,r=r.parentNode;else{let e=r.childNodes[p],i=e&&3===e.nodeType&&u.onlyZeroWidthSpace(e)&&u.isBreak(e.nextSibling)?e.nextSibling:e;i?!i.nextSibling&&u.isBreak(i)?(r.removeChild(i),n=null):n=u.isBreak(i)&&!u.isBreak(t)?i:i.nextSibling:n=null}}else{let e=_===b;if(e){n=this.isEdgePoint(b,y)?b.nextSibling:b.splitText(y);let e=_;this.isEdgePoint(_,p)||(e=_.splitText(p)),r.removeChild(e),0===r.childNodes.length&&g&&(r.innerHTML="<br>")}else{let e=this.removeNode(),i=e.container,l=e.prevContainer;if(i&&0===i.childNodes.length&&g&&(u.isFormatElement(i)?i.innerHTML="<br>":u.isRangeFormatElement(i)&&(i.innerHTML="<"+d.defaultTag+"><br></"+d.defaultTag+">")),u.isListCell(i)&&3===t.nodeType)r=i,n=null;else if(!g&&l){if((r=3===l.nodeType?l.parentNode:l).contains(i)){let e=!0;for(n=i;n.parentNode&&n.parentNode!==r;)n=n.parentNode,e=!1;e&&i===l&&(n=n.nextSibling)}else n=null}else u.isWysiwygDiv(i)&&!u.isFormatElement(t)?(r=i.appendChild(u.createElement(d.defaultTag)),n=null):r=(n=g?b:i===l?i.nextSibling:i)&&n.parentNode?n.parentNode:m;for(;n&&!u.isFormatElement(n)&&n.parentNode!==m;)n=n.parentNode}}}try{if(!s){if((u.isWysiwygDiv(n)||r===e.element.wysiwyg.parentNode)&&(r=e.element.wysiwyg,n=null),u.isFormatElement(t)||u.isRangeFormatElement(t)||!u.isListCell(r)&&u.isComponent(t)){let e=r;if(u.isList(n))r=n,n=null;else if(u.isListCell(n))r=n.previousElementSibling||n;else if(!a&&!n){let e=this.removeNode(),t=3===e.container.nodeType?u.isListCell(u.getFormatElement(e.container,null))?e.container:u.getFormatElement(e.container,null)||e.container.parentNode:e.container,i=u.isWysiwygDiv(t)||u.isRangeFormatElement(t);r=i?t:t.parentNode,n=i?null:t.nextSibling}0===e.childNodes.length&&r!==e&&u.removeItem(e)}if(!g||f||u.isRangeFormatElement(r)||u.isListCell(r)||u.isWysiwygDiv(r)||(n=r.nextElementSibling,r=r.parentNode),u.isWysiwygDiv(r)&&(3===t.nodeType||u.isBreak(t))){let e=u.createElement(d.defaultTag);e.appendChild(t),t=e}}if(s?h.parentNode?(r=h,n=c):(r=e.element.wysiwyg,n=null):n=r===n?r.lastChild:n,u.isListCell(t)&&!u.isList(r)){if(u.isListCell(r))n=r.nextElementSibling,r=r.parentNode;else{let e=u.createElement("ol");r.insertBefore(e,n),r=e,n=null}s=!0}if(this._checkDuplicateNode(t,r),r.insertBefore(t,n),s){if(u.onlyZeroWidthSpace(o.textContent.trim()))u.removeItem(o),t=t.lastChild;else{let e=u.getArrayItem(o.children,u.isList);e&&(t!==e?(t.appendChild(e),t=e.previousSibling):(r.appendChild(t),t=r),u.onlyZeroWidthSpace(o.textContent.trim())&&u.removeItem(o))}}}catch(e){r.appendChild(t),console.warn("[SUNEDITOR.insertNode.warn] "+e)}finally{let e=r.querySelectorAll("[data-se-duple]");if(e.length>0)for(let n=0,i=e.length,l,o,s,r;n<i;n++){for(s=(l=e[n]).childNodes,r=l.parentNode;s[0];)o=s[0],r.insertBefore(o,l);l===t&&(t=o),u.removeItem(l)}if((u.isFormatElement(t)||u.isComponent(t))&&_===b){let e=u.getFormatElement(m,null);e&&1===e.nodeType&&u.isEmptyLine(e)&&u.removeItem(e)}if(f&&(u.isFormatElement(t)||u.isRangeFormatElement(t))&&(t=this._setIntoFreeFormat(t)),!u.isComponent(t)){let e=1;if(3===t.nodeType){let e=t.previousSibling,n=t.nextSibling,i=!e||1===e.nodeType||u.onlyZeroWidthSpace(e)?"":e.textContent,l=!n||1===n.nodeType||u.onlyZeroWidthSpace(n)?"":n.textContent;e&&i.length>0&&(t.textContent=i+t.textContent,u.removeItem(e)),n&&n.length>0&&(t.textContent+=l,u.removeItem(n));let o={container:t,startOffset:i.length,endOffset:t.textContent.length-l.length};return this.setRange(t,o.startOffset,t,o.endOffset),o}if(!u.isBreak(t)&&!u.isListCell(t)&&u.isFormatElement(r)){let n=null;(!t.previousSibling||u.isBreak(t.previousSibling))&&(n=u.createTextNode(u.zeroWidthSpace),t.parentNode.insertBefore(n,t)),(!t.nextSibling||u.isBreak(t.nextSibling))&&(n=u.createTextNode(u.zeroWidthSpace),t.parentNode.insertBefore(n,t.nextSibling)),u._isIgnoreNodeChange(t)&&(t=t.nextSibling,e=0)}this.setRange(t,e,t,e)}return this.history.push(!0),t}},_setIntoFreeFormat:function(e){let t,n;let i=e.parentNode;for(;u.isFormatElement(e)||u.isRangeFormatElement(e);){for(t=e.childNodes,n=null;t[0];){if(n=t[0],u.isFormatElement(n)||u.isRangeFormatElement(n)){if(this._setIntoFreeFormat(n),!e.parentNode)break;t=e.childNodes;continue}i.insertBefore(n,e)}0===e.childNodes.length&&u.removeItem(e),e=u.createElement("BR"),i.insertBefore(e,n.nextSibling)}return e},removeNode:function(){this._resetRangeToTextNode();let t=this.getRange(),n,i=0,l=t.startContainer,o=t.endContainer,s=t.startOffset,r=t.endOffset,a=3===t.commonAncestorContainer.nodeType&&t.commonAncestorContainer.parentNode===l.parentNode?l.parentNode:t.commonAncestorContainer;if(a===l&&a===o&&(l=a.children[s],o=a.children[r],s=r=0),!l||!o)return{container:a,offset:0};if(l===o&&t.collapsed&&l.textContent&&u.onlyZeroWidthSpace(l.textContent.substr(s)))return{container:l,offset:s,prevContainer:l&&l.parentNode?l:null};let d=null,c=null,h=u.getListChildNodes(a,null),f=u.getArrayIndex(h,l),g=u.getArrayIndex(h,o);if(h.length>0&&f>-1&&g>-1){for(let e=f+1,t=l;e>=0;e--)h[e]===t.parentNode&&h[e].firstChild===t&&0===s&&(f=e,t=t.parentNode);for(let e=g-1,t=o;e>f;e--)h[e]===t.parentNode&&1===h[e].nodeType&&(h.splice(e,1),t=t.parentNode,--g)}else{if(0===h.length){if(u.isFormatElement(a)||u.isRangeFormatElement(a)||u.isWysiwygDiv(a)||u.isBreak(a)||u.isMedia(a))return{container:a,offset:0};if(3===a.nodeType)return{container:a,offset:r};h.push(a),l=o=a}else if(l=o=h[0],u.isBreak(l)||u.onlyZeroWidthSpace(l))return{container:u.isMedia(a)?a:l,offset:0};f=g=0}for(let e=f;e<=g;e++){let t=h[e];if(0===t.length||3===t.nodeType&&void 0===t.data){this._nodeRemoveListItem(t);continue}if(t===l){if(1===l.nodeType){if(u.isComponent(l))continue;d=u.createTextNode(l.textContent)}else t===o?(d=u.createTextNode(l.substringData(0,s)+o.substringData(r,o.length-r)),i=s):d=u.createTextNode(l.substringData(0,s));if(d.length>0?l.data=d.data:this._nodeRemoveListItem(l),t===o)break;continue}if(t===o){if(1===o.nodeType){if(u.isComponent(o))continue;c=u.createTextNode(o.textContent)}else c=u.createTextNode(o.substringData(r,o.length-r));c.length>0?o.data=c.data:this._nodeRemoveListItem(o);continue}this._nodeRemoveListItem(t)}let m=u.getParentElement(o,"ul"),p=u.getParentElement(l,"li");if(m&&p&&p.contains(m)?i=(n=m.previousSibling).textContent.length:n=o&&o.parentNode?o:l&&l.parentNode?l:t.endContainer||t.startContainer,!u.isWysiwygDiv(n)&&0===n.childNodes.length){let t=u.removeItemAllParents(n,null,null);t&&(n=t.sc||t.ec||e.element.wysiwyg)}return this.setRange(n,i,n,i),this.history.push(!0),{container:n,offset:i,prevContainer:l&&l.parentNode?l:null}},_nodeRemoveListItem:function(e){let t=u.getFormatElement(e,null);u.removeItem(e),u.isListCell(t)&&(u.removeItemAllParents(t,null,null),t&&u.isList(t.firstChild)&&t.insertBefore(u.createTextNode(u.zeroWidthSpace),t.firstChild))},applyRangeFormatElement:function(e){let t,n,i;this.getRange_addLine(this.getRange(),null);let l=this.getSelectedElementsAndComponents(!1);if(!l||0===l.length)return;e:for(let e=0,t=l.length,n,i,o,s,r,a;e<t;e++)if(n=l[e],u.isListCell(n)&&(i=n.lastElementChild)&&u.isListCell(n.nextElementSibling)&&l.indexOf(n.nextElementSibling)>-1&&(s=i.lastElementChild,l.indexOf(s)>-1)){let e=null;for(;e=s.lastElementChild;)if(u.isList(e)){if(l.indexOf(e.lastElementChild)>-1)s=e.lastElementChild;else continue e}o=i.firstElementChild,r=l.indexOf(o),a=l.indexOf(s),l.splice(r,a-r+1),t=l.length;continue}let o=l[l.length-1];t=u.isRangeFormatElement(o)||u.isFormatElement(o)?o:u.getRangeFormatElement(o,null)||u.getFormatElement(o,null),u.isCell(t)?(n=null,i=t):(n=t.nextSibling,i=t.parentNode);let s=u.getElementDepth(t),r=null,a=[],removeItems=function(e,t,n){let i=null;if(e!==t&&!u.isTable(t)){if(t&&u.getElementDepth(e)===u.getElementDepth(t))return n;i=u.removeItemAllParents(t,null,e)}return i?i.ec:n};for(let t=0,o=l.length,d,c,h,f,g,m,p;t<o;t++)if(!(!(c=(d=l[t]).parentNode)||e.contains(c))){if(h=u.getElementDepth(d),u.isList(c)){if(null===r&&(m?(r=m,p=!0,m=null):r=c.cloneNode(!1)),a.push(d),g=l[t+1],t===o-1||g&&g.parentNode!==c){g&&d.contains(g.parentNode)&&(m=g.parentNode.cloneNode(!1));let t=c.parentNode,l;for(;u.isList(t);)(l=u.createElement(t.nodeName)).appendChild(r),r=l,t=t.parentNode;let o=this.detachRangeFormatElement(c,a,null,!0,!0);s>=h?(s=h,(n=removeItems(i=o.cc,c,o.ec))&&(i=n.parentNode)):i===o.cc&&(n=o.ec),i!==o.cc&&(n=void 0!==(f=removeItems(i,o.cc,f))?f:o.cc);for(let e=0,t=o.removeArray.length;e<t;e++)r.appendChild(o.removeArray[e]);p||e.appendChild(r),m&&o.removeArray[o.removeArray.length-1].appendChild(m),r=null,p=!1}}else s>=h&&(s=h,i=c,n=d.nextSibling),e.appendChild(d),i!==c&&void 0!==(f=removeItems(i,c))&&(n=f)}if(this.effectNode=null,u.mergeSameTags(e,null,!1),u.mergeNestedTags(e,(function(e){return this.isList(e)}).bind(u)),n&&u.getElementDepth(n)>0&&(u.isList(n.parentNode)||u.isList(n.parentNode.parentNode))){let t=u.getParentElement(n,(function(e){return this.isRangeFormatElement(e)&&!this.isList(e)}).bind(u)),i=u.splitElement(n,null,t?u.getElementDepth(t)+1:0);i.parentNode.insertBefore(e,i)}else i.insertBefore(e,n),removeItems(e,n);let d=u.getEdgeChildNodes(e.firstElementChild,e.lastElementChild);l.length>1?this.setRange(d.sc,0,d.ec,d.ec.textContent.length):this.setRange(d.ec,d.ec.textContent.length,d.ec,d.ec.textContent.length),this.history.push(!1)},detachRangeFormatElement:function(e,t,n,i,l){let o=this.getRange(),s=o.startOffset,r=o.endOffset,a=u.getListChildNodes(e,function(t){return t.parentNode===e}),c=e.parentNode,h=null,f=null,g=e.cloneNode(!1),m=[],p=u.isList(n),y=!1,C=!1,_=!1;function appendNode(t,n,i,l){if(u.onlyZeroWidthSpace(n)&&(n.innerHTML=u.zeroWidthSpace,s=r=1),3===n.nodeType)return t.insertBefore(n,i),n;let o=(_?n:l).childNodes,a=n.cloneNode(!1),d=null,c=null;for(;o[0];)c=o[0],!u._notTextNode(c)||u.isBreak(c)||u.isListCell(a)?a.appendChild(c):(a.childNodes.length>0&&(d||(d=a),t.insertBefore(a,i),a=n.cloneNode(!1)),t.insertBefore(c,i),d||(d=c));if(a.childNodes.length>0){if(u.isListCell(t)&&u.isListCell(a)&&u.isList(i)){if(p){for(d=i;i;)a.appendChild(i),i=i.nextSibling;t.parentNode.insertBefore(a,t.nextElementSibling)}else{let t=l.nextElementSibling,n=u.detachNestedList(l,!1);if(e!==n||t!==l.nextElementSibling){let t=a.childNodes;for(;t[0];)l.appendChild(t[0]);e=n,C=!0}}}else t.insertBefore(a,i);d||(d=a)}return d}for(let l=0,o=a.length,s,r,b;l<o;l++)if(!(3===(s=a[l]).nodeType&&u.isList(g))){if(_=!1,i&&0===l&&(h=t&&t.length!==o&&t[0]!==s?g:e.previousSibling),t&&(r=t.indexOf(s)),t&&-1===r)g||(g=e.cloneNode(!1)),g.appendChild(s);else{if(t&&(b=t[r+1]),g&&g.children.length>0&&(c.insertBefore(g,e),g=null),!p&&u.isListCell(s)){if(b&&u.getElementDepth(s)!==u.getElementDepth(b)&&(u.isListCell(c)||u.getArrayItem(s.children,u.isList,!1))){let t=s.nextElementSibling,n=u.detachNestedList(s,!1);(e!==n||t!==s.nextElementSibling)&&(e=n,C=!0)}else{let t=s;s=u.createElement(i?t.nodeName:u.isList(e.parentNode)||u.isListCell(e.parentNode)?"LI":u.isCell(e.parentNode)?"DIV":d.defaultTag);let n=u.isListCell(s),l=t.childNodes;for(;l[0]&&(!u.isList(l[0])||n);)s.appendChild(l[0]);u.copyFormatAttributes(s,t),_=!0}}else s=s.cloneNode(!1);if(!C&&(i?(m.push(s),u.removeItem(a[l])):(n?(y||(c.insertBefore(n,e),y=!0),s=appendNode(n,s,null,a[l])):s=appendNode(c,s,e,a[l]),C||(t?(f=s,h||(h=s)):h||(h=f=s))),C)){C=_=!1,a=u.getListChildNodes(e,function(t){return t.parentNode===e}),g=e.cloneNode(!1),c=e.parentNode,l=-1,o=a.length;continue}}}let b=e.parentNode,v=e.nextSibling;g&&g.children.length>0&&b.insertBefore(g,v),n?h=n.previousSibling:h||(h=e.previousSibling),v=e.nextSibling!==g?e.nextSibling:g?g.nextSibling:null,0===e.children.length||0===e.textContent.length?u.removeItem(e):u.removeEmptyNode(e,null,!1);let E=null;if(i)E={cc:b,sc:h,so:s,ec:v,eo:r,removeArray:m};else{h||(h=f),f||(f=h);let e=u.getEdgeChildNodes(h,f.parentNode?h:f);E={cc:(e.sc||e.ec).parentNode,sc:e.sc,so:s,ec:e.ec,eo:r,removeArray:null}}if(this.effectNode=null,l)return E;!i&&E&&(t?this.setRange(E.sc,s,E.ec,r):this.setRange(E.sc,0,E.sc,0)),this.history.push(!1)},detachList:function(e,t){let n={},i=!1,l=!1,o=null,s=null,r=(function(e){return!this.isComponent(e)}).bind(u);for(let a=0,d=e.length,c,h,f,g;a<d;a++){if(f=a===d-1,h=u.getRangeFormatElement(e[a],r),g=u.isList(h),!c&&g)n={r:c=h,f:[u.getParentElement(e[a],"LI")]},0===a&&(i=!0);else if(c&&g){if(c!==h){let r=this.detachRangeFormatElement(n.f[0].parentNode,n.f,null,t,!0);h=e[a].parentNode,i&&(o=r.sc,i=!1),f&&(s=r.ec),g?(n={r:c=h,f:[u.getParentElement(e[a],"LI")]},f&&(l=!0)):c=null}else n.f.push(u.getParentElement(e[a],"LI")),f&&(l=!0)}if(f&&u.isList(c)){let e=this.detachRangeFormatElement(n.f[0].parentNode,n.f,null,t,!0);(l||1===d)&&(s=e.ec),i&&(o=e.sc||s)}}return{sc:o,ec:s}},nodeChange:function(e,t,n,i){this._resetRangeToTextNode();let l=this.getRange_addLine(this.getRange(),null);t=!!t&&t.length>0&&t,n=!!n&&n.length>0&&n;let o=!e,s=o&&!n&&!t,r=l.startContainer,a=l.startOffset,d=l.endContainer,c=l.endOffset;if(s&&l.collapsed&&u.isFormatElement(r.parentNode)||r===d&&1===r.nodeType&&u.isNonEditable(r)){let e=r.parentNode;if(!u.isListCell(e)||!u.getValues(e.style).some((function(e){return this._listKebab.indexOf(e)>-1}).bind(this)))return}if(l.collapsed&&!s&&1===r.nodeType&&!u.isBreak(r)&&!u.isComponent(r)){let e=null,t=r.childNodes[a];t&&(e=t.nextSibling?u.isBreak(t)?t:t.nextSibling:null);let n=u.createTextNode(u.zeroWidthSpace);r.insertBefore(n,e),this.setRange(n,1,n,1),r=(l=this.getRange()).startContainer,a=l.startOffset,d=l.endContainer,c=l.endOffset}u.isFormatElement(r)&&(r=r.childNodes[a]||r.firstChild,a=0),u.isFormatElement(d)&&(c=(d=d.childNodes[c]||d.lastChild).textContent.length),o&&(e=u.createElement("DIV"));let h=f.RegExp,g=e.nodeName;if(!s&&r===d&&!n&&e){let t=r,n=0,i=[],l=e.style;for(let e=0,t=l.length;e<t;e++)i.push(l[e]);let s=e.classList;for(let e=0,t=s.length;e<t;e++)i.push("."+s[e]);if(i.length>0){for(;!u.isFormatElement(t)&&!u.isWysiwygDiv(t);){for(let l=0;l<i.length;l++)if(1===t.nodeType){let s=i[l],r=!!/^\./.test(s)&&new h("\\s*"+s.replace(/^\./,"")+"(\\s+|$)","ig"),a=o?!!t.style[s]:!!t.style[s]&&!!e.style[s]&&t.style[s]===e.style[s],d=!1!==r&&(o?!!t.className.match(r):!!t.className.match(r)&&!!e.className.match(r));(a||d)&&n++}t=t.parentNode}if(n>=i.length)return}}let m={},p={},y,C="",_="",b="";if(t){for(let e=0,n=t.length,i;e<n;e++)i=t[e],/^\./.test(i)?_+=(_?"|":"\\s*(?:")+i.replace(/^\./,""):C+=(C?"|":"(?:;|^|\\s)(?:")+i;C&&(C+=")\\s*:[^;]*\\s*(?:;|$)",C=new h(C,"ig")),_&&(_+=")(?=\\s+|$)",_=new h(_,"ig"))}if(n){b="^(?:"+n[0];for(let e=1;e<n.length;e++)b+="|"+n[e];b+=")$",b=new h(b,"i")}let v=f.Boolean,E={v:!1},validation=function(e){let t=e.cloneNode(!1);if(3===t.nodeType||u.isBreak(t))return t;if(s)return null;let n=!b&&o||b&&b.test(t.nodeName);if(n&&!i)return E.v=!0,null;let l=t.style.cssText,r="";C&&l.length>0&&(r=l.replace(C,"").trim())!==l&&(E.v=!0);let a=t.className,d="";return(_&&a.length>0&&(d=a.replace(_,"").trim())!==a&&(E.v=!0),o&&(_||!a)&&(C||!l)&&!r&&!d&&n)?(E.v=!0,null):(r||d||t.nodeName!==g||v(C)!==v(l)||v(_)!==v(a))&&(C&&l.length>0&&(t.style.cssText=r),t.style.cssText||t.removeAttribute("style"),_&&a.length>0&&(t.className=d.trim()),t.className.trim()||t.removeAttribute("class"),t.style.cssText||t.className||t.nodeName!==g&&!n)?t:(E.v=!0,null)},T=this.getSelectedElements(null);r=(l=this.getRange()).startContainer,a=l.startOffset,d=l.endContainer,c=l.endOffset,u.getFormatElement(r,null)||(r=u.getChildElement(T[0],function(e){return 3===e.nodeType},!1),a=0),u.getFormatElement(d,null)||(c=(d=u.getChildElement(T[T.length-1],function(e){return 3===e.nodeType},!1)).textContent.length);let w=u.getFormatElement(r,null)===u.getFormatElement(d,null),N=T.length-(w?0:1);y=e.cloneNode(!1);let x=s||o&&function(e){for(let t=0,n=e.length;t<n;t++)if(u._isMaintainedNode(e[t])||u._isSizeNode(e[t]))return!0;return!1}(n),S=o||u._isSizeNode(y),B=this._util_getMaintainedNode.bind(u,x,S),L=this._util_isMaintainedNode.bind(u,x,S);if(w){this._resetCommonListCell(T[0],t)&&(l=this.setRange(r,a,d,c));let e=this._nodeChange_oneLine(T[0],y,validation,r,a,d,c,s,o,l.collapsed,E,B,L);m.container=e.startContainer,m.offset=e.startOffset,p.container=e.endContainer,p.offset=e.endOffset,m.container===p.container&&u.onlyZeroWidthSpace(m.container)&&(m.offset=p.offset=1),this._setCommonListStyle(e.ancestor,null)}else{let n=!1;N>0&&this._resetCommonListCell(T[N],t)&&(n=!0),this._resetCommonListCell(T[0],t)&&(n=!0),n&&this.setRange(r,a,d,c),N>0&&(y=e.cloneNode(!1),p=this._nodeChange_endLine(T[N],y,validation,d,c,s,o,E,B,L));for(let n=N-1,i;n>0;n--)this._resetCommonListCell(T[n],t),y=e.cloneNode(!1),(i=this._nodeChange_middleLine(T[n],y,validation,s,o,E,p.container)).endContainer&&i.ancestor.contains(i.endContainer)&&(p.ancestor=null,p.container=i.endContainer),this._setCommonListStyle(i.ancestor,null);y=e.cloneNode(!1),(m=this._nodeChange_startLine(T[0],y,validation,r,a,s,o,E,B,L,p.container)).endContainer&&(p.ancestor=null,p.container=m.endContainer),N<=0?p=m:p.container||(p.ancestor=null,p.container=m.container,p.offset=m.container.textContent.length),this._setCommonListStyle(m.ancestor,null),this._setCommonListStyle(p.ancestor||u.getFormatElement(p.container),null)}this.controllersOff(),this.setRange(m.container,m.offset,p.container,p.offset),this.history.push(!1)},_resetCommonListCell:function(e,t){if(!u.isListCell(e))return;t||(t=this._listKebab);let n=u.getArrayItem(e.childNodes,function(e){return!u.isBreak(e)},!0),i=e.style,l=[],o=[],s=u.getValues(i);for(let e=0,n=this._listKebab.length;e<n;e++)s.indexOf(this._listKebab[e])>-1&&t.indexOf(this._listKebab[e])>-1&&(l.push(this._listCamel[e]),o.push(this._listKebab[e]));if(!l.length)return;let r=u.createElement("SPAN");for(let e=0,t=l.length;e<t;e++)r.style[l[e]]=i[o[e]],i.removeProperty(o[e]);let a=r.cloneNode(!1),c=null,h=!1;for(let t=0,i=n.length,o,s;t<i;t++)o=n[t],!d._textTagsMap[o.nodeName.toLowerCase()]&&(0===(s=u.getValues(o.style)).length||l.some(function(e){return -1===s.indexOf(e)})&&s.some(function(e){l.indexOf(e)})?(c=o.nextSibling,a.appendChild(o)):a.childNodes.length>0&&(e.insertBefore(a,c),a=r.cloneNode(!1),c=null,h=!0));return a.childNodes.length>0&&(e.insertBefore(a,c),h=!0),i.length||e.removeAttribute("style"),h},_setCommonListStyle:function(e,t){if(!u.isListCell(e))return;let n=u.getArrayItem((t||e).childNodes,function(e){return!u.isBreak(e)},!0);if(!(t=n[0])||n.length>1||1!==t.nodeType)return;let i=t.style,l=e.style,o=t.nodeName.toLowerCase(),s=!1;d._textTagsMap[o]===d._defaultCommand.bold.toLowerCase()&&(l.fontWeight="bold"),d._textTagsMap[o]===d._defaultCommand.italic.toLowerCase()&&(l.fontStyle="italic");let r=u.getValues(i);if(r.length>0)for(let e=0,t=this._listCamel.length;e<t;e++)r.indexOf(this._listKebab[e])>-1&&(l[this._listCamel[e]]=i[this._listCamel[e]],i.removeProperty(this._listKebab[e]),s=!0);if(this._setCommonListStyle(e,t),s&&!i.length){let e=t.childNodes,n=t.parentNode,i=t.nextSibling;for(;e.length>0;)n.insertBefore(e[0],i);u.removeItem(t)}},_stripRemoveNode:function(e){let t=e.parentNode;if(!e||3===e.nodeType||!t)return;let n=e.childNodes;for(;n[0];)t.insertBefore(n[0],e);t.removeChild(e)},_util_getMaintainedNode:function(e,t,n){return!n||e?null:this.getParentElement(n,this._isMaintainedNode.bind(this))||(t?null:this.getParentElement(n,this._isSizeNode.bind(this)))},_util_isMaintainedNode:function(e,t,n){if(!n||e||1!==n.nodeType)return!1;let i=this._isMaintainedNode(n);return this.getParentElement(n,this._isMaintainedNode.bind(this))?i:i||!t&&this._isSizeNode(n)},_nodeChange_oneLine:function(e,t,n,i,l,o,s,r,a,d,c,h,g){let m,p,y,C,_,b=i.parentNode;for(;!b.nextSibling&&!b.previousSibling&&!u.isFormatElement(b.parentNode)&&!u.isWysiwygDiv(b.parentNode)&&b.nodeName!==t.nodeName;)b=b.parentNode;if(!a&&b===o.parentNode&&b.nodeName===t.nodeName&&u.onlyZeroWidthSpace(i.textContent.slice(0,l))&&u.onlyZeroWidthSpace(o.textContent.slice(s))){let n=b.childNodes,r=!0;for(let e=0,t=n.length,l,s,a,d;e<t;e++){if(l=n[e],d=!u.onlyZeroWidthSpace(l),l===i){s=!0;continue}if(l===o){a=!0;continue}if(!s&&d||s&&a&&d){r=!1;break}}if(r)return u.copyTagAttributes(b,t),{ancestor:e,startContainer:i,startOffset:l,endContainer:o,endOffset:s}}c.v=!1;let v=[t],E=e.cloneNode(!1),T=i===o,w=i,N=l,x=o,S=s,B=!1,L=!1,k=f.RegExp;function checkCss(e){let t=new k("(?:;|^|\\s)(?:"+C+"null)\\s*:[^;]*\\s*(?:;|$)","ig"),n="";return t&&e.style.cssText.length>0&&(n=t.test(e.style.cssText)),!n}if(!function recursionFunc(i,l){let o=i.childNodes;for(let i=0,s=o.length,a;i<s;i++){let s,c=o[i];if(!c)continue;let f=l;if(!B&&c===w){let i=E;_=h(c);let o=u.createTextNode(1===w.nodeType?"":w.substringData(0,N)),s=u.createTextNode(1===w.nodeType?"":w.substringData(N,T&&S>=N?S-N:w.data.length-N));if(_){let e=h(l);if(e&&e.parentNode!==i){let t=e,n=null;for(;t.parentNode!==i;){for(l=n=t.parentNode.cloneNode(!1);t.childNodes[0];)n.appendChild(t.childNodes[0]);t.appendChild(n),t=t.parentNode}t.parentNode.appendChild(e)}_=_.cloneNode(!1)}u.onlyZeroWidthSpace(o)||l.appendChild(o);let r=h(l);for(r&&(_=r),_&&(i=_),p=c,m=[],C="";p!==i&&p!==e&&null!==p;)(a=g(p)?null:n(p))&&1===p.nodeType&&checkCss(p)&&(m.push(a),C+=p.style.cssText.substr(0,p.style.cssText.indexOf(":"))+"|"),p=p.parentNode;let d=m.pop()||s;for(y=p=d;m.length>0;)p=m.pop(),y.appendChild(p),y=p;if(t.appendChild(d),i.appendChild(t),_&&!h(x)&&(t=t.cloneNode(!1),E.appendChild(t),v.push(t)),w=s,N=0,B=!0,p!==s&&p.appendChild(w),!T)continue}if(!L&&c===x){_=h(c);let i=u.createTextNode(1===x.nodeType?"":x.substringData(S,x.length-S)),l=u.createTextNode(T||1===x.nodeType?"":x.substringData(0,S));if(_?_=_.cloneNode(!1):g(t.parentNode)&&!_&&(t=t.cloneNode(!1),E.appendChild(t),v.push(t)),!u.onlyZeroWidthSpace(i)){p=c,C="",m=[];let t=[];for(;p!==E&&p!==e&&null!==p;)1===p.nodeType&&checkCss(p)&&(g(p)?t.push(p.cloneNode(!1)):m.push(p.cloneNode(!1)),C+=p.style.cssText.substr(0,p.style.cssText.indexOf(":"))+"|"),p=p.parentNode;for(s=y=p=(m=m.concat(t)).pop()||i;m.length>0;)p=m.pop(),y.appendChild(p),y=p;E.appendChild(s),p.textContent=i.data}if(_&&s){let e=h(s);e&&(_=e)}for(p=c,m=[],C="";p!==E&&p!==e&&null!==p;)(a=g(p)?null:n(p))&&1===p.nodeType&&checkCss(p)&&(m.push(a),C+=p.style.cssText.substr(0,p.style.cssText.indexOf(":"))+"|"),p=p.parentNode;let o=m.pop()||l;for(y=p=o;m.length>0;)p=m.pop(),y.appendChild(p),y=p;_?((t=t.cloneNode(!1)).appendChild(o),_.insertBefore(t,_.firstChild),E.appendChild(_),v.push(t),_=null):t.appendChild(o),x=l,S=l.data.length,L=!0,!r&&d&&(t=l,l.textContent=u.zeroWidthSpace),p!==l&&p.appendChild(x);continue}if(B){if(1===c.nodeType&&!u.isBreak(c)){u._isIgnoreNodeChange(c)?(E.appendChild(c.cloneNode(!0)),d||(t=t.cloneNode(!1),E.appendChild(t),v.push(t))):recursionFunc(c,c);continue}p=c,m=[],C="";let i=[];for(;null!==p.parentNode&&p!==e&&p!==t;)a=L?p.cloneNode(!1):n(p),1===p.nodeType&&!u.isBreak(c)&&a&&checkCss(p)&&(g(p)?_||i.push(a):m.push(a),C+=p.style.cssText.substr(0,p.style.cssText.indexOf(":"))+"|"),p=p.parentNode;m=m.concat(i);let o=m.pop()||c;for(y=p=o;m.length>0;)p=m.pop(),y.appendChild(p),y=p;if(!g(t.parentNode)||g(o)||u.onlyZeroWidthSpace(t)||(t=t.cloneNode(!1),E.appendChild(t),v.push(t)),!L&&!_&&g(o)){t=t.cloneNode(!1);let e=o.childNodes;for(let n=0,i=e.length;n<i;n++)t.appendChild(e[n]);o.appendChild(t),E.appendChild(o),v.push(t),l=t.children.length>0?p:t}else o===c?l=L?E:t:(L?E.appendChild(o):t.appendChild(o),l=p);if(_&&3===c.nodeType){if(h(c)){let e=u.getParentElement(l,(function(e){return this._isMaintainedNode(e.parentNode)||e.parentNode===E}).bind(u));_.appendChild(e),t=e.cloneNode(!1),v.push(t),E.appendChild(t)}else _=null}}s=c.cloneNode(!1),l.appendChild(s),1!==c.nodeType||u.isBreak(c)||(f=s),recursionFunc(c,f)}}(e,E),a&&!r&&!c.v)return{ancestor:e,startContainer:i,startOffset:l,endContainer:o,endOffset:s};if(r=r&&a)for(let e=0;e<v.length;e++){let t,n,i,l=v[e];if(d)t=u.createTextNode(u.zeroWidthSpace),E.replaceChild(t,l);else{let e=l.childNodes;for(n=e[0];e[0];)i=e[0],E.insertBefore(i,l);u.removeItem(l)}0===e&&(d?w=x=t:(w=n,x=i))}else{if(a)for(let e=0;e<v.length;e++)this._stripRemoveNode(v[e]);d&&(w=x=t)}u.removeEmptyNode(E,t,!1),d&&(N=w.textContent.length,S=x.textContent.length);let R=r||0===x.textContent.length;u.isBreak(x)||0!==x.textContent.length||(u.removeItem(x),x=w),S=R?x.textContent.length:S;let F={s:0,e:0},O=u.getNodePath(w,E,F),D=!x.parentNode;D&&(x=w);let A={s:0,e:0},I=u.getNodePath(x,E,D||R?null:A);N+=F.s,S=d?N:D?w.textContent.length:R?S+F.s:S+A.s;let M=u.mergeSameTags(E,[O,I],!0);return e.parentNode.replaceChild(E,e),w=u.getNodeFromPath(O,E),x=u.getNodeFromPath(I,E),{ancestor:E,startContainer:w,startOffset:N+M[0],endContainer:x,endOffset:S+M[1]}},_nodeChange_startLine:function(e,t,n,i,l,o,s,r,a,d,c){let h,f,g,m,p=i.parentNode;for(;!p.nextSibling&&!p.previousSibling&&!u.isFormatElement(p.parentNode)&&!u.isWysiwygDiv(p.parentNode)&&p.nodeName!==t.nodeName;)p=p.parentNode;if(!s&&p.nodeName===t.nodeName&&!u.isFormatElement(p)&&!p.nextSibling&&u.onlyZeroWidthSpace(i.textContent.slice(0,l))){let n=!0,o=i.previousSibling;for(;o;){if(!u.onlyZeroWidthSpace(o)){n=!1;break}o=o.previousSibling}if(n)return u.copyTagAttributes(p,t),{ancestor:e,container:i,offset:l}}r.v=!1;let y=[t],C=e.cloneNode(!1),_=i,b=l,v=!1;if(!function recursionFunc(i,l){let o=i.childNodes;for(let i=0,s=o.length,r,p;i<s;i++){let s=o[i];if(!s)continue;let E=l;if(v&&!u.isBreak(s)){if(1===s.nodeType){if(u._isIgnoreNodeChange(s)){if(t=t.cloneNode(!1),p=s.cloneNode(!0),C.appendChild(p),C.appendChild(t),y.push(t),c&&s.contains(c)){let e=u.getNodePath(c,s);c=u.getNodeFromPath(e,p)}}else recursionFunc(s,s);continue}f=s,h=[];let i=[];for(;null!==f.parentNode&&f!==e&&f!==t;)r=n(f),1===f.nodeType&&r&&(d(f)?m||i.push(r):h.push(r)),f=f.parentNode;h=h.concat(i);let o=h.length>0,_=h.pop()||s;for(g=f=_;h.length>0;)f=h.pop(),g.appendChild(f),g=f;if(d(t.parentNode)&&!d(_)&&(t=t.cloneNode(!1),C.appendChild(t),y.push(t)),!m&&d(_)){t=t.cloneNode(!1);let e=_.childNodes;for(let n=0,i=e.length;n<i;n++)t.appendChild(e[n]);_.appendChild(t),C.appendChild(_),l=d(f)?t:f,y.push(t)}else o?(t.appendChild(_),l=f):l=t;if(m&&3===s.nodeType){if(a(s)){let e=u.getParentElement(l,(function(e){return this._isMaintainedNode(e.parentNode)||e.parentNode===C}).bind(u));m.appendChild(e),t=e.cloneNode(!1),y.push(t),C.appendChild(t)}else m=null}}if(!v&&s===_){let e=C;m=a(s);let i=u.createTextNode(1===_.nodeType?"":_.substringData(0,b)),o=u.createTextNode(1===_.nodeType?"":_.substringData(b,_.length-b));if(m){let t=a(l);if(t&&t.parentNode!==e){let n=t,i=null;for(;n.parentNode!==e;){for(l=i=n.parentNode.cloneNode(!1);n.childNodes[0];)i.appendChild(n.childNodes[0]);n.appendChild(i),n=n.parentNode}n.parentNode.appendChild(t)}m=m.cloneNode(!1)}u.onlyZeroWidthSpace(i)||l.appendChild(i);let d=a(l);for(d&&(m=d),m&&(e=m),f=l,h=[];f!==e&&null!==f;)r=n(f),1===f.nodeType&&r&&h.push(r),f=f.parentNode;let c=h.pop()||l;for(g=f=c;h.length>0;)f=h.pop(),g.appendChild(f),g=f;c!==l?(t.appendChild(c),l=f):l=t,u.isBreak(s)&&t.appendChild(s.cloneNode(!1)),e.appendChild(t),_=o,b=0,v=!0,l.appendChild(_);continue}(r=v?n(s):s.cloneNode(!1))&&(l.appendChild(r),1!==s.nodeType||u.isBreak(s)||(E=r)),recursionFunc(s,E)}}(e,C),s&&!o&&!r.v)return{ancestor:e,container:i,offset:l,endContainer:c};if(o=o&&s)for(let e=0;e<y.length;e++){let t=y[e],n=t.childNodes,i=n[0];for(;n[0];)C.insertBefore(n[0],t);u.removeItem(t),0===e&&(_=i)}else if(s){t=t.firstChild;for(let e=0;e<y.length;e++)this._stripRemoveNode(y[e])}if(o||0!==C.childNodes.length){u.removeEmptyNode(C,t,!1),u.onlyZeroWidthSpace(C.textContent)&&(_=C.firstChild,b=0);let n={s:0,e:0},i=u.getNodePath(_,C,n);b+=n.s;let l=u.mergeSameTags(C,[i],!0);e.parentNode.replaceChild(C,e),_=u.getNodeFromPath(i,C),b+=l[0]}else e.childNodes?_=e.childNodes[0]:(_=u.createTextNode(u.zeroWidthSpace),e.appendChild(_));return{ancestor:C,container:_,offset:b,endContainer:c}},_nodeChange_middleLine:function(e,t,n,i,l,o,s){if(!l){let n=null;s&&e.contains(s)&&(n=u.getNodePath(s,e));let i=e.cloneNode(!0),l=t.nodeName,o=t.style.cssText,r=t.className,a=i.childNodes,d=0,c=a.length;for(let e;d<c&&3!==(e=a[d]).nodeType;d++)if(e.nodeName===l)e.style.cssText+=o,u.addClass(e,r);else if(!u.isBreak(e)&&u._isIgnoreNodeChange(e))continue;else if(1===c){c=(a=e.childNodes).length,d=-1;continue}else break;if(c>0&&d===c)return e.innerHTML=i.innerHTML,{ancestor:e,endContainer:n?u.getNodeFromPath(n,e):null}}o.v=!1;let r=e.cloneNode(!1),a=[t],d=!0;if(!function recursionFunc(e,i){let l=e.childNodes;for(let e=0,o=l.length,c,h;e<o;e++){let o=l[e];if(!o)continue;let f=i;if(!u.isBreak(o)&&u._isIgnoreNodeChange(o)){if(t.childNodes.length>0&&(r.appendChild(t),t=t.cloneNode(!1)),h=o.cloneNode(!0),r.appendChild(h),r.appendChild(t),a.push(t),i=t,s&&o.contains(s)){let e=u.getNodePath(s,o);s=u.getNodeFromPath(e,h)}continue}(c=n(o))&&(d=!1,i.appendChild(c),1===o.nodeType&&(f=c)),u.isBreak(o)||recursionFunc(o,f)}}(e,t),d||l&&!i&&!o.v)return{ancestor:e,endContainer:s};if(r.appendChild(t),i&&l)for(let e=0;e<a.length;e++){let t=a[e],n=t.childNodes;for(;n[0];)r.insertBefore(n[0],t);u.removeItem(t)}else if(l){t=t.firstChild;for(let e=0;e<a.length;e++)this._stripRemoveNode(a[e])}return u.removeEmptyNode(r,t,!1),u.mergeSameTags(r,null,!0),e.parentNode.replaceChild(r,e),{ancestor:r,endContainer:s}},_nodeChange_endLine:function(e,t,n,i,l,o,s,r,a,d){let c,h,f,g,m=i.parentNode;for(;!m.nextSibling&&!m.previousSibling&&!u.isFormatElement(m.parentNode)&&!u.isWysiwygDiv(m.parentNode)&&m.nodeName!==t.nodeName;)m=m.parentNode;if(!s&&m.nodeName===t.nodeName&&!u.isFormatElement(m)&&!m.previousSibling&&u.onlyZeroWidthSpace(i.textContent.slice(l))){let n=!0,o=i.nextSibling;for(;o;){if(!u.onlyZeroWidthSpace(o)){n=!1;break}o=o.nextSibling}if(n)return u.copyTagAttributes(m,t),{ancestor:e,container:i,offset:l}}r.v=!1;let p=[t],y=e.cloneNode(!1),C=i,_=l,b=!1;if(!function recursionFunc(i,l){let o=i.childNodes;for(let i=o.length-1,s;0<=i;i--){let r=o[i];if(!r)continue;let m=l;if(b&&!u.isBreak(r)){if(1===r.nodeType){if(u._isIgnoreNodeChange(r)){t=t.cloneNode(!1);let e=r.cloneNode(!0);y.insertBefore(e,l),y.insertBefore(t,e),p.push(t)}else recursionFunc(r,r);continue}h=r,c=[];let i=[];for(;null!==h.parentNode&&h!==e&&h!==t;)(s=n(h))&&1===h.nodeType&&(d(h)?g||i.push(s):c.push(s)),h=h.parentNode;c=c.concat(i);let o=c.length>0,m=c.pop()||r;for(f=h=m;c.length>0;)h=c.pop(),f.appendChild(h),f=h;if(d(t.parentNode)&&!d(m)&&(t=t.cloneNode(!1),y.insertBefore(t,y.firstChild),p.push(t)),!g&&d(m)){t=t.cloneNode(!1);let e=m.childNodes;for(let n=0,i=e.length;n<i;n++)t.appendChild(e[n]);m.appendChild(t),y.insertBefore(m,y.firstChild),p.push(t),l=t.children.length>0?h:t}else o?(t.insertBefore(m,t.firstChild),l=h):l=t;if(g&&3===r.nodeType){if(a(r)){let e=u.getParentElement(l,(function(e){return this._isMaintainedNode(e.parentNode)||e.parentNode===y}).bind(u));g.appendChild(e),t=e.cloneNode(!1),p.push(t),y.insertBefore(t,y.firstChild)}else g=null}}if(!b&&r===C){g=a(r);let e=u.createTextNode(1===C.nodeType?"":C.substringData(_,C.length-_)),i=u.createTextNode(1===C.nodeType?"":C.substringData(0,_));if(g){g=g.cloneNode(!1);let e=a(l);if(e&&e.parentNode!==y){let t=e,n=null;for(;t.parentNode!==y;){for(l=n=t.parentNode.cloneNode(!1);t.childNodes[0];)n.appendChild(t.childNodes[0]);t.appendChild(n),t=t.parentNode}t.parentNode.insertBefore(e,t.parentNode.firstChild)}g=g.cloneNode(!1)}else d(t.parentNode)&&!g&&(t=t.cloneNode(!1),y.appendChild(t),p.push(t));for(u.onlyZeroWidthSpace(e)||l.insertBefore(e,l.firstChild),h=l,c=[];h!==y&&null!==h;)(s=d(h)?null:n(h))&&1===h.nodeType&&c.push(s),h=h.parentNode;let o=c.pop()||l;for(f=h=o;c.length>0;)h=c.pop(),f.appendChild(h),f=h;o!==l?(t.insertBefore(o,t.firstChild),l=h):l=t,u.isBreak(r)&&t.appendChild(r.cloneNode(!1)),g?(g.insertBefore(t,g.firstChild),y.insertBefore(g,y.firstChild),g=null):y.insertBefore(t,y.firstChild),C=i,_=i.data.length,b=!0,l.insertBefore(C,l.firstChild);continue}(s=b?n(r):r.cloneNode(!1))&&(l.insertBefore(s,l.firstChild),1!==r.nodeType||u.isBreak(r)||(m=s)),recursionFunc(r,m)}}(e,y),s&&!o&&!r.v)return{ancestor:e,container:i,offset:l};if(o=o&&s)for(let e=0;e<p.length;e++){let t=p[e],n=t.childNodes,i=null;for(;n[0];)i=n[0],y.insertBefore(i,t);u.removeItem(t),e===p.length-1&&(C=i,_=i.textContent.length)}else if(s){t=t.firstChild;for(let e=0;e<p.length;e++)this._stripRemoveNode(p[e])}if(o||0!==y.childNodes.length){if(!s&&0===t.textContent.length)return u.removeEmptyNode(y,null,!1),{ancestor:null,container:null,offset:0};u.removeEmptyNode(y,t,!1),u.onlyZeroWidthSpace(y.textContent)?_=(C=y.firstChild).textContent.length:u.onlyZeroWidthSpace(C)&&(C=t,_=1);let n={s:0,e:0},i=u.getNodePath(C,y,n);_+=n.s;let l=u.mergeSameTags(y,[i],!0);e.parentNode.replaceChild(y,e),C=u.getNodeFromPath(i,y),_+=l[0]}else e.childNodes?C=e.childNodes[0]:(C=u.createTextNode(u.zeroWidthSpace),e.appendChild(C));return{ancestor:y,container:C,offset:1===C.nodeType&&1===_?C.childNodes.length:_}},actionCall:function(t,n,i){if(n){if(/more/i.test(n)){if(i!==this._moreLayerActiveButton){let n=e.element.toolbar.querySelector("."+t);n&&(this._moreLayerActiveButton&&this.moreLayerOff(),this._moreLayerActiveButton=i,n.style.display="block",p._showToolbarBalloon(),p._showToolbarInline()),u.addClass(i,"on")}else{let t=e.element.toolbar.querySelector("."+this._moreLayerActiveButton.getAttribute("data-command"));t&&(this.moreLayerOff(),p._showToolbarBalloon(),p._showToolbarInline())}return}if(/container/.test(n)&&(null===this._menuTray[t]||i!==this.containerActiveButton)){this.callPlugin(t,this.containerOn.bind(this,i),i);return}if(this.isReadOnly&&u.arrayIncludes(this.resizingDisabledButtons,i))return;if(/submenu/.test(n)&&(null===this._menuTray[t]||i!==this.submenuActiveButton)){this.callPlugin(t,this.submenuOn.bind(this,i),i);return}if(/dialog/.test(n)){this.callPlugin(t,this.plugins[t].open.bind(this),i);return}/command/.test(n)?this.callPlugin(t,this.plugins[t].action.bind(this),i):/fileBrowser/.test(n)&&this.callPlugin(t,this.plugins[t].open.bind(this,null),i)}else t&&this.commandHandler(i,t);/submenu/.test(n)?this.submenuOff():/command/.test(n)||(this.submenuOff(),this.containerOff())},commandHandler:function(t,n){if(!m.isReadOnly||/copy|cut|selectAll|codeView|fullScreen|print|preview|showBlocks/.test(n))switch(n){case"copy":case"cut":this.execCommand(n);break;case"paste":break;case"selectAll":this.containerOff();let i=e.element.wysiwyg,l=u.getChildElement(i.firstChild,function(e){return 0===e.childNodes.length||3===e.nodeType},!1)||i.firstChild,o=u.getChildElement(i.lastChild,function(e){return 0===e.childNodes.length||3===e.nodeType},!0)||i.lastChild;if(!l||!o)return;if(u.isMedia(l)){let e=this.getFileComponent(l),t=u.createElement("BR"),n=u.createElement(d.defaultTag);n.appendChild(t),(l=e?e.component:l).parentNode.insertBefore(n,l),l=t}if(u.isMedia(o)){let e=u.createElement("BR"),t=u.createElement(d.defaultTag);t.appendChild(e),i.appendChild(t),o=e}p._showToolbarBalloon(this.setRange(l,0,o,o.textContent.length));break;case"codeView":this.toggleCodeView();break;case"fullScreen":this.toggleFullScreen(t);break;case"indent":case"outdent":this.indent(n);break;case"undo":this.history.undo();break;case"redo":this.history.redo();break;case"removeFormat":this.removeFormat(),this.focus();break;case"print":this.print();break;case"preview":this.preview();break;case"showBlocks":this.toggleDisplayBlocks();break;case"dir":this.setDir(d.rtl?"ltr":"rtl");break;case"dir_ltr":this.setDir("ltr");break;case"dir_rtl":this.setDir("rtl");break;case"save":if("function"==typeof d.callBackSave)d.callBackSave(this.getContents(!1),this._variable.isChanged);else if(this._variable.isChanged&&"function"==typeof y.save)y.save();else throw Error("[SUNEDITOR.core.commandHandler.fail] Please register call back function in creation option. (callBackSave : Function)");this._variable.isChanged=!1,e.tool.save&&e.tool.save.setAttribute("disabled",!0);break;default:n=d._defaultCommand[n.toLowerCase()]||n,this.commandMap[n]||(this.commandMap[n]=t);let s=this._variable.currentNodesMap,r=s.indexOf(n)>-1?null:u.createElement(n),a=n;/^SUB$/i.test(n)&&s.indexOf("SUP")>-1?a="SUP":/^SUP$/i.test(n)&&s.indexOf("SUB")>-1&&(a="SUB"),this.nodeChange(r,this._commandMapStyles[n]||null,[a],!1),this.focus()}},removeFormat:function(){this.nodeChange(null,null,null,null)},indent:function(e){let t=this.getRange(),n=this.getSelectedElements(null),i=[],l="indent"!==e,o=d.rtl?"marginRight":"marginLeft",s=t.startContainer,r=t.endContainer,a=t.startOffset,c=t.endOffset;for(let e=0,t=n.length,s,r;e<t;e++)s=n[e],u.isListCell(s)&&this.plugins.list?(l||s.previousElementSibling)&&i.push(s):(r=/\d+/.test(s.style[o])?u.getNumber(s.style[o],0):0,l?r-=25:r+=25,u.setStyle(s,o,r<=0?"":r+"px"));i.length>0&&this.plugins.list.editInsideList.call(this,l,i),this.effectNode=null,this.setRange(s,a,r,c),this.history.push(!1)},toggleDisplayBlocks:function(){let t=e.element.wysiwyg;u.toggleClass(t,"se-show-block"),u.hasClass(t,"se-show-block")?u.addClass(this._styleCommandMap.showBlocks,"active"):u.removeClass(this._styleCommandMap.showBlocks,"active"),this._resourcesStateChange()},toggleCodeView:function(){let t=this._variable.isCodeView;this.controllersOff(),u.setDisabledButtons(!t,this.codeViewDisabledButtons),t?(u.isNonEditable(e.element.wysiwygFrame)||this._setCodeDataToEditor(),e.element.wysiwygFrame.scrollTop=0,e.element.code.style.display="none",e.element.wysiwygFrame.style.display="block",this._variable._codeOriginCssText=this._variable._codeOriginCssText.replace(/(\s?display(\s+)?:(\s+)?)[a-zA-Z]+(?=;)/,"display: none"),this._variable._wysiwygOriginCssText=this._variable._wysiwygOriginCssText.replace(/(\s?display(\s+)?:(\s+)?)[a-zA-Z]+(?=;)/,"display: block"),"auto"!==d.height||d.codeMirrorEditor||(e.element.code.style.height="0px"),this._variable.isCodeView=!1,!this._variable.isFullScreen&&(this._notHideToolbar=!1,/balloon|balloon-always/i.test(d.mode)&&(e.element._arrow.style.display="",this._isInline=!1,this._isBalloon=!0,p._hideToolbar())),this.nativeFocus(),u.removeClass(this._styleCommandMap.codeView,"active"),u.isNonEditable(e.element.wysiwygFrame)||(this.history.push(!1),this.history._resetCachingButton())):(this._setEditorDataToCodeView(),this._variable._codeOriginCssText=this._variable._codeOriginCssText.replace(/(\s?display(\s+)?:(\s+)?)[a-zA-Z]+(?=;)/,"display: block"),this._variable._wysiwygOriginCssText=this._variable._wysiwygOriginCssText.replace(/(\s?display(\s+)?:(\s+)?)[a-zA-Z]+(?=;)/,"display: none"),this._variable.isFullScreen?e.element.code.style.height="100%":"auto"!==d.height||d.codeMirrorEditor||(e.element.code.style.height=e.element.code.scrollHeight>0?e.element.code.scrollHeight+"px":"auto"),d.codeMirrorEditor&&d.codeMirrorEditor.refresh(),this._variable.isCodeView=!0,!this._variable.isFullScreen&&(this._notHideToolbar=!0,this._isBalloon&&(e.element._arrow.style.display="none",e.element.toolbar.style.left="",this._isInline=!0,this._isBalloon=!1,p._showToolbarInline())),this._variable._range=null,e.element.code.focus(),u.addClass(this._styleCommandMap.codeView,"active")),this._checkPlaceholder(),this.isReadOnly&&u.setDisabledButtons(!0,this.resizingDisabledButtons),"function"==typeof y.toggleCodeView&&y.toggleCodeView(this._variable.isCodeView,this)},_setCodeDataToEditor:function(){let t=this._getCodeView();if(d.fullPage){let e=this._parser.parseFromString(t,"text/html"),n=e.head.children;for(let t=0,i=n.length;t<i;t++)/^script$/i.test(n[t].tagName)&&(e.head.removeChild(n[t]),t--,i--);let i=e.head.innerHTML;e.head.querySelector('link[rel="stylesheet"]')&&("auto"!==this.options.height||e.head.querySelector("style"))||(i+=u._setIframeCssTags(this.options)),this._wd.head.innerHTML=i,this._wd.body.innerHTML=this.convertContentsForEditor(e.body.innerHTML);let l=e.body.attributes;for(let e=0,t=l.length;e<t;e++)"contenteditable"!==l[e].name&&this._wd.body.setAttribute(l[e].name,l[e].value);if(!u.hasClass(this._wd.body,"sun-editor-editable")){let e=d._editableClass.split(" ");for(let t=0;t<e.length;t++)u.addClass(this._wd.body,d._editableClass[t])}}else e.element.wysiwyg.innerHTML=t.length>0?this.convertContentsForEditor(t):"<"+d.defaultTag+"><br></"+d.defaultTag+">"},_setEditorDataToCodeView:function(){let t=this.convertHTMLForCodeView(e.element.wysiwyg,!1),n="";if(d.fullPage){let e=u.getAttributesToString(this._wd.body,null);n="<!DOCTYPE html>\n<html>\n"+this._wd.head.outerHTML.replace(/>(?!\n)/g,">\n")+"<body "+e+">\n"+t+"</body>\n</html>"}else n=t;e.element.code.style.display="block",e.element.wysiwygFrame.style.display="none",this._setCodeView(n)},toggleFullScreen:function(t){let n=e.element.topArea,i=e.element.toolbar,l=e.element.editorArea,o=e.element.wysiwygFrame,s=e.element.code,r=this._variable;this.controllersOff();let a="none"===i.style.display||this._isInline&&!this._inlineToolbarAttr.isShow;r.isFullScreen?(r.isFullScreen=!1,o.style.cssText=r._wysiwygOriginCssText,s.style.cssText=r._codeOriginCssText,i.style.cssText="",l.style.cssText=r._editorAreaOriginCssText,n.style.cssText=r._originCssText,h.body.style.overflow=r._bodyOverflow,"auto"!==d.height||d.codeMirrorEditor||p._codeViewAutoHeight(),d.toolbarContainer&&d.toolbarContainer.appendChild(i),d.stickyToolbar>-1&&u.removeClass(i,"se-toolbar-sticky"),r._fullScreenAttrs.sticky&&!d.toolbarContainer&&(r._fullScreenAttrs.sticky=!1,e.element._stickyDummy.style.display="block",u.addClass(i,"se-toolbar-sticky")),this._isInline=r._fullScreenAttrs.inline,this._isBalloon=r._fullScreenAttrs.balloon,this._isInline&&p._showToolbarInline(),d.toolbarContainer&&u.removeClass(i,"se-toolbar-balloon"),p.onScroll_window(),t&&u.changeElement(t.firstElementChild,g.expansion),e.element.topArea.style.marginTop="",u.removeClass(this._styleCommandMap.fullScreen,"active")):(r.isFullScreen=!0,r._fullScreenAttrs.inline=this._isInline,r._fullScreenAttrs.balloon=this._isBalloon,(this._isInline||this._isBalloon)&&(this._isInline=!1,this._isBalloon=!1),d.toolbarContainer&&e.element.relative.insertBefore(i,l),n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.maxWidth="100%",n.style.height="100%",n.style.zIndex="2147483647",""!==e.element._stickyDummy.style.display&&(r._fullScreenAttrs.sticky=!0,e.element._stickyDummy.style.display="none",u.removeClass(i,"se-toolbar-sticky")),r._bodyOverflow=h.body.style.overflow,h.body.style.overflow="hidden",r._editorAreaOriginCssText=l.style.cssText,r._wysiwygOriginCssText=o.style.cssText,r._codeOriginCssText=s.style.cssText,l.style.cssText=i.style.cssText="",o.style.cssText=(o.style.cssText.match(/\s?display(\s+)?:(\s+)?[a-zA-Z]+;/)||[""])[0]+d._editorStyles.editor,s.style.cssText=(s.style.cssText.match(/\s?display(\s+)?:(\s+)?[a-zA-Z]+;/)||[""])[0],i.style.width=o.style.height=s.style.height="100%",i.style.position="relative",i.style.display="block",r.innerHeight_fullScreen=f.innerHeight-i.offsetHeight,l.style.height=r.innerHeight_fullScreen-d.fullScreenOffset+"px",t&&u.changeElement(t.firstElementChild,g.reduction),d.iframe&&"auto"===d.height&&(l.style.overflow="auto",this._iframeAutoHeight()),e.element.topArea.style.marginTop=d.fullScreenOffset+"px",u.addClass(this._styleCommandMap.fullScreen,"active")),a&&y.toolbar.hide(),"function"==typeof y.toggleFullScreen&&y.toggleFullScreen(this._variable.isFullScreen,this)},print:function(){let e=u.createElement("IFRAME");e.style.display="none",h.body.appendChild(e);let t=d.printTemplate?d.printTemplate.replace(/\{\{\s*contents\s*\}\}/i,this.getContents(!0)):this.getContents(!0),n=u.getIframeDocument(e),i=this._wd;if(d.iframe){let e=null!==d._printClass?'class="'+d._printClass+'"':d.fullPage?u.getAttributesToString(i.body,["contenteditable"]):'class="'+d._editableClass+'"';n.write("<!DOCTYPE html><html><head>"+i.head.innerHTML+"</head><body "+e+">"+t+"</body></html>")}else{let e=h.head.getElementsByTagName("link"),i=h.head.getElementsByTagName("style"),l="";for(let t=0,n=e.length;t<n;t++)l+=e[t].outerHTML;for(let e=0,t=i.length;e<t;e++)l+=i[e].outerHTML;n.write("<!DOCTYPE html><html><head>"+l+'</head><body class="'+(null!==d._printClass?d._printClass:d._editableClass)+'">'+t+"</body></html>")}this.showLoading(),f.setTimeout(function(){try{if(e.focus(),u.isIE_Edge||u.isChromium||h.documentMode||f.StyleMedia)try{e.contentWindow.document.execCommand("print",!1,null)}catch(t){e.contentWindow.print()}else e.contentWindow.print()}catch(e){throw Error("[SUNEDITOR.core.print.fail] error: "+e)}finally{m.closeLoading(),u.removeItem(e)}},1e3)},preview:function(){m.submenuOff(),m.containerOff(),m.controllersOff();let e=d.previewTemplate?d.previewTemplate.replace(/\{\{\s*contents\s*\}\}/i,this.getContents(!0)):this.getContents(!0),t=f.open("","_blank");t.mimeType="text/html";let n=this._wd;if(d.iframe){let i=null!==d._printClass?'class="'+d._printClass+'"':d.fullPage?u.getAttributesToString(n.body,["contenteditable"]):'class="'+d._editableClass+'"';t.document.write("<!DOCTYPE html><html><head>"+n.head.innerHTML+"<style>body {overflow:auto !important; margin: 10px auto !important; height:auto !important; outline:1px dashed #ccc;}</style></head><body "+i+">"+e+"</body></html>")}else{let n=h.head.getElementsByTagName("link"),i=h.head.getElementsByTagName("style"),l="";for(let e=0,t=n.length;e<t;e++)l+=n[e].outerHTML;for(let e=0,t=i.length;e<t;e++)l+=i[e].outerHTML;t.document.write('<!DOCTYPE html><html><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>'+a.toolbar.preview+"</title>"+l+'</head><body class="'+(null!==d._printClass?d._printClass:d._editableClass)+'" style="margin:10px auto !important; height:auto !important; outline:1px dashed #ccc;">'+e+"</body></html>")}},setDir:function(t){let n="rtl"===t,i=this._prevRtl!==n;this._prevRtl=d.rtl=n,i&&(this.plugins.align&&this.plugins.align.exchangeDir.call(this),e.tool.indent&&u.changeElement(e.tool.indent.firstElementChild,g.indent),e.tool.outdent&&u.changeElement(e.tool.outdent.firstElementChild,g.outdent));let l=e.element;n?(u.addClass(l.topArea,"se-rtl"),u.addClass(l.wysiwygFrame,"se-rtl")):(u.removeClass(l.topArea,"se-rtl"),u.removeClass(l.wysiwygFrame,"se-rtl"));let o=u.getListChildren(l.wysiwyg,function(e){return u.isFormatElement(e)&&(e.style.marginRight||e.style.marginLeft||e.style.textAlign)});for(let e=0,t=o.length,n,i,l;e<t;e++)l=(n=o[e]).style.marginRight,i=n.style.marginLeft,(l||i)&&(n.style.marginRight=i,n.style.marginLeft=l),"left"===(l=n.style.textAlign)?n.style.textAlign="right":"right"===l&&(n.style.textAlign="left");let s=e.tool;s.dir&&(u.changeTxt(s.dir.querySelector(".se-tooltip-text"),a.toolbar[d.rtl?"dir_ltr":"dir_rtl"]),u.changeElement(s.dir.firstElementChild,g[d.rtl?"dir_ltr":"dir_rtl"])),s.dir_ltr&&(n?u.removeClass(s.dir_ltr,"active"):u.addClass(s.dir_ltr,"active")),s.dir_rtl&&(n?u.addClass(s.dir_rtl,"active"):u.removeClass(s.dir_rtl,"active"))},setContents:function(t){this.removeRange();let n=null==t?"":this.convertContentsForEditor(t,null,null);if(this._variable.isCodeView){let e=this.convertHTMLForCodeView(n,!1);this._setCodeView(e)}else e.element.wysiwyg.innerHTML=n,this._resetComponents(),this.history.push(!1)},setIframeContents:function(e){if(!d.iframe)return!1;e.head&&(this._wd.head.innerHTML=e.head.replace(/<script[\s\S]*>[\s\S]*<\/script>/gi,"")),e.body&&(this._wd.body.innerHTML=this.convertContentsForEditor(e.body)),this._resetComponents()},getContents:function(t){let n=this.cleanHTML(e.element.wysiwyg.innerHTML,null,null),i=u.createElement("DIV");i.innerHTML=n;let l=u.getListChildren(i,function(e){return/FIGCAPTION/i.test(e.nodeName)});for(let e=0,t=l.length;e<t;e++)l[e].removeAttribute("contenteditable");if(!d.fullPage||t)return i.innerHTML;{let e=u.getAttributesToString(this._wd.body,["contenteditable"]);return"<!DOCTYPE html><html>"+this._wd.head.outerHTML+"<body "+e+">"+i.innerHTML+"</body></html>"}},getFullContents:function(e){return'<div class="sun-editor-editable'+(d.rtl?" se-rtl":"")+'">'+this.getContents(e)+"</div>"},_makeLine:function(e,t){let n=d.defaultTag;if(1===e.nodeType){if(u._disallowedTags(e))return"";if(/__se__tag/.test(e.className))return e.outerHTML;let i=u.getListChildNodes(e,function(e){return u.isSpanWithoutAttr(e)&&!u.getParentElement(e,u.isNotCheckingNode)})||[];for(let e=i.length-1;e>=0;e--)i[e].outerHTML=i[e].innerHTML;return!t||u.isFormatElement(e)||u.isRangeFormatElement(e)||u.isComponent(e)||u.isMedia(e)||u.isAnchor(e)&&u.isMedia(e.firstElementChild)?u.isSpanWithoutAttr(e)?e.innerHTML:e.outerHTML:"<"+n+">"+(u.isSpanWithoutAttr(e)?e.innerHTML:e.outerHTML)+"</"+n+">"}if(3===e.nodeType){if(!t)return u._HTMLConvertor(e.textContent);let i=e.textContent.split(/\n/g),l="";for(let e=0,t=i.length,o;e<t;e++)(o=i[e].trim()).length>0&&(l+="<"+n+">"+u._HTMLConvertor(o)+"</"+n+">");return l}return 8===e.nodeType&&this._allowHTMLComments?"<!--"+e.textContent.trim()+"-->":""},_tagConvertor:function(e){if(!this._disallowedTextTagsRegExp)return e;let t=d._textTagsMap;return e.replace(this._disallowedTextTagsRegExp,function(e,n,i,l){return n+("string"==typeof t[i]?t[i]:i)+(l?" "+l:"")})},_deleteDisallowedTags:function(e){return e=e.replace(/<(script|style)[\s\S]*>[\s\S]*<\/(script|style)>/gi,"").replace(/<[a-z0-9]+\:[a-z0-9]+[^>^\/]*>[^>]*<\/[a-z0-9]+\:[a-z0-9]+>/gi,""),/\bfont\b/i.test(this.options._editorTagsWhitelist)||(e=e.replace(/(<\/?)font(\s?)/gi,"$1span$2")),e.replace(this.editorTagsWhitelistRegExp,"").replace(this.editorTagsBlacklistRegExp,"")},_convertFontSize:function(e,t){let n=this._w.Math,i=t.match(/(\d+(?:\.\d+)?)(.+)/),l=1*i[1],o=i[2],s=l;switch(/em/.test(o)?s=n.round(l/.0625):"pt"===o?s=n.round(1.333*l):"%"===o&&(s=l/100),e){case"em":case"rem":case"%":return(.0625*s).toFixed(2)+e;case"pt":return n.floor(s/1.333)+e;default:return s+e}},_cleanStyle:function(e,t,n){let i=(e.match(/style\s*=\s*(?:"|')[^"']*(?:"|')/)||[])[0];if(/span/i.test(n)&&!i&&(e.match(/<span\s(.+)/)||[])[1]){let t=(e.match(/\ssize="([^"]+)"/i)||[])[1],n=(e.match(/\sface="([^"]+)"/i)||[])[1],l=(e.match(/\scolor="([^"]+)"/i)||[])[1];(t||n||l)&&(i='style="'+(t?"font-size:"+this.util.getNumber(t/3.333,1)+"rem;":"")+(n?"font-family:"+n+";":"")+(l?"color:"+l+";":"")+'"')}if(i){t||(t=[]);let e=i.replace(/&quot;/g,"").match(this._cleanStyleRegExp[n]);if(e){let n=[];for(let t=0,i=e.length,l;t<i;t++)if((l=e[t].match(/([a-zA-Z0-9-]+)(:)([^:]+$)/))&&!/inherit|initial/i.test(l[3])){let e=u.kebabToCamelCase(l[1].trim()),t=this.wwComputedStyle[e].replace(/"/g,""),i=l[3].trim();switch(e){case"fontFamily":if(!d.plugins.font||-1===d.font.indexOf(i))continue;break;case"fontSize":if(!d.plugins.fontSize)continue;this._cleanStyleRegExp.fontSizeUnit.test(l[0])||(l[0]=l[0].replace(this._w.RegExp("\\d+"+l[0].match(/\d+(.+$)/)[1]),this._convertFontSize.bind(this,d.fontSizeUnit)));break;case"color":if(!d.plugins.fontColor||/rgba\(([0-9]+\s*,\s*){3}0\)|windowtext/i.test(i))continue;break;case"backgroundColor":if(!d.plugins.hiliteColor||/rgba\(([0-9]+\s*,\s*){3}0\)|windowtext/i.test(i))continue}t!==i&&n.push(l[0])}n.length>0&&t.push('style="'+n.join(";")+'"')}}return t},_cleanTags:function(e,t,n){if(/^<[a-z0-9]+\:[a-z0-9]+/i.test(t))return t;let i=null,l=n.match(/(?!<)[a-zA-Z0-9\-]+/)[0].toLowerCase(),o=this._attributesTagsBlacklist[l];t=t.replace(/\s(?:on[a-z]+)\s*=\s*(")[^"]*\1/ig,""),t=o?t.replace(o,""):t.replace(this._attributesBlacklistRegExp,"");let s=this._attributesTagsWhitelist[l];if(i=s?t.match(s):t.match(e?this._attributesWhitelistRegExp:this._attributesWhitelistRegExp_all_data),e){if("a"===l){let e=t.match(/(?:(?:id|name)\s*=\s*(?:"|')[^"']*(?:"|'))/g);e&&(i||(i=[]),i.push(e[0]))}else i&&/style=/i.test(i.toString())||("span"===l?i=this._cleanStyle(t,i,"span"):/^(P|DIV|H[1-6]|PRE)$/i.test(l)&&(i=this._cleanStyle(t,i,"format")))}else{let e=t.match(/style\s*=\s*(?:"|')[^"']*(?:"|')/);e&&!i?i=[e[0]]:e&&!i.some(function(e){return/^style/.test(e.trim())})&&i.push(e[0])}if("img"===l){let e="",n="",l=t.match(/style\s*=\s*(?:"|')[^"']*(?:"|')/);if(i||(i=[]),l&&(e=l[0].match(/width:(.+);/),e=u.getNumber(e?e[1]:"",-1)||"",n=l[0].match(/height:(.+);/),n=u.getNumber(n?n[1]:"",-1)||""),!e||!n){let i=t.match(/width\s*=\s*((?:"|')[^"']*(?:"|'))/),l=t.match(/height\s*=\s*((?:"|')[^"']*(?:"|'))/);(i||l)&&(e=e||u.getNumber(i?i[1]:"")||"",n=n||u.getNumber(l?l[1]:"")||"")}i.push('data-origin="'+e+","+n+'"')}if(i)for(let e=0,t=i.length;e<t;e++)n+=" "+(/^(?:href|src)\s*=\s*('|"|\s)*javascript\s*\:/i.test(i[e].trim())?"":i[e]);return n},_editFormat:function(e){let t="",n,i=e.childNodes;for(let e=0,l=i.length,o;e<l;e++)8===(o=i[e]).nodeType?t+="<!-- "+o.textContent+" -->":u.isFormatElement(o)||u.isRangeFormatElement(o)||u.isComponent(o)||/meta/i.test(o.nodeName)?(n&&(t+=n.outerHTML,n=null),t+=o.outerHTML):(n||(n=u.createElement(d.defaultTag)),n.appendChild(o),e--,l--);return n&&(t+=n.outerHTML),h.createRange().createContextualFragment(t)},_convertListCell:function(e){let t="";for(let n=0,i=e.length,l;n<i;n++)1===(l=e[n]).nodeType?u.isList(l)?t+=l.innerHTML:u.isListCell(l)?t+=l.outerHTML:u.isFormatElement(l)?t+="<li>"+(l.innerHTML.trim()||"<br>")+"</li>":u.isRangeFormatElement(l)&&!u.isTable(l)?t+=this._convertListCell(l):t+="<li>"+l.outerHTML+"</li>":t+="<li>"+(l.textContent||"<br>")+"</li>";return t},_isFormatData:function(e){let t=!1;for(let n=0,i=e.length,l;n<i;n++)if(1===(l=e[n]).nodeType&&!u.isTextStyleElement(l)&&!u.isBreak(l)&&!u._disallowedTags(l)){t=!0;break}return t},cleanHTML:function(e,t,n){e=this._deleteDisallowedTags(this._parser.parseFromString(e,"text/html").body.innerHTML).replace(/(<[a-zA-Z0-9\-]+)[^>]*(?=>)/g,this._cleanTags.bind(this,!0));let i=h.createRange().createContextualFragment(e);try{u._consistencyCheckOfHTML(i,this._htmlCheckWhitelistRegExp,this._htmlCheckBlacklistRegExp,!0)}catch(e){console.warn("[SUNEDITOR.cleanHTML.consistencyCheck.fail] "+e)}if(this.managedTagsInfo&&this.managedTagsInfo.query){let e=i.querySelectorAll(this.managedTagsInfo.query);for(let t=0,n=e.length,i,l;t<n;t++){l=[].slice.call(e[t].classList);for(let n=0,o=l.length;n<o;n++)if(i=this.managedTagsInfo.map[l[n]]){i(e[t]);break}}}let l=i.childNodes,o="",s=this._isFormatData(l);s&&(l=this._editFormat(i).childNodes);for(let e=0,t=l.length;e<t;e++)o+=this._makeLine(l[e],s);return(o=u.htmlRemoveWhiteSpace(o))?(t&&(o=o.replace("string"==typeof t?u.createTagsWhitelist(t):t,"")),n&&(o=o.replace("string"==typeof n?u.createTagsBlacklist(n):n,""))):o=e,this._tagConvertor(o)},convertContentsForEditor:function(e){e=this._deleteDisallowedTags(this._parser.parseFromString(e,"text/html").body.innerHTML).replace(/(<[a-zA-Z0-9\-]+)[^>]*(?=>)/g,this._cleanTags.bind(this,!1));let t=h.createRange().createContextualFragment(e);try{u._consistencyCheckOfHTML(t,this._htmlCheckWhitelistRegExp,this._htmlCheckBlacklistRegExp,!1)}catch(e){console.warn("[SUNEDITOR.convertContentsForEditor.consistencyCheck.fail] "+e)}if(this.managedTagsInfo&&this.managedTagsInfo.query){let e=t.querySelectorAll(this.managedTagsInfo.query);for(let t=0,n=e.length,i,l;t<n;t++){l=[].slice.call(e[t].classList);for(let n=0,o=l.length;n<o;n++)if(i=this.managedTagsInfo.map[l[n]]){i(e[t]);break}}}let n=t.childNodes,i="",l=null;for(let e=0,t;e<n.length;e++){if(t=n[e],!u.isFormatElement(t)&&!u.isRangeFormatElement(t)&&!u.isComponent(t)&&!u.isMedia(t)&&8!==t.nodeType&&!/__se__tag/.test(t.className)){if(l||(l=u.createElement(d.defaultTag)),l.appendChild(t),n[--e+1]&&!u.isFormatElement(n[e+1]))continue;t=l,l=null}l&&(i+=this._makeLine(l,!0),l=null),i+=this._makeLine(t,!0)}return(l&&(i+=this._makeLine(l,!0)),0===i.length)?"<"+d.defaultTag+"><br></"+d.defaultTag+">":(i=u.htmlRemoveWhiteSpace(i),this._tagConvertor(i))},convertHTMLForCodeView:function(e,t){let n="",i=f.RegExp,l=new i("^(BLOCKQUOTE|PRE|TABLE|THEAD|TBODY|TR|TH|TD|OL|UL|IMG|IFRAME|VIDEO|AUDIO|FIGURE|FIGCAPTION|HR|BR|CANVAS|SELECT)$","i"),o="string"==typeof e?h.createRange().createContextualFragment(e):e,s=(function(e){return this.isFormatElement(e)||this.isComponent(e)}).bind(u),r=t?"":"\n",a=t?0:1*this._variable.codeIndent;return a=a>0?new f.Array(a+1).join(" "):"",!function recursionFunc(e,t){let o=e.childNodes,d=l.test(e.nodeName),c=d?t:"";for(let h=0,g=o.length,m,p,y,C,_,b;h<g;h++){if(m=o[h],p=(C=l.test(m.nodeName))?r:"",y=!s(m)||d||/^(TH|TD)$/i.test(e.nodeName)?"":r,8===m.nodeType){n+="\n<!-- "+m.textContent.trim()+" -->"+p;continue}if(3===m.nodeType){u.isList(m.parentElement)||(n+=u._HTMLConvertor(/^\n+$/.test(m.data)?"":m.data));continue}if(0===m.childNodes.length){n+=(/^HR$/i.test(m.nodeName)?r:"")+(/^PRE$/i.test(m.parentElement.nodeName)&&/^BR$/i.test(m.nodeName)?"":c)+m.outerHTML+p;continue}m.outerHTML?(_=m.nodeName.toLowerCase(),n+=(y||(d?"":p))+(b=c||C?t:"")+m.outerHTML.match(i("<"+_+"[^>]*>","i"))[0]+p,recursionFunc(m,t+a,""),n+=(/\n$/.test(n)?b:"")+"</"+_+">"+(y||p||d?r:/^(TH|TD)$/i.test(m.nodeName)?r:"")):n+=new f.XMLSerializer().serializeToString(m)}}(o,""),n.trim()+r},addDocEvent:function(e,t,n){h.addEventListener(e,t,n),d.iframe&&this._wd.addEventListener(e,t)},removeDocEvent:function(e,t){h.removeEventListener(e,t),d.iframe&&this._wd.removeEventListener(e,t)},_charCount:function(e){let t=d.maxCharCount,n=d.charCounterType,i=0;if(e&&(i=this.getCharLength(e,n)),this._setCharCount(),t>0){let e=!1,l=y.getCharCount(n);if(l>t){if(e=!0,i>0){this._editorRange();let e=this.getRange(),n=e.endOffset-1,i=this.getSelectionNode().textContent,o=e.endOffset-(l-t);this.getSelectionNode().textContent=i.slice(0,o<0?0:o)+i.slice(e.endOffset,i.length),this.setRange(e.endContainer,n,e.endContainer,n)}}else l+i>t&&(e=!0);if(e&&(this._callCounterBlink(),i>0))return!1}return!0},checkCharCount:function(e,t){if(d.maxCharCount){let n=t||d.charCounterType,i=this.getCharLength("string"==typeof e?e:this._charTypeHTML&&1===e.nodeType?e.outerHTML:e.textContent,n);if(i>0&&i+y.getCharCount(n)>d.maxCharCount)return this._callCounterBlink(),!1}return!0},getCharLength:function(e,t){return/byte/.test(t)?u.getByteLength(e):e.length},resetResponsiveToolbar:function(){m.controllersOff();let t=p._responsiveButtonSize;if(t){let n=0;n=(m._isBalloon||m._isInline)&&"auto"===d.toolbarWidth?e.element.topArea.offsetWidth:e.element.toolbar.offsetWidth;let i="default";for(let e=1,l=t.length;e<l;e++)if(n<t[e]){i=t[e]+"";break}p._responsiveCurrentSize!==i&&(p._responsiveCurrentSize=i,y.setToolbarButtons(p._responsiveButtons[i]))}},_setCharCount:function(){e.element.charCounter&&f.setTimeout(function(){e.element.charCounter.textContent=y.getCharCount(d.charCounterType)})},_callCounterBlink:function(){let t=e.element.charWrapper;t&&!u.hasClass(t,"se-blink")&&(u.addClass(t,"se-blink"),f.setTimeout(function(){u.removeClass(t,"se-blink")},600))},_checkComponents:function(){for(let e=0,t=this._fileInfoPluginsCheck.length;e<t;e++)this._fileInfoPluginsCheck[e]()},_resetComponents:function(){for(let e=0,t=this._fileInfoPluginsReset.length;e<t;e++)this._fileInfoPluginsReset[e]()},_setCodeView:function(t){d.codeMirrorEditor?d.codeMirrorEditor.getDoc().setValue(t):e.element.code.value=t},_getCodeView:function(){return d.codeMirrorEditor?d.codeMirrorEditor.getDoc().getValue():e.element.code.value},_setKeyEffect:function(e){let t=this.commandMap,i=this.activePlugins;for(let l in t)!(e.indexOf(l)>-1)&&u.hasOwn(t,l)&&(i.indexOf(l)>-1?n[l].active.call(this,null):t.OUTDENT&&/^OUTDENT$/i.test(l)?u.isImportantDisabled(t.OUTDENT)||t.OUTDENT.setAttribute("disabled",!0):t.INDENT&&/^INDENT$/i.test(l)?u.isImportantDisabled(t.INDENT)||t.INDENT.removeAttribute("disabled"):u.removeClass(t[l],"active"))},_init:function(i,l){let s,a;let c=f.RegExp;if(this._ww=d.iframe?e.element.wysiwygFrame.contentWindow:f,this._wd=h,this._charTypeHTML="byte-html"===d.charCounterType,this.wwComputedStyle=f.getComputedStyle(e.element.wysiwyg),this._editorHeight=e.element.wysiwygFrame.offsetHeight,this._editorHeightPadding=u.getNumber(this.wwComputedStyle.getPropertyValue("padding-top"))+u.getNumber(this.wwComputedStyle.getPropertyValue("padding-bottom")),!d.iframe&&"function"==typeof f.ShadowRoot){let t=e.element.wysiwygFrame;for(;t;){if(t.shadowRoot){this._shadowRoot=t.shadowRoot;break}if(t instanceof f.ShadowRoot){this._shadowRoot=t;break}t=t.parentNode}this._shadowRoot&&(this._shadowRootControllerEventTarget=[])}let g=f.Object.keys(d._textTagsMap),m=d.addTagsWhitelist?d.addTagsWhitelist.split("|").filter(function(e){return/b|i|ins|s|strike/i.test(e)}):[];for(let e=0;e<m.length;e++)g.splice(g.indexOf(m[e].toLowerCase()),1);this._disallowedTextTagsRegExp=0===g.length?null:new c("(<\\/?)("+g.join("|")+")\\b\\s*([^>^<]+)?\\s*(?=>)","gi");let getRegList=function(e,t){return e?"*"===e?"[a-z-]+":t?e+"|"+t:e:"^"},p="contenteditable|colspan|rowspan|target|href|download|rel|src|alt|class|type|controls|origin-size";this._allowHTMLComments=d._editorTagsWhitelist.indexOf("//")>-1||"*"===d._editorTagsWhitelist,this._htmlCheckWhitelistRegExp=new c("^("+getRegList(d._editorTagsWhitelist.replace("|//",""),"")+")$","i"),this._htmlCheckBlacklistRegExp=new c("^("+(d.tagsBlacklist||"^")+")$","i"),this.editorTagsWhitelistRegExp=u.createTagsWhitelist(getRegList(d._editorTagsWhitelist.replace("|//","|<!--|-->"),"")),this.editorTagsBlacklistRegExp=u.createTagsBlacklist(d.tagsBlacklist.replace("|//","|<!--|-->")),this.pasteTagsWhitelistRegExp=u.createTagsWhitelist(getRegList(d.pasteTagsWhitelist,"")),this.pasteTagsBlacklistRegExp=u.createTagsBlacklist(d.pasteTagsBlacklist);let y='\\s*=\\s*(")[^"]*\\1',C=d.attributesWhitelist,_={},b="";if(C)for(let e in C)!u.hasOwn(C,e)||/^on[a-z]+$/i.test(C[e])||("all"===e?b=getRegList(C[e],p):_[e]=new c("\\s(?:"+getRegList(C[e],"")+")"+y,"ig"));this._attributesWhitelistRegExp=new c("\\s(?:"+(b||p+"|data-format|data-size|data-file-size|data-file-name|data-origin|data-align|data-image-link|data-rotate|data-proportion|data-percentage|data-exp|data-font-size")+")"+y,"ig"),this._attributesWhitelistRegExp_all_data=new c("\\s(?:"+(b||p)+"|data-[a-z0-9\\-]+)"+y,"ig"),this._attributesTagsWhitelist=_;let v=d.attributesBlacklist;if(_={},b="",v)for(let e in v)u.hasOwn(v,e)&&("all"===e?b=getRegList(v[e],""):_[e]=new c("\\s(?:"+getRegList(v[e],"")+")"+y,"ig"));this._attributesBlacklistRegExp=new c("\\s(?:"+(b||"^")+")"+y,"ig"),this._attributesTagsBlacklist=_,this._isInline=/inline/i.test(d.mode),this._isBalloon=/balloon|balloon-always/i.test(d.mode),this._isBalloonAlways=/balloon-always/i.test(d.mode),this._cachingButtons(),this._fileInfoPluginsCheck=[],this._fileInfoPluginsReset=[],this.managedTagsInfo={query:"",map:{}};let E=[];this.activePlugins=[],this._fileManager.tags=[],this._fileManager.pluginMap={};let T=[];for(let e in n)if(u.hasOwn(n,e)){if(s=n[e],a=t[e],(s.active||s.action)&&a&&this.callPlugin(e,null,a),"function"==typeof s.checkFileInfo&&"function"==typeof s.resetFileInfo&&(this.callPlugin(e,null,a),this._fileInfoPluginsCheck.push(s.checkFileInfo.bind(this)),this._fileInfoPluginsReset.push(s.resetFileInfo.bind(this))),f.Array.isArray(s.fileTags)){let t=s.fileTags;this.callPlugin(e,null,a),this._fileManager.tags=this._fileManager.tags.concat(t),T.push(e);for(let n=0,i=t.length;n<i;n++)this._fileManager.pluginMap[t[n].toLowerCase()]=e}if(s.managedTags){let e=s.managedTags();E.push("."+e.className),this.managedTagsInfo.map[e.className]=e.method.bind(this)}}this.managedTagsInfo.query=E.toString(),this._fileManager.queryString=this._fileManager.tags.join(","),this._fileManager.regExp=new c("^("+(this._fileManager.tags.join("|")||"^")+")$","i"),this._fileManager.pluginRegExp=new c("^("+(0===T.length?"^":T.join("|"))+")$","i"),this._variable._originCssText=e.element.topArea.style.cssText,this._placeholder=e.element.placeholder,this._lineBreaker=e.element.lineBreaker,this._lineBreakerButton=this._lineBreaker.querySelector("button"),this.history=(0,o.Z)(this,this._onChange_historyStack.bind(this)),this.addModule([r.Z]),d.iframe&&(this._wd=e.element.wysiwygFrame.contentDocument,e.element.wysiwyg=this._wd.body,d._editorStyles.editor&&(e.element.wysiwyg.style.cssText=d._editorStyles.editor),"auto"===d.height&&(this._iframeAuto=this._wd.body)),this._initWysiwygArea(i,l)},_cachingButtons:function(){this.codeViewDisabledButtons=e.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]:not([class~="se-code-view-enabled"]):not([data-display="MORE"])'),this.resizingDisabledButtons=e.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]:not([class~="se-resizing-enabled"]):not([data-display="MORE"])');let t=e.tool,n=this.commandMap;n.INDENT=t.indent,n.OUTDENT=t.outdent,n[d.textTags.bold.toUpperCase()]=t.bold,n[d.textTags.underline.toUpperCase()]=t.underline,n[d.textTags.italic.toUpperCase()]=t.italic,n[d.textTags.strike.toUpperCase()]=t.strike,n[d.textTags.sub.toUpperCase()]=t.subscript,n[d.textTags.sup.toUpperCase()]=t.superscript,this._styleCommandMap={fullScreen:t.fullScreen,showBlocks:t.showBlocks,codeView:t.codeView},this._saveButtonStates()},_initWysiwygArea:function(t,n){e.element.wysiwyg.innerHTML=t?n:this.convertContentsForEditor("string"==typeof n?n:e.element.originElement.value)},_resourcesStateChange:function(){this._iframeAutoHeight(),this._checkPlaceholder()},_onChange_historyStack:function(){this.hasFocus&&p._applyTagEffects(),this._variable.isChanged=!0,e.tool.save&&e.tool.save.removeAttribute("disabled"),y.onChange&&y.onChange(this.getContents(!0),this),"block"===e.element.toolbar.style.display&&p._showToolbarBalloon()},_iframeAutoHeight:function(){this._iframeAuto?f.setTimeout(function(){let t=m._iframeAuto.offsetHeight;e.element.wysiwygFrame.style.height=t+"px",u.isResizeObserverSupported||m.__callResizeFunction(t,null)}):u.isResizeObserverSupported||m.__callResizeFunction(e.element.wysiwygFrame.offsetHeight,null)},__callResizeFunction:function(e,t){e=-1===e?t.borderBoxSize&&t.borderBoxSize[0]?t.borderBoxSize[0].blockSize:t.contentRect.height+this._editorHeightPadding:e,this._editorHeight!==e&&("function"==typeof y.onResizeEditor&&y.onResizeEditor(e,this._editorHeight,m,t),this._editorHeight=e)},_checkPlaceholder:function(){if(this._placeholder){if(this._variable.isCodeView){this._placeholder.style.display="none";return}let t=e.element.wysiwyg;!u.onlyZeroWidthSpace(t.textContent)||t.querySelector(u._allowedEmptyNodeList)||(t.innerText.match(/\n/g)||"").length>1?this._placeholder.style.display="none":this._placeholder.style.display="block"}},_setDefaultFormat:function(e){let t,n,i;if(this._fileManager.pluginRegExp.test(this.currentControllerName))return;let l=this.getRange(),o=l.commonAncestorContainer,s=l.startContainer,r=u.getRangeFormatElement(o,null),a=u.getParentElement(o,u.isComponent);if(!a||u.isTable(a)){if(1===o.nodeType&&"true"===o.getAttribute("data-se-embed")){let e=o.nextElementSibling;u.isFormatElement(e)||(e=this.appendFormatTag(o,d.defaultTag)),this.setRange(e.firstChild,0,e.firstChild,0);return}if(!((u.isRangeFormatElement(s)||u.isWysiwygDiv(s))&&(u.isComponent(s.children[l.startOffset])||u.isComponent(s.children[l.startOffset-1])))){if(u.getParentElement(o,u.isNotCheckingNode))return null;if(r){(i=u.createElement(e||d.defaultTag)).innerHTML=r.innerHTML,0===i.childNodes.length&&(i.innerHTML=u.zeroWidthSpace),r.innerHTML=i.outerHTML,i=r.firstChild,(t=u.getEdgeChildNodes(i,null).sc)||(t=u.createTextNode(u.zeroWidthSpace),i.insertBefore(t,i.firstChild)),n=t.textContent.length,this.setRange(t,n,t,n);return}if(u.isRangeFormatElement(o)&&o.childNodes.length<=1){let e=null;1===o.childNodes.length&&u.isBreak(o.firstChild)?e=o.firstChild:(e=u.createTextNode(u.zeroWidthSpace),o.appendChild(e)),this.setRange(e,1,e,1);return}if(this.execCommand("formatBlock",!1,e||d.defaultTag),t=(t=u.getEdgeChildNodes(o,o))?t.ec:o,!(i=u.getFormatElement(t,null))){this.removeRange(),this._editorRange();return}if(u.isBreak(i.nextSibling)&&u.removeItem(i.nextSibling),u.isBreak(i.previousSibling)&&u.removeItem(i.previousSibling),u.isBreak(t)){let e=u.createTextNode(u.zeroWidthSpace);t.parentNode.insertBefore(e,t),t=e}this.effectNode=null,this.nativeFocus()}}},_setOptionsInit:function(t,n){this.context=e=(0,l.Z)(t.originElement,this._getConstructed(t),d),this._componentsInfoReset=!0,this._editorInit(!0,n)},_editorInit:function(t,n){this._init(t,n),p._addEvent(),this._setCharCount(),p._offStickyToolbar(),p.onResize_window(),e.element.toolbar.style.visibility="";let i=d.frameAttrbutes;for(let t in i)e.element.wysiwyg.setAttribute(t,i[t]);this._checkComponents(),this._componentsInfoInit=!1,this._componentsInfoReset=!1,this.history.reset(!0),f.setTimeout((function(){p._resizeObserver&&p._resizeObserver.observe(e.element.wysiwygFrame),p._toolbarObserver&&p._toolbarObserver.observe(e.element._toolbarShadow),this._resourcesStateChange(),"function"==typeof y.onload&&y.onload(m,t)}).bind(this))},_getConstructed:function(e){return{_top:e.topArea,_relative:e.relative,_toolBar:e.toolbar,_toolbarShadow:e._toolbarShadow,_menuTray:e._menuTray,_editorArea:e.editorArea,_wysiwygArea:e.wysiwygFrame,_codeArea:e.code,_placeholder:e.placeholder,_resizingBar:e.resizingBar,_navigation:e.navigation,_charCounter:e.charCounter,_charWrapper:e.charWrapper,_loading:e.loading,_lineBreaker:e.lineBreaker,_lineBreaker_t:e.lineBreaker_t,_lineBreaker_b:e.lineBreaker_b,_resizeBack:e.resizeBackground,_stickyDummy:e._stickyDummy,_arrow:e._arrow}}},p={_IEisComposing:!1,_lineBreakerBind:null,_responsiveCurrentSize:"default",_responsiveButtonSize:null,_responsiveButtons:null,_directionKeyCode:new f.RegExp("^(8|13|3[2-9]|40|46)$"),_nonTextKeyCode:new f.RegExp("^(8|13|1[6-9]|20|27|3[3-9]|40|45|46|11[2-9]|12[0-3]|144|145)$"),_historyIgnoreKeyCode:new f.RegExp("^(1[6-9]|20|27|3[3-9]|40|45|11[2-9]|12[0-3]|144|145)$"),_onButtonsCheck:new f.RegExp("^("+f.Object.keys(d._textTagsMap).join("|")+")$","i"),_frontZeroWidthReg:new f.RegExp(u.zeroWidthSpace+"+",""),_keyCodeShortcut:{65:"A",66:"B",83:"S",85:"U",73:"I",89:"Y",90:"Z",219:"[",221:"]"},_shortcutCommand:function(e,t){let n=null,i=p._keyCodeShortcut[e];switch(i){case"A":n="selectAll";break;case"B":-1===d.shortcutsDisable.indexOf("bold")&&(n="bold");break;case"S":t&&-1===d.shortcutsDisable.indexOf("strike")?n="strike":t||-1!==d.shortcutsDisable.indexOf("save")||(n="save");break;case"U":-1===d.shortcutsDisable.indexOf("underline")&&(n="underline");break;case"I":-1===d.shortcutsDisable.indexOf("italic")&&(n="italic");break;case"Z":-1===d.shortcutsDisable.indexOf("undo")&&(n=t?"redo":"undo");break;case"Y":-1===d.shortcutsDisable.indexOf("undo")&&(n="redo");break;case"[":-1===d.shortcutsDisable.indexOf("indent")&&(n=d.rtl?"indent":"outdent");break;case"]":-1===d.shortcutsDisable.indexOf("indent")&&(n=d.rtl?"outdent":"indent")}return n?(m.commandHandler(m.commandMap[n],n),!0):!!i},_applyTagEffects:function(){let t=m.getSelectionNode();if(t===m.effectNode)return;m.effectNode=t;let i=d.rtl?"marginRight":"marginLeft",l=m.commandMap,o=p._onButtonsCheck,s=[],r=[],a=m.activePlugins,c=a.length,h="";for(;t.firstChild;)t=t.firstChild;for(let e=t;!u.isWysiwygDiv(e)&&e;e=e.parentNode)if(!(1!==e.nodeType||u.isBreak(e))){if(h=e.nodeName.toUpperCase(),r.push(h),!m.isReadOnly)for(let t=0,i;t<c;t++)i=a[t],-1===s.indexOf(i)&&n[i].active.call(m,e)&&s.push(i);if(u.isFormatElement(e)){-1===s.indexOf("OUTDENT")&&l.OUTDENT&&!u.isImportantDisabled(l.OUTDENT)&&(u.isListCell(e)||e.style[i]&&u.getNumber(e.style[i],0)>0)&&(s.push("OUTDENT"),l.OUTDENT.removeAttribute("disabled")),-1===s.indexOf("INDENT")&&l.INDENT&&!u.isImportantDisabled(l.INDENT)&&(s.push("INDENT"),u.isListCell(e)&&!e.previousElementSibling?l.INDENT.setAttribute("disabled",!0):l.INDENT.removeAttribute("disabled"));continue}o&&o.test(h)&&(s.push(h),u.addClass(l[h],"active"))}m._setKeyEffect(s),m._variable.currentNodes=r.reverse(),m._variable.currentNodesMap=s,d.showPathLabel&&(e.element.navigation.textContent=m._variable.currentNodes.join(" > "))},_cancelCaptionEdit:function(){this.setAttribute("contenteditable",!1),this.removeEventListener("blur",p._cancelCaptionEdit)},_buttonsEventHandler:function(e){let t=e.target;if(m._bindControllersOff&&e.stopPropagation(),/^(input|textarea|select|option)$/i.test(t.nodeName)?m._antiBlur=!1:e.preventDefault(),u.getParentElement(t,".se-submenu"))e.stopPropagation(),m._notHideToolbar=!0;else{let n=t.getAttribute("data-command"),i=t.className;for(;!n&&!/se-menu-list/.test(i)&&!/sun-editor-common/.test(i);)n=(t=t.parentNode).getAttribute("data-command"),i=t.className;(n===m._submenuName||n===m._containerName)&&e.stopPropagation()}},onClick_toolbar:function(e){let t=e.target,n=t.getAttribute("data-display"),i=t.getAttribute("data-command"),l=t.className;for(m.controllersOff();t.parentNode&&!i&&!/se-menu-list/.test(l)&&!/se-toolbar/.test(l);)i=(t=t.parentNode).getAttribute("data-command"),n=t.getAttribute("data-display"),l=t.className;(i||n)&&(t.disabled||m.actionCall(i,n,t))},onMouseDown_wysiwyg:function(t){if(m.isReadOnly||u.isNonEditable(e.element.wysiwyg)||"function"==typeof y.onMouseDown&&!1===y.onMouseDown(t,m))return;let n=u.getParentElement(t.target,u.isCell);if(n){let e=m.plugins.table;e&&n!==e._fixedCell&&!e._shift&&m.callPlugin("table",function(){e.onTableCellMultiSelect.call(m,n,!1)},null)}m._isBalloon&&p._hideToolbar(),/FIGURE/i.test(t.target.nodeName)&&t.preventDefault()},onClick_wysiwyg:function(t){let n=t.target;if(m.isReadOnly)return t.preventDefault(),u.isAnchor(n)&&f.open(n.href,n.target),!1;if(u.isNonEditable(e.element.wysiwyg)||"function"==typeof y.onClick&&!1===y.onClick(t,m))return;let i=m.getFileComponent(n);if(i){t.preventDefault(),m.selectComponent(i.target,i.pluginName);return}let l=u.getParentElement(n,"FIGCAPTION");if(l&&(u.isNonEditable(l)||!l.getAttribute("contenteditable"))&&(t.preventDefault(),l.setAttribute("contenteditable",!0),l.focus(),m._isInline&&!m._inlineToolbarAttr.isShow)){p._showToolbarInline();let hideToolbar=function(){p._hideToolbar(),l.removeEventListener("blur",hideToolbar)};l.addEventListener("blur",hideToolbar)}f.setTimeout(m._editorRange.bind(m)),m._editorRange();let o=m.getSelectionNode(),s=u.getFormatElement(o,null),r=u.getRangeFormatElement(o,null);if(s||u.isNonEditable(n)||u.isList(r))p._applyTagEffects();else{let e=m.getRange();if(u.getFormatElement(e.startContainer)===u.getFormatElement(e.endContainer)){if(u.isList(r)){t.preventDefault();let e=u.createElement("LI"),n=o.nextElementSibling;e.appendChild(o),r.insertBefore(e,n),m.focus()}else!u.isWysiwygDiv(o)&&!u.isComponent(o)&&(!u.isTable(o)||u.isCell(o))&&null!==m._setDefaultFormat(u.isRangeFormatElement(r)?"DIV":d.defaultTag)?(t.preventDefault(),m.focus()):p._applyTagEffects()}}m._isBalloon&&f.setTimeout(p._toggleToolbarBalloon)},_balloonDelay:null,_showToolbarBalloonDelay:function(){p._balloonDelay&&f.clearTimeout(p._balloonDelay),p._balloonDelay=f.setTimeout((function(){f.clearTimeout(this._balloonDelay),this._balloonDelay=null,this._showToolbarBalloon()}).bind(p),350)},_toggleToolbarBalloon:function(){m._editorRange();let e=m.getRange();m._bindControllersOff||!m._isBalloonAlways&&e.collapsed?p._hideToolbar():p._showToolbarBalloon(e)},_showToolbarBalloon:function(t){let n;if(!m._isBalloon)return;let i=t||m.getRange(),l=e.element.toolbar,o=e.element.topArea,s=m.getSelection();if(m._isBalloonAlways&&i.collapsed)n=!0;else if(s.focusNode===s.anchorNode)n=s.focusOffset<s.anchorOffset;else{let e=u.getListChildNodes(i.commonAncestorContainer,null);n=u.getArrayIndex(e,s.focusNode)<u.getArrayIndex(e,s.anchorNode)}let r=i.getClientRects();r=r[n?0:r.length-1];let a=m.getGlobalScrollOffset(),c=a.left,h=a.top,g=o.offsetWidth,y=p._getEditorOffsets(null),C=y.top,_=y.left;if(l.style.top="-10000px",l.style.visibility="hidden",l.style.display="block",!r){let t=m.getSelectionNode();if(u.isFormatElement(t)){let e=u.createTextNode(u.zeroWidthSpace);m.insertNode(e,null,!1),m.setRange(e,1,e,1),m._editorRange(),r=(r=m.getRange().getClientRects())[n?0:r.length-1]}if(!r){let n=u.getOffset(t,e.element.wysiwygFrame);r={left:n.left,top:n.top,right:n.left,bottom:n.top+t.offsetHeight,noText:!0},c=0,h=0}n=!0}let b=f.Math.round(e.element._arrow.offsetWidth/2),v=l.offsetWidth,E=l.offsetHeight,T=/iframe/i.test(e.element.wysiwygFrame.nodeName)?e.element.wysiwygFrame.getClientRects()[0]:null;if(T&&(r={left:r.left+T.left,top:r.top+T.top,right:r.right+T.right-T.width,bottom:r.bottom+T.bottom-T.height}),p._setToolbarOffset(n,r,l,_,g,c,h,C,b),(v!==l.offsetWidth||E!==l.offsetHeight)&&p._setToolbarOffset(n,r,l,_,g,c,h,C,b),d.toolbarContainer){let e=o.parentElement,t=d.toolbarContainer,n=t.offsetLeft,i=t.offsetTop;for(;!t.parentElement.contains(e)||!/^(BODY|HTML)$/i.test(t.parentElement.nodeName);)n+=(t=t.offsetParent).offsetLeft,i+=t.offsetTop;l.style.left=l.offsetLeft-n+o.offsetLeft+"px",l.style.top=l.offsetTop-i+o.offsetTop+"px"}l.style.visibility=""},_setToolbarOffset:function(t,n,i,l,o,s,r,a,d){let c=i.offsetWidth,g=n.noText&&!t?0:i.offsetHeight,m=(t?n.left:n.right)-l-c/2+s,y=m+c-o,C=(t?n.top-g-d:n.bottom+d)-(n.noText?0:a)+r,_=m<0?1:y<0?m:m-y-1-1,b=!1,v=C+(t?p._getEditorOffsets(null).top:i.offsetHeight-e.element.wysiwyg.offsetHeight);!t&&v>0&&p._getPageBottomSpace()<v?(t=!0,b=!0):t&&h.documentElement.offsetTop>v&&(t=!1,b=!0),b&&(C=(t?n.top-g-d:n.bottom+d)-(n.noText?0:a)+r),i.style.left=f.Math.floor(_)+"px",i.style.top=f.Math.floor(C)+"px",t?(u.removeClass(e.element._arrow,"se-arrow-up"),u.addClass(e.element._arrow,"se-arrow-down"),e.element._arrow.style.top=g+"px"):(u.removeClass(e.element._arrow,"se-arrow-down"),u.addClass(e.element._arrow,"se-arrow-up"),e.element._arrow.style.top=-d+"px");let E=f.Math.floor(c/2+(m-_));e.element._arrow.style.left=(E+d>i.offsetWidth?i.offsetWidth-d:E<d?d:E)+"px"},_showToolbarInline:function(){if(!m._isInline)return;let t=e.element.toolbar;d.toolbarContainer?t.style.position="relative":t.style.position="absolute",t.style.visibility="hidden",t.style.display="block",m._inlineToolbarAttr.width=t.style.width=d.toolbarWidth,m._inlineToolbarAttr.top=t.style.top=(d.toolbarContainer?0:-1-t.offsetHeight)+"px","function"==typeof y.showInline&&y.showInline(t,e,m),p.onScroll_window(),m._inlineToolbarAttr.isShow=!0,t.style.visibility=""},_hideToolbar:function(){m._notHideToolbar||m._variable.isFullScreen||(e.element.toolbar.style.display="none",m._inlineToolbarAttr.isShow=!1)},onInput_wysiwyg:function(e){if(m.isReadOnly||m.isDisabled)return e.preventDefault(),e.stopPropagation(),m.history.go(m.history.getCurrentIndex()),!1;m._editorRange();let t=(null===e.data?"":void 0===e.data?" ":e.data)||"";if(!m._charCount(t))return e.preventDefault(),e.stopPropagation(),!1;("function"!=typeof y.onInput||!1!==y.onInput(e,m))&&m.history.push(!0)},_isUneditableNode:function(e,t){let n;let i=t?e.startContainer:e.endContainer,l=t?e.startOffset:e.endOffset,o=t?"previousSibling":"nextSibling",s=1===i.nodeType;return s?(n=p._isUneditableNode_getSibling(i.childNodes[l],o,i))&&1===n.nodeType&&"false"===n.getAttribute("contenteditable"):(n=p._isUneditableNode_getSibling(i,o,i),m.isEdgePoint(i,l,t?"front":"end")&&n&&1===n.nodeType&&"false"===n.getAttribute("contenteditable"))},_isUneditableNode_getSibling:function(e,t,n){if(!e)return null;let i=e[t];if(!i){if(!(i=(i=u.getFormatElement(n))?i[t]:null)||u.isComponent(i))return null;i="previousSibling"===t?i.firstChild:i.lastChild}return i},_onShortcutKey:!1,onKeyDown_wysiwyg:function(t){let n=t.keyCode,i=t.shiftKey,l=t.ctrlKey||t.metaKey||91===n||92===n||224===n,o=t.altKey;if(p._IEisComposing=229===n,!l&&m.isReadOnly&&!p._directionKeyCode.test(n))return t.preventDefault(),!1;if(m.submenuOff(),m._isBalloon&&p._hideToolbar(),"function"==typeof y.onKeyDown&&!1===y.onKeyDown(t,m))return;if(l&&p._shortcutCommand(n,i))return p._onShortcutKey=!0,t.preventDefault(),t.stopPropagation(),!1;p._onShortcutKey&&(p._onShortcutKey=!1);let s=m.getSelectionNode(),r=m.getRange(),a=!r.collapsed||r.startContainer!==r.endContainer,c=m._fileManager.pluginRegExp.test(m.currentControllerName)?m.currentControllerName:"",h=u.getFormatElement(s,null)||s,g=u.getRangeFormatElement(h,null);switch(n){case 8:if(!a&&c){t.preventDefault(),t.stopPropagation(),m.plugins[c].destroy.call(m);break}if(a&&p._hardDelete()){t.preventDefault(),t.stopPropagation();break}if(!u.isFormatElement(h)&&!e.element.wysiwyg.firstElementChild&&!u.isComponent(s)&&null!==m._setDefaultFormat(d.defaultTag))return t.preventDefault(),t.stopPropagation(),!1;if(!a&&!h.previousElementSibling&&0===r.startOffset&&!s.previousSibling&&!u.isListCell(h)&&u.isFormatElement(h)&&(!u.isFreeFormatElement(h)||u.isClosureFreeFormatElement(h))){if(u.isClosureRangeFormatElement(h.parentNode))return t.preventDefault(),t.stopPropagation(),!1;if(u.isWysiwygDiv(h.parentNode)&&h.childNodes.length<=1&&(!h.firstChild||u.onlyZeroWidthSpace(h.textContent))){if(t.preventDefault(),t.stopPropagation(),h.nodeName.toUpperCase()===d.defaultTag.toUpperCase()){h.innerHTML="<br>";let e=h.attributes;for(;e[0];)h.removeAttribute(e[0].name)}else{let e=u.createElement(d.defaultTag);e.innerHTML="<br>",h.parentElement.replaceChild(e,h)}return m.nativeFocus(),!1}}if(h&&r.startContainer===r.endContainer&&3===s.nodeType&&!u.isFormatElement(s.parentNode)&&(r.collapsed?1===s.textContent.length:r.endOffset-r.startOffset===s.textContent.length)){t.preventDefault();let e=null,n=s.parentNode.previousSibling,i=s.parentNode.nextSibling;n||(i?(n=i,e=0):(n=u.createElement("BR"),h.appendChild(n))),s.textContent="",u.removeItemAllParents(s,null,h),e="number"==typeof e?e:3===n.nodeType?n.textContent.length:1,m.setRange(n,e,n,e);break}if(p._isUneditableNode(r,!0)){t.preventDefault(),t.stopPropagation();break}!a&&m._isEdgeFormat(r.startContainer,r.startOffset,"start")&&u.isFormatElement(h.previousElementSibling)&&(m._formatAttrsTemp=h.previousElementSibling.attributes);let C=r.commonAncestorContainer;if(h=u.getFormatElement(r.startContainer,null),(g=u.getRangeFormatElement(h,null))&&h&&!u.isCell(g)&&!/^FIGCAPTION$/i.test(g.nodeName)){if(u.isListCell(h)&&u.isList(g)&&(u.isListCell(g.parentNode)||h.previousElementSibling)&&(s===h||3===s.nodeType&&(!s.previousSibling||u.isList(s.previousSibling)))&&(u.getFormatElement(r.startContainer,null)!==u.getFormatElement(r.endContainer,null)?g.contains(r.startContainer):0===r.startOffset&&r.collapsed)){if(r.startContainer!==r.endContainer)t.preventDefault(),m.removeNode(),3===r.startContainer.nodeType&&m.setRange(r.startContainer,r.startContainer.textContent.length,r.startContainer,r.startContainer.textContent.length),m.history.push(!0);else{let e=h.previousElementSibling||g.parentNode;if(u.isListCell(e)){t.preventDefault();let n=e;if(!e.contains(h)&&u.isListCell(n)&&u.isList(n.lastElementChild)){for(n=n.lastElementChild.lastElementChild;u.isListCell(n)&&u.isList(n.lastElementChild);)n=n.lastElementChild&&n.lastElementChild.lastElementChild;e=n}let i=e===g.parentNode?g.previousSibling:e.lastChild;i||(i=u.createTextNode(u.zeroWidthSpace),g.parentNode.insertBefore(i,g.parentNode.firstChild));let l=3===i.nodeType?i.textContent.length:1,o=h.childNodes,s=i,r=o[0];for(;r=o[0];)e.insertBefore(r,s.nextSibling),s=r;u.removeItem(h),0===g.children.length&&u.removeItem(g),m.setRange(i,l,i,l),m.history.push(!0)}}break}if(!a&&0===r.startOffset){let e=!0,n=C;for(;n&&n!==g&&!u.isWysiwygDiv(n);){if(n.previousSibling&&(1===n.previousSibling.nodeType||!u.onlyZeroWidthSpace(n.previousSibling.textContent.trim()))){e=!1;break}n=n.parentNode}if(e&&g.parentNode){t.preventDefault(),m.detachRangeFormatElement(g,u.isListCell(h)?[h]:null,null,!1,!1),m.history.push(!0);break}}}if(!a&&h&&(0===r.startOffset||s===h&&h.childNodes[r.startOffset])){let e=s===h?h.childNodes[r.startOffset]:s,n=h.previousSibling,i=(3===C.nodeType||u.isBreak(C))&&!C.previousSibling&&0===r.startOffset;if(e&&!e.previousSibling&&(C&&u.isComponent(C.previousSibling)||i&&u.isComponent(n))){let e=m.getFileComponent(n);e?(t.preventDefault(),t.stopPropagation(),0===h.textContent.length&&u.removeItem(h),!1===m.selectComponent(e.target,e.pluginName)&&m.blur()):u.isComponent(n)&&(t.preventDefault(),t.stopPropagation(),u.removeItem(n));break}e&&u.isNonEditable(e.previousSibling)&&(t.preventDefault(),t.stopPropagation(),u.removeItem(e.previousSibling))}break;case 46:if(c){t.preventDefault(),t.stopPropagation(),m.plugins[c].destroy.call(m);break}if(a&&p._hardDelete()||p._isUneditableNode(r,!1)){t.preventDefault(),t.stopPropagation();break}if((u.isFormatElement(s)||null===s.nextSibling||u.onlyZeroWidthSpace(s.nextSibling)&&null===s.nextSibling.nextSibling)&&r.startOffset===s.textContent.length){let e=h.nextElementSibling;if(!e)break;if(u.isComponent(e)){if(t.preventDefault(),u.onlyZeroWidthSpace(h)&&(u.removeItem(h),u.isTable(e))){let t=u.getChildElement(e,u.isCell,!1);t=t.firstElementChild||t,m.setRange(t,0,t,0);break}let n=m.getFileComponent(e);n?(t.stopPropagation(),!1===m.selectComponent(n.target,n.pluginName)&&m.blur()):u.isComponent(e)&&(t.stopPropagation(),u.removeItem(e));break}}if(!a&&(m.isEdgePoint(r.endContainer,r.endOffset)||s===h&&h.childNodes[r.startOffset])){let e=s===h&&h.childNodes[r.startOffset]||s;if(e&&u.isNonEditable(e.nextSibling)){t.preventDefault(),t.stopPropagation(),u.removeItem(e.nextSibling);break}if(u.isComponent(e)){t.preventDefault(),t.stopPropagation(),u.removeItem(e);break}}if(!a&&m._isEdgeFormat(r.endContainer,r.endOffset,"end")&&u.isFormatElement(h.nextElementSibling)&&(m._formatAttrsTemp=h.attributes),h=u.getFormatElement(r.startContainer,null),g=u.getRangeFormatElement(h,null),u.isListCell(h)&&u.isList(g)&&(s===h||3===s.nodeType&&(!s.nextSibling||u.isList(s.nextSibling))&&(u.getFormatElement(r.startContainer,null)!==u.getFormatElement(r.endContainer,null)?g.contains(r.endContainer):r.endOffset===s.textContent.length&&r.collapsed))){r.startContainer!==r.endContainer&&m.removeNode();let e=u.getArrayItem(h.children,u.isList,!1);if((e=e||h.nextElementSibling||g.parentNode.nextElementSibling)&&(u.isList(e)||u.getArrayItem(e.children,u.isList,!1))){let n,i;if(t.preventDefault(),u.isList(e)){let t=e.firstElementChild;for(n=(i=t.childNodes)[0];i[0];)h.insertBefore(i[0],e);u.removeItem(t)}else{for(n=e.firstChild,i=e.childNodes;i[0];)h.appendChild(i[0]);u.removeItem(e)}m.setRange(n,0,n,0),m.history.push(!0)}}break;case 9:if(c||d.tabDisable||(t.preventDefault(),l||o||u.isWysiwygDiv(s)))break;let _=!r.collapsed||m.isEdgePoint(r.startContainer,r.startOffset),b=m.getSelectedElements(null);s=m.getSelectionNode();let v=[],E=[],T=u.isListCell(b[0]),w=u.isListCell(b[b.length-1]),N={sc:r.startContainer,so:r.startOffset,ec:r.endContainer,eo:r.endOffset};for(let e=0,t=b.length,n;e<t;e++)if(n=b[e],u.isListCell(n)){if(!n.previousElementSibling&&!i)continue;v.push(n)}else E.push(n);if(v.length>0&&_&&m.plugins.list)N=m.plugins.list.editInsideList.call(m,i,v);else{let e=u.getParentElement(s,u.isCell);if(e&&_){let t=u.getParentElement(e,"table"),n=u.getListChildren(t,u.isCell),l=i?u.prevIdx(n,e):u.nextIdx(n,e);l!==n.length||i||(l=0),-1===l&&i&&(l=n.length-1);let o=n[l];if(!o)break;o=o.firstElementChild||o,m.setRange(o,0,o,0);break}E=E.concat(v),T=w=null}if(E.length>0){if(i){let e=E.length-1;for(let t=0,n;t<=e;t++){n=E[t].childNodes;for(let e=0,t=n.length,i;e<t&&(i=n[e]);e++)if(!u.onlyZeroWidthSpace(i)){/^\s{1,4}$/.test(i.textContent)?u.removeItem(i):/^\s{1,4}/.test(i.textContent)&&(i.textContent=i.textContent.replace(/^\s{1,4}/,""));break}}let t=u.getChildElement(E[0],"text",!1),n=u.getChildElement(E[e],"text",!0);!T&&t&&(N.sc=t,N.so=0),!w&&n&&(N.ec=n,N.eo=n.textContent.length)}else{let e=u.createTextNode(new f.Array(m._variable.tabSize+1).join("\xa0"));if(1===E.length){let t=m.insertNode(e,null,!0);if(!t)return!1;T||(N.sc=e,N.so=t.endOffset),w||(N.ec=e,N.eo=t.endOffset)}else{let t=E.length-1;for(let n=0,i;n<=t;n++)(i=E[n].firstChild)&&(u.isBreak(i)?E[n].insertBefore(e.cloneNode(!1),i):i.textContent=e.textContent+i.textContent);let n=u.getChildElement(E[0],"text",!1),i=u.getChildElement(E[t],"text",!0);!T&&n&&(N.sc=n,N.so=0),!w&&i&&(N.ec=i,N.eo=i.textContent.length)}}}m.setRange(N.sc,N.so,N.ec,N.eo),m.history.push(!1);break;case 13:let x=u.getFreeFormatElement(s,null);if(m._charTypeHTML){let e="";if(e=!i&&x||i?"<br>":"<"+h.nodeName+"><br></"+h.nodeName+">",!m.checkCharCount(e,"byte-html"))return t.preventDefault(),!1}if(!i){let e=m._isEdgeFormat(r.endContainer,r.endOffset,"end"),n=m._isEdgeFormat(r.startContainer,r.startOffset,"start");if(e&&(/^H[1-6]$/i.test(h.nodeName)||/^HR$/i.test(h.nodeName))){t.preventDefault();let n=null,i=m.appendFormatTag(h,d.defaultTag);if(e&&e.length>0){n=e.pop();let t=n;for(;e.length>0;)n=n.appendChild(e.pop());i.appendChild(t)}n=n?n.appendChild(i.firstChild):i.firstChild,m.setRange(n,0,n,0);break}if(n||e){t.preventDefault();let i=u.createElement("BR"),l=u.createElement(h.nodeName);l.appendChild(i),u.copyTagAttributes(l,h,["id"].concat(d.lineAttrReset)),h.parentNode.insertBefore(l,n?h:h.nextElementSibling),e&&m.setRange(i,1,i,1);break}if(m._formatAttrsTemp=h.attributes,d.lineAttrReset&&h&&!u.isListCell(h)){let e;if(t.preventDefault(),t.stopPropagation(),r.collapsed)e=u.onlyZeroWidthSpace(h)?m.appendFormatTag(h,h.cloneNode(!1)):u.splitElement(r.endContainer,r.endOffset,0);else{let t=u.getFormatElement(r.startContainer,null)!==u.getFormatElement(r.endContainer,null),n=m.removeNode();if(t){if(e=u.getFormatElement(n.container,null),n.prevContainer)e!==h&&e.nextElementSibling===h&&(e=h);else{let t=h.cloneNode(!1);t.innerHTML="<br>",e.parentNode.insertBefore(t,e)}}else e=u.splitElement(n.container,n.offset,0)}let n=d.lineAttrReset,i=e.attributes,l=0;for(;i[l];){if(n&&n.indexOf(i[l].name.toLowerCase())>-1){l++;continue}e.removeAttribute(i[l].name)}m.setRange(e.firstChild,0,e.firstChild,0);break}if(x){t.preventDefault();let e=s===x,n=m.getSelection(),i=s.childNodes,l=n.focusOffset,o=s.previousElementSibling,a=s.nextSibling;if(!u.isClosureFreeFormatElement(x)&&i&&(e&&r.collapsed&&i.length-1<=l+1&&u.isBreak(i[l])&&(!i[l+1]||(!i[l+2]||u.onlyZeroWidthSpace(i[l+2].textContent))&&3===i[l+1].nodeType&&u.onlyZeroWidthSpace(i[l+1].textContent))&&l>0&&u.isBreak(i[l-1])||!e&&u.onlyZeroWidthSpace(s.textContent)&&u.isBreak(o)&&(u.isBreak(o.previousSibling)||!u.onlyZeroWidthSpace(o.previousSibling.textContent))&&(!a||!u.isBreak(a)&&u.onlyZeroWidthSpace(a.textContent)))){e?u.removeItem(i[l-1]):u.removeItem(s);let t=m.appendFormatTag(x,u.isFormatElement(x.nextElementSibling)&&!u.isRangeFormatElement(x.nextElementSibling)?x.nextElementSibling:null);u.copyFormatAttributes(t,x),m.setRange(t,1,t,1);break}if(e){y.insertHTML(r.collapsed&&u.isBreak(r.startContainer.childNodes[r.startOffset-1])?"<br>":"<br><br>",!0,!1);let e=n.focusNode,t=n.focusOffset;x===e&&(e=e.childNodes[t-l>1?t-1:t]),m.setRange(e,1,e,1)}else{let e=n.focusNode.nextSibling,t=u.createElement("BR");m.insertNode(t,null,!1);let i=t.previousSibling,l=t.nextSibling;!u.isBreak(e)&&!u.isBreak(i)&&(!l||u.onlyZeroWidthSpace(l))?(t.parentNode.insertBefore(t.cloneNode(!1),t),m.setRange(t,1,t,1)):m.setRange(l,0,l,0)}p._onShortcutKey=!0;break}}if(a)break;if(g&&h&&!u.isCell(g)&&!/^FIGCAPTION$/i.test(g.nodeName)){let e=m.getRange();if(m.isEdgePoint(e.endContainer,e.endOffset)&&u.isList(s.nextSibling)){t.preventDefault();let e=u.createElement("LI"),n=u.createElement("BR");e.appendChild(n),h.parentNode.insertBefore(e,h.nextElementSibling),e.appendChild(s.nextSibling),m.setRange(n,1,n,1);break}if((3!==e.commonAncestorContainer.nodeType||!e.commonAncestorContainer.nextElementSibling)&&u.onlyZeroWidthSpace(h.innerText.trim())){t.preventDefault();let e=null;if(u.isListCell(g.parentNode)){if(g=h.parentNode.parentNode.parentNode,!(e=u.splitElement(h,null,u.getElementDepth(h)-2))){let t=u.createElement("LI");t.innerHTML="<br>",g.insertBefore(t,e),e=t}}else{let t=u.isCell(g.parentNode)?"DIV":u.isList(g.parentNode)?"LI":u.isFormatElement(g.nextElementSibling)&&!u.isRangeFormatElement(g.nextElementSibling)?g.nextElementSibling.nodeName:u.isFormatElement(g.previousElementSibling)&&!u.isRangeFormatElement(g.previousElementSibling)?g.previousElementSibling.nodeName:d.defaultTag;e=u.createElement(t);let n=m.detachRangeFormatElement(g,[h],null,!0,!0);n.cc.insertBefore(e,n.ec)}e.innerHTML="<br>",u.removeItemAllParents(h,null,null),m.setRange(e,1,e,1);break}}if(g&&u.getParentElement(g,"FIGCAPTION")&&u.getParentElement(g,u.isList)&&(t.preventDefault(),h=m.appendFormatTag(h,null),m.setRange(h,0,h,0)),c){t.preventDefault(),t.stopPropagation();let n=e[c],i=n._container,l=i.previousElementSibling||i.nextElementSibling,o=null;u.isListCell(i.parentNode)?o=u.createElement("BR"):(o=u.createElement(u.isFormatElement(l)&&!u.isRangeFormatElement(l)?l.nodeName:d.defaultTag)).innerHTML="<br>",i.parentNode.insertBefore(o,i),m.callPlugin(c,function(){!1===m.selectComponent(n._element,c)&&m.blur()},null)}break;case 27:if(c)return t.preventDefault(),t.stopPropagation(),m.controllersOff(),!1}if(i&&16===n){t.preventDefault(),t.stopPropagation();let e=m.plugins.table;if(e&&!e._shift&&!e._ref){let t=u.getParentElement(h,u.isCell);if(t){e.onTableCellMultiSelect.call(m,t,!0);return}}}else if(i&&(u.isOSX_IOS?o:l)&&32===n){t.preventDefault(),t.stopPropagation();let e=m.insertNode(u.createTextNode("\xa0"));if(e&&e.container){m.setRange(e.container,e.endOffset,e.container,e.endOffset);return}}if(u.isIE&&!l&&!o&&!a&&!p._nonTextKeyCode.test(n)&&u.isBreak(r.commonAncestorContainer)){let e=u.createTextNode(u.zeroWidthSpace);m.insertNode(e,null,!1),m.setRange(e,1,e,1)}},onKeyUp_wysiwyg:function(e){if(p._onShortcutKey)return;m._editorRange();let t=e.keyCode,n=e.ctrlKey||e.metaKey||91===t||92===t||224===t,i=e.altKey;if(m.isReadOnly){!n&&p._directionKeyCode.test(t)&&p._applyTagEffects();return}let l=m.getRange(),o=m.getSelectionNode();if(m._isBalloon&&(m._isBalloonAlways&&27!==t||!l.collapsed)){if(m._isBalloonAlways)27!==t&&p._showToolbarBalloonDelay();else{p._showToolbarBalloon();return}}if(8===t&&u.isWysiwygDiv(o)&&""===o.textContent&&0===o.children.length){e.preventDefault(),e.stopPropagation(),o.innerHTML="";let t=u.createElement(u.isFormatElement(m._variable.currentNodes[0])?m._variable.currentNodes[0]:d.defaultTag);t.innerHTML="<br>",o.appendChild(t),m.setRange(t,0,t,0),p._applyTagEffects(),m.history.push(!1);return}let s=u.getFormatElement(o,null),r=u.getRangeFormatElement(o,null),a=m._formatAttrsTemp;if(a){for(let e=0,n=a.length;e<n;e++){if(13===t&&/^id$/i.test(a[e].name)){s.removeAttribute("id");continue}s.setAttribute(a[e].name,a[e].value)}m._formatAttrsTemp=null}s||!l.collapsed||u.isComponent(o)||u.isList(o)||null===m._setDefaultFormat(u.isRangeFormatElement(r)?"DIV":d.defaultTag)||(o=m.getSelectionNode()),p._directionKeyCode.test(t)&&p._applyTagEffects();let c=!n&&!i&&!p._nonTextKeyCode.test(t);if(c&&3===o.nodeType&&u.zeroWidthRegExp.test(o.textContent)&&!(void 0!==e.isComposing?e.isComposing:p._IEisComposing)){let e=l.startOffset,t=l.endOffset,n=(o.textContent.substring(0,t).match(p._frontZeroWidthReg)||"").length;e=l.startOffset-n,t=l.endOffset-n,o.textContent=o.textContent.replace(u.zeroWidthRegExp,""),m.setRange(o,e<0?0:e,o,t<0?0:t)}m._charCount(""),"function"==typeof y.onKeyUp&&!1===y.onKeyUp(e,m)||n||i||p._historyIgnoreKeyCode.test(t)||m.history.push(!0)},onScroll_wysiwyg:function(e){m.controllersOff(),m._isBalloon&&p._hideToolbar(),"function"==typeof y.onScroll&&y.onScroll(e,m)},onFocus_wysiwyg:function(e){m._antiBlur||(m.hasFocus=!0,f.setTimeout(p._applyTagEffects),m._isInline&&p._showToolbarInline(),"function"==typeof y.onFocus&&y.onFocus(e,m))},onBlur_wysiwyg:function(t){m._antiBlur||m._variable.isCodeView||(m.hasFocus=!1,m.effectNode=null,m.controllersOff(),(m._isInline||m._isBalloon)&&p._hideToolbar(),m._setKeyEffect([]),m._variable.currentNodes=[],m._variable.currentNodesMap=[],d.showPathLabel&&(e.element.navigation.textContent=""),"function"==typeof y.onBlur&&y.onBlur(t,m,this))},onMouseDown_resizingBar:function(t){t.stopPropagation(),m.submenuOff(),m.controllersOff(),m._variable.resizeClientY=t.clientY,e.element.resizeBackground.style.display="block",h.addEventListener("mousemove",p._resize_editor),h.addEventListener("mouseup",function closureFunc(){e.element.resizeBackground.style.display="none",h.removeEventListener("mousemove",p._resize_editor),h.removeEventListener("mouseup",closureFunc)})},_resize_editor:function(t){let n=e.element.editorArea.offsetHeight+(t.clientY-m._variable.resizeClientY),i=n<m._variable.minResizingSize?m._variable.minResizingSize:n;e.element.wysiwygFrame.style.height=e.element.code.style.height=i+"px",m._variable.resizeClientY=t.clientY,u.isResizeObserverSupported||m.__callResizeFunction(i,null)},onResize_window:function(){u.isResizeObserverSupported||m.resetResponsiveToolbar();let t=e.element.toolbar,n="none"===t.style.display||m._isInline&&!m._inlineToolbarAttr.isShow;if(0!==t.offsetWidth||n){if(e.fileBrowser&&"block"===e.fileBrowser.area.style.display&&(e.fileBrowser.body.style.maxHeight=f.innerHeight-e.fileBrowser.header.offsetHeight-50+"px"),m.submenuActiveButton&&m.submenu&&m._setMenuPosition(m.submenuActiveButton,m.submenu),m._variable.isFullScreen){m._variable.innerHeight_fullScreen+=f.innerHeight-t.offsetHeight-m._variable.innerHeight_fullScreen,e.element.editorArea.style.height=m._variable.innerHeight_fullScreen+"px";return}if(m._variable.isCodeView&&m._isInline){p._showToolbarInline();return}m._iframeAutoHeight(),m._sticky&&(t.style.width=e.element.topArea.offsetWidth-2+"px",p.onScroll_window())}},onScroll_window:function(){if(m._variable.isFullScreen||0===e.element.toolbar.offsetWidth||d.stickyToolbar<0)return;let t=e.element,n=t.editorArea.offsetHeight,i=(this.scrollY||h.documentElement.scrollTop)+d.stickyToolbar,l=p._getEditorOffsets(d.toolbarContainer).top-(m._isInline?t.toolbar.offsetHeight:0),o=m._isInline&&i-l>0?i-l-e.element.toolbar.offsetHeight:0;i<l?p._offStickyToolbar():i+m._variable.minResizingSize>=n+l?(m._sticky||p._onStickyToolbar(o),t.toolbar.style.top=o+n+l+d.stickyToolbar-i-m._variable.minResizingSize+"px"):i>=l&&p._onStickyToolbar(o)},_getEditorOffsets:function(t){let n=t||e.element.topArea,i=0,l=0,o=0;for(;n;)i+=n.offsetTop,l+=n.offsetLeft,o+=n.scrollTop,n=n.offsetParent;return{top:i,left:l,scroll:o}},_getPageBottomSpace:function(){return h.documentElement.scrollHeight-(p._getEditorOffsets(null).top+e.element.topArea.offsetHeight)},_onStickyToolbar:function(t){let n=e.element;m._isInline||d.toolbarContainer||(n._stickyDummy.style.height=n.toolbar.offsetHeight+"px",n._stickyDummy.style.display="block"),n.toolbar.style.top=d.stickyToolbar+t+"px",n.toolbar.style.width=m._isInline?m._inlineToolbarAttr.width:n.toolbar.offsetWidth+"px",u.addClass(n.toolbar,"se-toolbar-sticky"),m._sticky=!0},_offStickyToolbar:function(){let t=e.element;t._stickyDummy.style.display="none",t.toolbar.style.top=m._isInline?m._inlineToolbarAttr.top:"",t.toolbar.style.width=m._isInline?m._inlineToolbarAttr.width:"",t.editorArea.style.marginTop="",u.removeClass(t.toolbar,"se-toolbar-sticky"),m._sticky=!1},_codeViewAutoHeight:function(){m._variable.isFullScreen||(e.element.code.style.height=e.element.code.scrollHeight+"px")},_hardDelete:function(){let e=m.getRange(),t=e.startContainer,n=e.endContainer,i=u.getRangeFormatElement(t),l=u.getRangeFormatElement(n),o=u.isCell(i),s=u.isCell(l),r=e.commonAncestorContainer;if((o&&!i.previousElementSibling&&!i.parentElement.previousElementSibling||s&&!l.nextElementSibling&&!l.parentElement.nextElementSibling)&&i!==l){if(o){if(s)return u.removeItem(u.getParentElement(i,function(e){return r===e.parentNode})),m.nativeFocus(),!0;u.removeItem(u.getParentElement(i,function(e){return r===e.parentNode}))}else u.removeItem(u.getParentElement(l,function(e){return r===e.parentNode}))}let a=1===t.nodeType?u.getParentElement(t,".se-component"):null,d=1===n.nodeType?u.getParentElement(n,".se-component"):null;return a&&u.removeItem(a),d&&u.removeItem(d),!1},onPaste_wysiwyg:function(e){let t=u.isIE?f.clipboardData:e.clipboardData;return!t||p._dataTransferAction("paste",e,t)},_setClipboardComponent:function(e,t,n){e.preventDefault(),e.stopPropagation(),n.setData("text/html",t.component.outerHTML)},onCopy_wysiwyg:function(e){let t=u.isIE?f.clipboardData:e.clipboardData;if("function"==typeof y.onCopy&&!1===y.onCopy(e,t,m))return e.preventDefault(),e.stopPropagation(),!1;let n=m.currentFileComponentInfo;n&&!u.isIE&&(p._setClipboardComponent(e,n,t),u.addClass(n.component,"se-component-copy"),f.setTimeout(function(){u.removeClass(n.component,"se-component-copy")},150))},onSave_wysiwyg:function(e){if("function"==typeof y.onSave){y.onSave(e,m);return}},onCut_wysiwyg:function(e){let t=u.isIE?f.clipboardData:e.clipboardData;if("function"==typeof y.onCut&&!1===y.onCut(e,t,m))return e.preventDefault(),e.stopPropagation(),!1;let n=m.currentFileComponentInfo;n&&!u.isIE&&(p._setClipboardComponent(e,n,t),u.removeItem(n.component),m.controllersOff()),f.setTimeout(function(){m.history.push(!1)})},onDrop_wysiwyg:function(e){if(m.isReadOnly||u.isIE)return e.preventDefault(),e.stopPropagation(),!1;let t=e.dataTransfer;return!t||(m.removeNode(),p._setDropLocationSelection(e),p._dataTransferAction("drop",e,t))},_setDropLocationSelection:function(e){if(e.rangeParent)m.setRange(e.rangeParent,e.rangeOffset,e.rangeParent,e.rangeOffset);else if(m._wd.caretRangeFromPoint){let t=m._wd.caretRangeFromPoint(e.clientX,e.clientY);m.setRange(t.startContainer,t.startOffset,t.endContainer,t.endOffset)}else{let e=m.getRange();m.setRange(e.startContainer,e.startOffset,e.endContainer,e.endOffset)}},_dataTransferAction:function(t,n,i){let l,o;if(u.isIE){l=i.getData("Text");let s=m.getRange(),r=u.createElement("DIV"),a={sc:s.startContainer,so:s.startOffset,ec:s.endContainer,eo:s.endOffset};return r.setAttribute("contenteditable",!0),r.style.cssText="position:absolute; top:0; left:0; width:1px; height:1px; overflow:hidden;",e.element.relative.appendChild(r),r.focus(),f.setTimeout(function(){o=r.innerHTML,u.removeItem(r),m.setRange(a.sc,a.so,a.ec,a.eo),p._setClipboardData(t,n,l,o,i)}),!0}if(l=i.getData("text/plain"),o=i.getData("text/html"),!1===p._setClipboardData(t,n,l,o,i))return n.preventDefault(),n.stopPropagation(),!1},_setClipboardData:function(e,t,n,i,l){let o=/class=["']*Mso(Normal|List)/i.test(i)||/content=["']*Word.Document/i.test(i)||/content=["']*OneNote.File/i.test(i)||/content=["']*Excel.Sheet/i.test(i),s=!i;s?i=u._HTMLConvertor(n).replace(/\n/g,"<br>"):(i=i.replace(/^<html>\r?\n?<body>\r?\n?\x3C!--StartFragment--\>|\x3C!--EndFragment-->\r?\n?<\/body\>\r?\n?<\/html>$/g,""),o&&(i=i.replace(/\n/g," "),n=n.replace(/\n/g," ")),i=m.cleanHTML(i,m.pasteTagsWhitelistRegExp,m.pasteTagsBlacklistRegExp));let r=m._charCount(m._charTypeHTML?i:n);if("paste"===e&&"function"==typeof y.onPaste){let e=y.onPaste(t,i,r,m);if(!1===e)return!1;if("string"==typeof e){if(!e)return!1;i=e}}if("drop"===e&&"function"==typeof y.onDrop){let e=y.onDrop(t,i,r,m);if(!1===e)return!1;if("string"==typeof e){if(!e)return!1;i=e}}let a=l.files;return a.length>0&&!o?(/^image/.test(a[0].type)&&m.plugins.image&&y.insertImage(a),!1):!!r&&(i?(y.insertHTML(i,!0,!1),!1):void 0)},onMouseMove_wysiwyg:function(t){if(m.isDisabled||m.isReadOnly)return!1;let n=u.getParentElement(t.target,u.isComponent),i=m._lineBreaker.style;if(n&&!m.currentControllerName){let l=e.element,o=0,s=l.wysiwyg;do o+=s.scrollTop,s=s.parentElement;while(s&&!/^(BODY|HTML)$/i.test(s.nodeName));let r=l.wysiwyg.scrollTop,a=p._getEditorOffsets(null),c=u.getOffset(n,l.wysiwygFrame).top+r,h=t.pageY+o+(d.iframe&&!d.toolbarContainer?l.toolbar.offsetHeight:0),f=c+(d.iframe?o:a.top),g=u.isListCell(n.parentNode),y="",C="";if((g?n.previousSibling:u.isFormatElement(n.previousElementSibling))||!(h<f+20)){if((g?n.nextSibling:u.isFormatElement(n.nextElementSibling))||!(h>f+n.offsetHeight-20)){i.display="none";return}C=c+n.offsetHeight,y="b"}else C=c,y="t";m._variable._lineBreakComp=n,m._variable._lineBreakDir=y,i.top=C-r+"px",m._lineBreakerButton.style.left=u.getOffset(n).left+n.offsetWidth/2-15+"px",i.display="block"}else"none"!==i.display&&(i.display="none")},_onMouseDown_lineBreak:function(e){e.preventDefault()},_onLineBreak:function(e){e.preventDefault();let t=m._variable._lineBreakComp,n=this?this:m._variable._lineBreakDir,i=u.isListCell(t.parentNode),l=u.createElement(i?"BR":u.isCell(t.parentNode)?"DIV":d.defaultTag);if(i||(l.innerHTML="<br>"),m._charTypeHTML&&!m.checkCharCount(l.outerHTML,"byte-html"))return;t.parentNode.insertBefore(l,"t"===n?t:t.nextSibling),m._lineBreaker.style.display="none",m._variable._lineBreakComp=null;let o=i?l:l.firstChild;m.setRange(o,1,o,1),m.history.push(!1)},_resizeObserver:null,_toolbarObserver:null,_addEvent:function(){let t=d.iframe?m._ww:e.element.wysiwyg;u.isResizeObserverSupported&&(this._resizeObserver=new f.ResizeObserver(function(e){m.__callResizeFunction(-1,e[0])})),e.element.toolbar.addEventListener("mousedown",p._buttonsEventHandler,!1),e.element._menuTray.addEventListener("mousedown",p._buttonsEventHandler,!1),e.element.toolbar.addEventListener("click",p.onClick_toolbar,!1),t.addEventListener("mousedown",p.onMouseDown_wysiwyg,!1),t.addEventListener("click",p.onClick_wysiwyg,!1),t.addEventListener(u.isIE?"textinput":"input",p.onInput_wysiwyg,!1),t.addEventListener("keydown",p.onKeyDown_wysiwyg,!1),t.addEventListener("keyup",p.onKeyUp_wysiwyg,!1),t.addEventListener("paste",p.onPaste_wysiwyg,!1),t.addEventListener("copy",p.onCopy_wysiwyg,!1),t.addEventListener("cut",p.onCut_wysiwyg,!1),t.addEventListener("drop",p.onDrop_wysiwyg,!1),t.addEventListener("scroll",p.onScroll_wysiwyg,!1),t.addEventListener("focus",p.onFocus_wysiwyg,!1),t.addEventListener("blur",p.onBlur_wysiwyg,!1),p._lineBreakerBind={a:p._onLineBreak.bind(""),t:p._onLineBreak.bind("t"),b:p._onLineBreak.bind("b")},t.addEventListener("mousemove",p.onMouseMove_wysiwyg,!1),m._lineBreakerButton.addEventListener("mousedown",p._onMouseDown_lineBreak,!1),m._lineBreakerButton.addEventListener("click",p._lineBreakerBind.a,!1),e.element.lineBreaker_t.addEventListener("mousedown",p._lineBreakerBind.t,!1),e.element.lineBreaker_b.addEventListener("mousedown",p._lineBreakerBind.b,!1),m.plugins.table&&t.addEventListener("touchstart",p.onMouseDown_wysiwyg,{passive:!0,useCapture:!1}),"auto"!==d.height||d.codeMirrorEditor||(e.element.code.addEventListener("keydown",p._codeViewAutoHeight,!1),e.element.code.addEventListener("keyup",p._codeViewAutoHeight,!1),e.element.code.addEventListener("paste",p._codeViewAutoHeight,!1)),e.element.resizingBar&&(/\d+/.test(d.height)&&d.resizeEnable?e.element.resizingBar.addEventListener("mousedown",p.onMouseDown_resizingBar,!1):u.addClass(e.element.resizingBar,"se-resizing-none")),p._setResponsiveToolbar(),u.isResizeObserverSupported&&(this._toolbarObserver=new f.ResizeObserver(m.resetResponsiveToolbar)),f.addEventListener("resize",p.onResize_window,!1),d.stickyToolbar>-1&&f.addEventListener("scroll",p.onScroll_window,!1)},_removeEvent:function(){let t=d.iframe?m._ww:e.element.wysiwyg;e.element.toolbar.removeEventListener("mousedown",p._buttonsEventHandler),e.element._menuTray.removeEventListener("mousedown",p._buttonsEventHandler),e.element.toolbar.removeEventListener("click",p.onClick_toolbar),t.removeEventListener("mousedown",p.onMouseDown_wysiwyg),t.removeEventListener("click",p.onClick_wysiwyg),t.removeEventListener(u.isIE?"textinput":"input",p.onInput_wysiwyg),t.removeEventListener("keydown",p.onKeyDown_wysiwyg),t.removeEventListener("keyup",p.onKeyUp_wysiwyg),t.removeEventListener("paste",p.onPaste_wysiwyg),t.removeEventListener("copy",p.onCopy_wysiwyg),t.removeEventListener("cut",p.onCut_wysiwyg),t.removeEventListener("drop",p.onDrop_wysiwyg),t.removeEventListener("scroll",p.onScroll_wysiwyg),t.removeEventListener("mousemove",p.onMouseMove_wysiwyg),m._lineBreakerButton.removeEventListener("mousedown",p._onMouseDown_lineBreak),m._lineBreakerButton.removeEventListener("click",p._lineBreakerBind.a),e.element.lineBreaker_t.removeEventListener("mousedown",p._lineBreakerBind.t),e.element.lineBreaker_b.removeEventListener("mousedown",p._lineBreakerBind.b),p._lineBreakerBind=null,t.removeEventListener("touchstart",p.onMouseDown_wysiwyg,{passive:!0,useCapture:!1}),t.removeEventListener("focus",p.onFocus_wysiwyg),t.removeEventListener("blur",p.onBlur_wysiwyg),e.element.code.removeEventListener("keydown",p._codeViewAutoHeight),e.element.code.removeEventListener("keyup",p._codeViewAutoHeight),e.element.code.removeEventListener("paste",p._codeViewAutoHeight),e.element.resizingBar&&e.element.resizingBar.removeEventListener("mousedown",p.onMouseDown_resizingBar),p._resizeObserver&&(p._resizeObserver.unobserve(e.element.wysiwygFrame),p._resizeObserver=null),p._toolbarObserver&&(p._toolbarObserver.unobserve(e.element._toolbarShadow),p._toolbarObserver=null),f.removeEventListener("resize",p.onResize_window),f.removeEventListener("scroll",p.onScroll_window)},_setResponsiveToolbar:function(){if(0===c.length){c=null;return}p._responsiveCurrentSize="default";let e=p._responsiveButtonSize=[],t=p._responsiveButtons={default:c[0]};for(let n=1,i=c.length,l,o;n<i;n++)l=1*(o=c[n])[0],e.push(l),t[l]=o[1];e.sort(function(e,t){return e-t}).unshift("default")}},y={core:m,util:u,onload:null,onScroll:null,onMouseDown:null,onClick:null,onInput:null,onKeyDown:null,onKeyUp:null,onCopy:null,onCut:null,onFocus:null,onBlur:null,onChange:null,onSave:null,onDrop:null,onPaste:null,showInline:null,showController:null,toggleCodeView:null,toggleFullScreen:null,imageUploadHandler:null,videoUploadHandler:null,audioUploadHandler:null,onImageUploadBefore:null,onVideoUploadBefore:null,onAudioUploadBefore:null,onImageUpload:null,onVideoUpload:null,onAudioUpload:null,onImageUploadError:null,onVideoUploadError:null,onAudioUploadError:null,onResizeEditor:null,onSetToolbarButtons:null,setToolbarButtons:function(t){m.submenuOff(),m.containerOff(),m.moreLayerOff();let n=i.Z._createToolBar(h,t,m.plugins,d);c=n.responsiveButtons,p._setResponsiveToolbar(),e.element.toolbar.replaceChild(n._buttonTray,e.element._buttonTray);let o=(0,l.Z)(e.element.originElement,m._getConstructed(e.element),d);e.element=o.element,e.tool=o.tool,d.iframe&&(e.element.wysiwyg=m._wd.body),m._recoverButtonStates(),m._cachingButtons(),m.history._resetCachingButton(),m.effectNode=null,m.hasFocus&&p._applyTagEffects(),m.isReadOnly&&u.setDisabledButtons(!0,m.resizingDisabledButtons),"function"==typeof y.onSetToolbarButtons&&y.onSetToolbarButtons(n._buttonTray.querySelectorAll("button"),m)},setOptions:function(l){p._removeEvent(),m._resetComponents(),u.removeClass(m._styleCommandMap.showBlocks,"active"),u.removeClass(m._styleCommandMap.codeView,"active"),m._variable.isCodeView=!1,m._iframeAuto=null,m.plugins=l.plugins||m.plugins;let o=[d,l].reduce(function(e,t){for(let n in t)if(u.hasOwn(t,n)){if("plugins"===n&&t[n]&&e[n]){let i=e[n],l=t[n];i=i.length?i:f.Object.keys(i).map(function(e){return i[e]}),l=l.length?l:f.Object.keys(l).map(function(e){return l[e]}),e[n]=l.filter(function(e){return -1===i.indexOf(e)}).concat(i)}else e[n]=t[n]}return e},{}),s=e.element,r=s.wysiwyg.innerHTML,h=i.Z._setOptions(o,e,d);h.callButtons&&(t=h.callButtons,m.initPlugins={}),h.plugins&&(m.plugins=n=h.plugins),0===s._menuTray.children.length&&(this._menuTray={}),c=h.toolbar.responsiveButtons,m.options=d=o,m.lang=a=d.lang,d.iframe&&s.wysiwygFrame.addEventListener("load",function(){u._setIframeDocument(this,d),m._setOptionsInit(s,r)}),s.editorArea.appendChild(s.wysiwygFrame),d.iframe||m._setOptionsInit(s,r)},setDefaultStyle:function(t){let n=d._editorStyles=u._setDefaultOptionStyle(d,t),i=e.element;i.topArea.style.cssText=n.top,i.code.style.cssText=d._editorStyles.frame,i.code.style.display="none","auto"===d.height?i.code.style.overflow="hidden":i.code.style.overflow="",d.iframe?(i.wysiwygFrame.style.cssText=n.frame,i.wysiwyg.style.cssText=n.editor):i.wysiwygFrame.style.cssText=n.frame+n.editor},noticeOpen:function(e){m.notice.open.call(m,e)},noticeClose:function(){m.notice.close.call(m)},save:function(){let t=m.getContents(!1);e.element.originElement.value=t,p.onSave_wysiwyg(t,m)},getContext:function(){return e},getContents:function(e){return m.getContents(e)},getText:function(){return e.element.wysiwyg.textContent},getCharCount:function(t){return t="string"==typeof t?t:d.charCounterType,m.getCharLength(m._charTypeHTML?e.element.wysiwyg.innerHTML:e.element.wysiwyg.textContent,t)},getImagesInfo:function(){return e.image?e.image._infoList:[]},getFilesInfo:function(t){return e[t]?e[t]._infoList:[]},insertImage:function(e){m.plugins.image&&e&&(m.initPlugins.image?m.plugins.image.submitAction.call(m,e):m.callPlugin("image",m.plugins.image.submitAction.bind(m,e),null),m.focus())},insertHTML:function(t,n,i,l){if(e.element.wysiwygFrame.contains(m.getSelection().focusNode)||m.focus(),"string"==typeof t){n||(t=m.cleanHTML(t,null,null));try{let e,n,o,s,r;if(u.isListCell(u.getFormatElement(m.getSelectionNode(),null))){let e=h.createRange().createContextualFragment(t),n=e.childNodes;m._isFormatData(n)&&(t=m._convertListCell(n))}let a=h.createRange().createContextualFragment(t),d=a.childNodes;if(i){let e=m._charTypeHTML?"outerHTML":"textContent",t="";for(let n=0,i=d.length;n<i;n++)t+=d[n][e];if(!m.checkCharCount(t,null))return}for(;e=d[0];){if(s&&3===s.nodeType&&n&&1===n.nodeType&&u.isBreak(e)){s=e,u.removeItem(e);continue}n=(o=m.insertNode(e,n,!1)).container||o,r||(r=o),s=e}3===s.nodeType&&1===n.nodeType&&(n=s);let c=3===n.nodeType?o.endOffset||n.textContent.length:n.childNodes.length;l?m.setRange(r.container||r,r.startOffset||0,n,c):m.setRange(n,c,n,c)}catch(e){if(m.isDisabled||m.isReadOnly)return;console.warn("[SUNEDITOR.insertHTML.fail] "+e),m.execCommand("insertHTML",!1,t)}}else if(u.isComponent(t))m.insertComponent(t,!1,i,!1);else{let e=null;(u.isFormatElement(t)||u.isMedia(t))&&(e=u.getFormatElement(m.getSelectionNode(),null)),m.insertNode(t,e,i)}m.effectNode=null,m.focus(),m.history.push(!1)},setContents:function(e){m.setContents(e)},appendContents:function(t){let n=m.convertContentsForEditor(t);if(m._variable.isCodeView)m._setCodeView(m._getCodeView()+"\n"+m.convertHTMLForCodeView(n,!1));else{let t=u.createElement("DIV");t.innerHTML=n;let i=e.element.wysiwyg,l=t.children;for(let e=0,t=l.length;e<t;e++)l[e]&&i.appendChild(l[e])}m.history.push(!1)},readOnly:function(t){m.isReadOnly=t,u.setDisabledButtons(!!t,m.resizingDisabledButtons),t?(m.controllersOff(),m.submenuActiveButton&&m.submenuActiveButton.disabled&&m.submenuOff(),m._moreLayerActiveButton&&m._moreLayerActiveButton.disabled&&m.moreLayerOff(),m.containerActiveButton&&m.containerActiveButton.disabled&&m.containerOff(),m.modalForm&&m.plugins.dialog.close.call(m),e.element.code.setAttribute("readOnly","true"),u.addClass(e.element.wysiwygFrame,"se-read-only")):(e.element.code.removeAttribute("readOnly"),u.removeClass(e.element.wysiwygFrame,"se-read-only")),d.codeMirrorEditor&&d.codeMirrorEditor.setOption("readOnly",!!t)},disable:function(){this.toolbar.disable(),this.wysiwyg.disable()},disabled:function(){this.disable()},enable:function(){this.toolbar.enable(),this.wysiwyg.enable()},enabled:function(){this.enable()},show:function(){let t=e.element.topArea.style;"none"===t.display&&(t.display=d.display)},hide:function(){e.element.topArea.style.display="none"},destroy:function(){for(let t in m.submenuOff(),m.containerOff(),m.controllersOff(),m.notice&&m.notice.close.call(m),m.modalForm&&m.plugins.dialog.close.call(m),m.history._destroy(),p._removeEvent(),u.removeItem(e.element.toolbar),u.removeItem(e.element.topArea),m.functions)u.hasOwn(m,t)&&delete m.functions[t];for(let e in m)u.hasOwn(m,e)&&delete m[e];for(let e in p)u.hasOwn(p,e)&&delete p[e];for(let t in e)u.hasOwn(e,t)&&delete e[t];for(let e in t)u.hasOwn(t,e)&&delete t[e];for(let e in this)u.hasOwn(this,e)&&delete this[e]},toolbar:{disable:function(){m.submenuOff(),m.moreLayerOff(),m.containerOff(),e.tool.cover.style.display="block"},disabled:function(){this.disable()},enable:function(){e.tool.cover.style.display="none"},enabled:function(){this.enable()},show:function(){m._isInline?p._showToolbarInline():(e.element.toolbar.style.display="",e.element._stickyDummy.style.display=""),p.onResize_window()},hide:function(){m._isInline?p._hideToolbar():(e.element.toolbar.style.display="none",e.element._stickyDummy.style.display="none"),p.onResize_window()}},wysiwyg:{disable:function(){m.controllersOff(),m.modalForm&&m.plugins.dialog.close.call(m),e.element.wysiwyg.setAttribute("contenteditable",!1),m.isDisabled=!0,d.codeMirrorEditor?d.codeMirrorEditor.setOption("readOnly",!0):e.element.code.setAttribute("disabled","disabled")},enable:function(){e.element.wysiwyg.setAttribute("contenteditable",!0),m.isDisabled=!1,d.codeMirrorEditor?d.codeMirrorEditor.setOption("readOnly",!1):e.element.code.removeAttribute("disabled")}}};m.functions=y,m.options=d;let C=e.element,_=C.originElement,b=C.topArea;return _.style.display="none",b.style.display="block",d.iframe&&C.wysiwygFrame.addEventListener("load",function(){u._setIframeDocument(this,d),m._editorInit(!1,d.value),d.value=null}),"object"==typeof _.nextElementSibling?_.parentNode.insertBefore(b,_.nextElementSibling):_.parentNode.appendChild(b),C.editorArea.appendChild(C.wysiwygFrame),C=_=b=null,d.iframe||(m._editorInit(!1,d.value),d.value=null),y}}}]);